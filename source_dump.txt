# ==================================================
# Path: D:\VSCode\bach-nghe-student-management-website
# Detected tech: docker, javascript, typescript
# ==================================================

## DIRECTORY STRUCTURE
```
bach-nghe-student-management-website/
├── .git/
├── backend/
│   ├── node_modules/
│   ├── src/
│   │   ├── controllers/
│   │   │   ├── admin.controller.js
│   │   │   ├── auth.controller.js
│   │   │   ├── errors.controller.js
│   │   │   ├── student.controller.js
│   │   │   └── teacher.controller.js
│   │   ├── database/
│   │   ├── middlewares/
│   │   │   └── auth.middleware.js
│   │   ├── models/
│   │   │   ├── admin.model.js
│   │   │   ├── auth.model.js
│   │   │   ├── student.model.js
│   │   │   └── teacher.model.js
│   │   ├── routes/
│   │   │   ├── admin.router.js
│   │   │   ├── auth.router.js
│   │   │   ├── student.router.js
│   │   │   └── teacher.router.js
│   │   ├── api-error.js
│   │   ├── app.js
│   │   └── jsend.js
│   ├── .env
│   ├── .gitignore
│   ├── package-lock.json
│   ├── package.json
│   └── server.js
├── database/
├── frontend/
│   ├── admin/
│   │   ├── page_account_management.html
│   │   ├── page_add_certificate.html
│   │   ├── page_add_student_to_class.html
│   │   ├── page_admin.html
│   │   ├── page_certificate.html
│   │   ├── page_class_management.html
│   │   ├── page_create_account.html
│   │   ├── page_list_certificate_class.html
│   │   ├── page_list_student_in_class.html
│   │   ├── page_student_management.html
│   │   └── page_teacher_management.html
│   ├── css/
│   │   ├── account_managenment.css
│   │   ├── addmin_add_student.css
│   │   ├── admin.css
│   │   ├── admin_create_account.css
│   │   ├── certificate_page.css
│   │   ├── info_student.css
│   │   ├── list_certificate_class.css
│   │   ├── login.css
│   │   ├── page_student_list_teacher.css
│   │   ├── student.css
│   │   ├── student_managenment.css
│   │   ├── teacher.css
│   │   └── teacher_statistics.css
│   ├── images/
│   │   ├── b1.jpg
│   │   ├── b2.jpg
│   │   ├── b3.jpg
│   │   ├── bg_login.jpg
│   │   └── logo_Truong_Bach_Nghe.png
│   ├── js/
│   │   ├── Administrator/
│   │   │   ├── manage_account/
│   │   │   │   ├── account_management.js
│   │   │   │   ├── admin_add_account_list.js
│   │   │   │   └── admin_display_account_list.js
│   │   │   ├── manage_certificate/
│   │   │   │   ├── admin_add_certificate.js
│   │   │   │   ├── admin_display_cert_class.js
│   │   │   │   ├── admin_display_certificate.js
│   │   │   │   └── admin_get_student.js
│   │   │   ├── manage_class/
│   │   │   │   ├── admin_add_class.js
│   │   │   │   ├── admin_add_student_to_class.js
│   │   │   │   ├── admin_display_class.js
│   │   │   │   ├── admin_display_class_student.js
│   │   │   │   ├── admin_student_in_class.js
│   │   │   │   └── admin_update_class.js
│   │   │   ├── manage_dashboard/
│   │   │   │   ├── admin_display_stats.js
│   │   │   │   └── dashboard_chart.js
│   │   │   ├── manage_student/
│   │   │   │   ├── admin_add_student.js
│   │   │   │   ├── admin_display_student.js
│   │   │   │   ├── admin_import_student_list.js
│   │   │   │   └── admin_update_student.js
│   │   │   └── manage_teacher/
│   │   │       ├── admin_add_teacher.js
│   │   │       ├── admin_display_teacher.js
│   │   │       └── admin_update_teacher.js
│   │   ├── Authentication/
│   │   │   ├── login.js
│   │   │   ├── logout.js
│   │   │   └── storage.js
│   │   ├── Student/
│   │   │   ├── student.js
│   │   │   ├── student_cert.js
│   │   │   └── student_information.js
│   │   ├── Teacher/
│   │   │   ├── teacher_chart.js
│   │   │   ├── teacher_home_page.js
│   │   │   ├── teacher_import_excel.js
│   │   │   ├── teacher_information.js
│   │   │   └── teacher_student_list.js
│   │   └── toast.js
│   ├── login/
│   │   └── login.html
│   ├── student/
│   │   ├── page_cert_student.html
│   │   ├── page_info_student.html
│   │   └── page_student.html
│   └── teacher/
│       ├── page_score_statistics.html
│       ├── page_student_list.html
│       └── page_teacher_home.html
├── .gitignore
├── README.md
└── source_dump.txt
```

## FILE CONTENTS

### backend\server.js
```js
require("dotenv").config();
const app = require("./src/app");

// Start the server
const port = process.env.PORT || 3000;
app.listen(port, () => {
  console.log(`Server is running on port ${port}.`);
});

```

### backend\src\api-error.js
```js
class ApiError extends Error {
    constructor(statusCode, message, headers = {}) {
        super();
        this.statusCode = statusCode;
        this.message = message;
        this.headers = headers;
    }
}

module.exports = ApiError;
```

### backend\src\app.js
```js
const express = require("express");
const cors = require("cors");
const JSend = require("./jsend");
const knex = require("./database/knex");
const session = require("express-session");

const authRouter = require("./routes/auth.router");
const studentRouter = require("./routes/student.router");
const teacherRouter = require("./routes/teacher.router");
const adminRouter = require("./routes/admin.router");

const {
  resourceNotFound,
  handleError,
} = require("./controllers/errors.controller");

const app = express();

/**
 * Cấu hình CORS cho các nguồn frontend được phép.
 */
app.use(
  cors({
    origin: [
      "http://localhost:5501",
      "http://localhost",
      "http://127.0.0.1:5501",
    ],
    credentials: true,
  })
);

/**
 * Middleware xử lý dữ liệu JSON và form.
 */
app.use(express.json());
app.use(express.urlencoded({ extended: true }));

/**
 * Cấu hình phiên làm việc với express-session.
 */
app.use(
  session({
    secret: process.env.SESSION_SECRET,
    resave: false,
    saveUninitialized: false,
    cookie: { secure: false },
  })
);

/**
 * Kiểm tra kết nối với cơ sở dữ liệu.
 * @route GET /api/check-connection
 */
app.get("/api/check-connection", async (req, res) => {
  try {
    await knex.raw("SELECT 1");
    res.json({ message: "Connect Successfully!" });
  } catch (error) {
    res.status(500).json({
      error: "Cannot Connect Successfully!",
      details: error.message,
    });
  }
});

/**
 * Route mặc định trả về response thành công.
 * @route GET /
 */
app.get("/", (req, res) => {
  return res.json(JSend.success());
});

/**
 * Route phục vụ tài nguyên tĩnh từ thư mục /public.
 * @route GET /public/*
 */
app.use("/public", express.static("public"));

/**
 * Khởi tạo router cho các nhóm chức năng chính.
 */
authRouter.setup(app);
studentRouter.setup(app);
teacherRouter.setup(app);
adminRouter.setup(app);

/**
 * Middleware xử lý 404 khi không tìm thấy route.
 */
app.use(resourceNotFound);

/**
 * Middleware xử lý lỗi chung.
 */
app.use(handleError);

module.exports = app;

```

### backend\src\jsend.js
```js
/**
 * @param {object | null} data
 * @returns {{status: 'success', data: object | null}}
 */
function success(data = "Welcome to Bach Nghe Student Management Website!") {
  return {
    status: "success",
    data: data,
  };
}

/**
 * @param {string} message
 * @param {object | null} [data]
 * @returns {{status: 'fail', message: string, data: object | undefined}}
 */
function fail(message, data = null) {
  if (data) {
    return {
      status: "fail",
      message,
      data,
    };
  }
  return {
    status: "fail",
    message,
  };
}

/**
 * @param {string} message
 * @param {object | null} [data]
 * @returns {{status: 'error', message: string, data: object | undefined}}
 */
function error(message, data = null) {
  if (data) {
    return {
      status: "error",
      message,
      data,
    };
  }
  return {
    status: "error",
    message,
  };
}

module.exports = {
  success,
  fail,
  error,
};

```

### backend\src\controllers\admin.controller.js
```js
const adminService = require("../models/admin.model");
const JSend = require("../jsend");
const ApiError = require("../api-error");

// Account Management
/**
 * Tạo tài khoản học viên mới.
 * @route POST /api/admin/account/student
 * @param {Request} req - Express request object
 * @param {Response} res - Express response object
 * @param {Function} next - Express next middleware
 */
async function createStudentAccount(req, res, next) {
  const { username, password } = req.body;

  if (!username || !password) {
    return res.status(400).json(JSend.fail("All fields are required"));
  }

  try {
    // Kiểm tra tài khoản đã tồn tại
    const existing = await adminService.checkUserAccount(username);
    if (existing) {
      return res.status(400).json(JSend.fail("Account already exists"));
    }

    const student = await adminService.createStudentAccount({
      username,
      password,
    });

    if (!student) {
      return next(new ApiError(401, "Create account failed"));
    }

    return res.status(201).json(JSend.success(student));
  } catch (err) {
    console.error(err);
    return res.status(500).json(JSend.error("Internal server error", err));
  }
}

/**
 * Tạo tài khoản giảng viên mới.
 * @route POST /api/admin/account/teacher
 * @param {Request} req
 * @param {Response} res
 * @param {Function} next
 */
async function createTeacherAccount(req, res, next) {
  const { username, password, role } = req.body;

  if (!username || !password) {
    return res.status(400).json(JSend.fail("All fields are required"));
  }

  try {
    // Kiểm tra tài khoản đã tồn tại
    const existing = await adminService.checkUserAccount(username);
    if (existing) {
      return res.status(400).json(JSend.fail("Account already exists"));
    }

    const teacher = await adminService.createTeacherAccount({
      username,
      password,
    });

    if (!teacher) {
      return next(new ApiError(401, "Create account failed"));
    }

    return res.status(201).json(JSend.success(teacher));
  } catch (err) {
    console.error(err);
    return res.status(500).json(JSend.error("Internal server error", err));
  }
}

/**
 * Lấy danh sách tài khoản học viên.
 * @route GET /api/admin/account/student
 */
async function getStudentAccount(req, res, next) {
  try {
    const students = await adminService.getStudentAccount();
    if (!students) {
      return next(new ApiError(404, "No student accounts found"));
    }
    return res.status(200).json(JSend.success(students));
  } catch (err) {
    console.error(err);
    return res.status(500).json(JSend.error("Internal server error", err));
  }
}

/**
 * Lấy danh sách tất cả tài khoản người dùng (trừ admin).
 * @route GET /api/admin/account
 */
async function getAccountList(req, res, next) {
  try {
    const users = await adminService.getAccountList();
    if (!users) {
      return next(new ApiError(404, "No user accounts found"));
    }
    return res.status(200).json(JSend.success(users));
  } catch (err) {
    console.error(err);
    return res.status(500).json(JSend.error("Internal server error", err));
  }
}

/**
 * Lấy danh sách tài khoản giảng viên.
 * @route GET /api/admin/account/teacher
 */
async function getTeacherAccount(req, res, next) {
  try {
    const users = await adminService.getTeacherAccount();
    if (!users) {
      return next(new ApiError(404, "No user accounts found"));
    }
    return res.status(200).json(JSend.success(users));
  } catch (err) {
    console.error(err);
    return res.status(500).json(JSend.error("Internal server error", err));
  }
}

/**
 * Cập nhật thông tin tài khoản (mật khẩu hoặc trạng thái).
 * @route PUT /api/admin/account
 */
async function updateAccount(req, res, next) {
  const { currentCode, newPassword, newStatus } = req.body;

  if (!currentCode || newPassword === undefined || isNaN(newStatus)) {
    return res.status(400).json(JSend.fail("Invalid input"));
  }

  try {
    const updatedUser = await adminService.updateAccount({
      currentCode,
      newPassword,
      newStatus,
    });

    if (!updatedUser) {
      return next(new ApiError(404, "Account not found"));
    }

    return res.status(200).json(JSend.success(updatedUser));
  } catch (err) {
    console.error(err);
    return res.status(500).json(JSend.error("Internal server error", err));
  }
}

/**
 * Thêm danh sách tài khoản người dùng.
 * @route POST /api/admin/account/bulk
 */
async function addNewAccount(req, res, next) {
  const datas = req.body;

  if (!datas || !Array.isArray(datas)) {
    return res.status(400).json(JSend.fail("Invalid input"));
  }

  try {
    const listAccount = await adminService.addNewAccount(datas);

    if (!listAccount) {
      return next(new ApiError(404, "Insert fail"));
    }

    return res.status(200).json(JSend.success(listAccount));
  } catch (error) {
    console.error(error);
    return res.status(500).json(JSend.error("Internal server error", error));
  }
}

// Student Management
/**
 * Lấy danh sách học viên.
 * @route GET /api/admin/student
 */
async function getStudentList(req, res, next) {
  try {
    const students = await adminService.getStudentList();

    if (!students) {
      return next(new ApiError(404, "Don't have any data"));
    }

    return res.status(200).json(JSend.success(students));
  } catch (error) {
    console.error(error);
    return res.status(500).json(JSend.error("Internal server error", error));
  }
}

/**
 * Nhập danh sách học viên.
 * @route POST /api/admin/student/import
 */
async function importStudentList(req, res, next) {
  const payload = req.body;

  if (!payload || !Array.isArray(payload)) {
    return res.status(400).json(JSend.fail("Invalid input"));
  }

  try {
    const studentList = await adminService.importStudentList(payload);

    if (!studentList) {
      return next(new ApiError(404, "Insert fail"));
    }

    return res.status(200).json(JSend.success(studentList));
  } catch (error) {
    console.error(error);
    return res.status(500).json(JSend.error("Internal server error", error));
  }
}

/**
 * Lấy mã học viên cuối cùng.
 * @route GET /api/admin/student/last-code
 */
async function getLastStudentCode(req, res, next) {
  try {
    const studentCode = await adminService.getLastStudentCode();

    if (!studentCode) {
      return next(new ApiError(404, "Don't have any data"));
    }

    return res.status(200).json(JSend.success(studentCode));
  } catch (error) {
    console.error(error);
    return res.status(500).json(JSend.error("Internal server error", error));
  }
}

/**
 * Thêm học viên mới.
 * @route POST /api/admin/student
 */
async function addNewStudent(req, res, next) {
  const student = req.body;

  if (!student) {
    return res.status(400).json(JSend.fail("Invalid input"));
  }

  try {
    const newStudent = await adminService.addNewStudent(student);

    if (!newStudent) {
      return next(new ApiError(404, "Insert fail"));
    }

    return res.status(200).json(JSend.success(newStudent));
  } catch (error) {
    console.error(error);
    return res.status(500).json(JSend.error("Internal server error", error));
  }
}

/**
 * Cập nhật thông tin học viên.
 * @route PUT /api/admin/student
 */
async function updateStudentInfor(req, res, next) {
  const student = req.body;

  if (!student) {
    return next(new ApiError(404, "Don't have any data"));
  }

  try {
    const studentUpdate = await adminService.updateStudentInfor(student);

    if (!studentUpdate) {
      return next(new ApiError(404, "Don't have any data"));
    }

    return res.status(200).json(JSend.success(studentUpdate));
  } catch (error) {
    console.error(error);
    return res
      .status(500)
      .json(JSend.error("Internal server error", error.message));
  }
}

/**
 * Lấy danh sách mã học viên chưa có tài khoản.
 * @route GET /api/admin/student/available-codes
 */
async function getListStudentCode(req, res, next) {
  try {
    const studentCode = await adminService.getListStudentCode();

    if (!studentCode) {
      return next(new ApiError(404, "Don't have any data"));
    }

    return res.status(200).json(JSend.success(studentCode));
  } catch (error) {
    console.error(error);
    return res.status(500).json(JSend.error("Internal server error", error));
  }
}

/**
 * Lấy danh sách học viên chưa trong lớp.
 * @route GET /api/admin/student/not-in-class?class_subject_id=...
 */
async function getStudentNotInClass(req, res, next) {
  const class_subject_id = req.query.class_subject_id;
  try {
    const listStudent = await adminService.getStudentNotInClass(
      class_subject_id
    );

    if (!listStudent) {
      return next(new ApiError(404, "update fail"));
    }

    return res.status(200).json(JSend.success(listStudent));
  } catch (error) {
    console.error(error);
    return res.status(500).json(JSend.error("Internal server error", error));
  }
}

/**
 * Lấy danh sách học viên đã trong lớp.
 * @route GET /api/admin/student/in-class?class_subject_id=...
 */
async function getStudentInClass(req, res, next) {
  const class_subject_id = req.query.class_subject_id;
  try {
    const listStudent = await adminService.getStudentInClass(class_subject_id);

    if (!listStudent) {
      return next(new ApiError(404, "update fail"));
    }

    return res.status(200).json(JSend.success(listStudent));
  } catch (error) {
    console.error(error);
    return res.status(500).json(JSend.error("Internal server error", error));
  }
}

// Teacher Management
/**
 * Lấy danh sách giảng viên.
 * @route GET /api/admin/teacher
 */
async function getTeacherList(req, res, next) {
  try {
    const teachers = await adminService.getTeacherList();

    if (!teachers) {
      return next(new ApiError(404, "Don't have any data"));
    }

    return res.status(200).json(JSend.success(teachers));
  } catch (error) {
    console.error(error);
    return res.status(500).json(JSend.error("Internal server error", error));
  }
}

/**
 * Lấy mã giảng viên cuối cùng.
 * @route GET /api/admin/teacher/last-code
 */
async function getLastTeacherCode(req, res, next) {
  try {
    const teacherCode = await adminService.getLastTeacherCode();

    if (!teacherCode) {
      return next(new ApiError(404, "Don't have any data"));
    }

    return res.status(200).json(JSend.success(teacherCode));
  } catch (error) {
    console.error(error);
    return res.status(500).json(JSend.error("Internal server error", error));
  }
}

/**
 * Thêm giảng viên mới.
 * @route POST /api/admin/teacher
 */
async function addNewTeacher(req, res, next) {
  const teacher = req.body;

  if (!teacher) {
    return res.status(400).json(JSend.fail("Invalid input"));
  }

  try {
    const newTeacher = await adminService.addNewTeacher(teacher);

    if (!newTeacher) {
      return next(new ApiError(404, "Insert fail"));
    }

    return res.status(200).json(JSend.success(newTeacher));
  } catch (error) {
    console.error(error);
    return res.status(500).json(JSend.error("Internal server error", error));
  }
}

/**
 * Cập nhật thông tin giảng viên.
 * @route PUT /api/admin/teacher
 */
async function updateTeacherInfor(req, res, next) {
  const teacher = req.body;

  if (!teacher) {
    return next(new ApiError(404, "Don't have any data"));
  }

  try {
    const teacherUpdate = await adminService.updateTeacherInfor(teacher);

    if (!teacherUpdate) {
      return next(new ApiError(404, "Don't have any data"));
    }

    return res.status(200).json(JSend.success(teacherUpdate));
  } catch (error) {
    console.error(error);
    return res
      .status(500)
      .json(JSend.error("Internal server error", error.message));
  }
}

/**
 * Lấy danh sách mã giảng viên chưa có tài khoản.
 * @route GET /api/admin/teacher/available-codes
 */
async function getListTeacherCode(req, res, next) {
  try {
    const teacherCode = await adminService.getListTeacherCode();

    if (!teacherCode) {
      return next(new ApiError(404, "Don't have any data"));
    }

    return res.status(200).json(JSend.success(teacherCode));
  } catch (error) {
    console.error(error);
    return res.status(500).json(JSend.error("Internal server error", error));
  }
}

// Class & Enrollment
/**
 * Tạo lớp học với giảng viên.
 * @route POST /api/admin/class
 */
async function createClassWithTeacher(req, res, next) {
  const { classID, moduleID, semesterID, teacherCode } = req.body;

  if (!classID || !moduleID || !semesterID || !teacherCode) {
    return res.status(400).json(JSend.fail("All fields are required"));
  }

  try {
    const newClass = await adminService.createClassWithTeacher({
      classID,
      moduleID,
      semesterID,
      teacherCode,
    });

    if (!newClass) {
      return next(new ApiError(401, "Create class failed"));
    }

    return res.status(201).json(JSend.success(newClass));
  } catch (err) {
    console.error(err);
    return res.status(500).json(JSend.error("Internal server error", err));
  }
}

/**
 * Thêm học viên vào lớp học.
 * @route POST /api/admin/class/add-students
 */
async function addStudentsToClass(req, res, next) {
  const { class_subject_id, student_codes } = req.body;

  if (
    typeof class_subject_id === "undefined" ||
    class_subject_id === null ||
    !Array.isArray(student_codes) ||
    student_codes.length === 0
  ) {
    return res.status(400).json(JSend.fail("Missing or invalid data"));
  }

  try {
    const result = await adminService.addStudentsToClass({
      class_subject_id,
      student_codes,
    });

    return res.status(201).json(JSend.success({ added: result }));
  } catch (err) {
    console.error(err);
    return next(new ApiError(500, "Internal server error"));
  }
}

/**
 * Cập nhật thông tin lớp học.
 * @route PUT /api/admin/class
 */
async function updateClass(req, res, next) {
  const payload = req.body;

  if (!payload) {
    return res.status(400).json(JSend.fail("Invalid input"));
  }

  try {
    const updateData = await adminService.updateClass(payload);

    if (!updateData) {
      return next(new ApiError(404, "update fail"));
    }

    return res.status(200).json(JSend.success(updateData));
  } catch (error) {
    console.error(error);
    return res.status(500).json(JSend.error("Internal server error", error));
  }
}

/**
 * Lấy danh sách lớp và học kỳ tương ứng.
 * @route GET /api/admin/class/with-semester
 */
async function getClassCodeAndSemester(req, res, next) {
  try {
    const listClassWithSemester = await adminService.getClassCodeAndSemester();

    if (!listClassWithSemester) {
      return next(new ApiError(404, "Insert fail"));
    }

    return res.status(200).json(JSend.success(listClassWithSemester));
  } catch (error) {
    console.error(error);
    return res.status(500).json(JSend.error("Internal server error", error));
  }
}

// Module Management
/**
 * Lấy danh sách lớp môn học.
 * @route GET /api/admin/module/list
 */
async function getModuleList(req, res, next) {
  try {
    const listModule = await adminService.getModuleList();

    if (!listModule) {
      return next(new ApiError(404, "Insert fail"));
    }

    return res.status(200).json(JSend.success(listModule));
  } catch (error) {
    console.error(error);
    return res.status(500).json(JSend.error("Internal server error", error));
  }
}

/**
 * Lấy danh sách tất cả module.
 * @route GET /api/admin/module/code
 */
async function getModuleCode(req, res, next) {
  try {
    const listModule = await adminService.getModuleCode();

    if (!listModule) {
      return next(new ApiError(404, "Get fail"));
    }

    return res.status(200).json(JSend.success(listModule));
  } catch (error) {
    console.error(error);
    return res.status(500).json(JSend.error("Internal server error", error));
  }
}

/**
 * Lấy danh sách module có phân lớp.
 * @route GET /api/admin/module/filter
 */
async function getModuleFilter(req, res, next) {
  try {
    const listModule = await adminService.getModuleFilter();

    if (!listModule) {
      return next(new ApiError(404, "Get fail"));
    }

    return res.status(200).json(JSend.success(listModule));
  } catch (error) {
    console.error(error);
    return res.status(500).json(JSend.error("Internal server error", error));
  }
}

// Certificate Management
/**
 * Lấy danh sách chứng chỉ theo lớp môn học.
 * @route GET /api/admin/certificate?class_subject_id=...
 */
async function getCertificates(req, res, next) {
  class_subject_id = req.query.class_subject_id;

  try {
    const listCertificate = await adminService.getCertificates(
      class_subject_id
    );

    if (!listCertificate) {
      return next(new ApiError(404, "Get fail"));
    }

    return res.status(200).json(JSend.success(listCertificate));
  } catch (error) {
    console.error(error);
    return res.status(500).json(JSend.error("Internal server error", error));
  }
}

/**
 * Lấy danh sách học viên đủ điều kiện cấp chứng chỉ.
 * @route GET /api/admin/certificate/eligible
 */
async function getStudentEligible(req, res, next) {
  try {
    const studentList = await adminService.getStudentEligible();

    if (!studentList) {
      return next(new ApiError(404, "Get fail"));
    }

    return res.status(200).json(JSend.success(studentList));
  } catch (error) {
    console.error(error);
    return res.status(500).json(JSend.error("Internal server error", error));
  }
}

/**
 * Thêm chứng chỉ cho học viên.
 * @route POST /api/admin/certificate
 */
async function addCertificates(req, res, next) {
  const { class_subject_id, student_codes } = req.body;

  try {
    const addCert = await adminService.addCertificates({
      class_subject_id,
      student_codes,
    });

    if (!addCert) {
      return next(new ApiError(404, "Add fail"));
    }

    return res.status(200).json(JSend.success(addCert));
  } catch (error) {
    console.error(error);
    return res.status(500).json(JSend.error("Internal server error", error));
  }
}

/**
 * Lấy danh sách lớp đã có chứng chỉ.
 * @route GET /api/admin/certificate/class-list
 */
async function getClassCert(req, res, next) {
  try {
    const listCertClass = await adminService.getClassCert();

    if (!listCertClass) {
      return next(new ApiError(404, "Get fail"));
    }

    return res.status(200).json(JSend.success(listCertClass));
  } catch (error) {
    console.error(error);
    return res.status(500).json(JSend.error("Internal server error", error));
  }
}

// Dash Board Admin
/**
 * Lấy thống kê tổng quan cho dashboard admin.
 * @route GET /api/admin/dashboard
 */
async function getDashboardStats(req, res, next) {
  try {
    const dashBoardStats = await adminService.getDashboardStats();

    if (!dashBoardStats) {
      return next(new ApiError(404, "Get fail"));
    }

    return res.status(200).json(JSend.success(dashBoardStats));
  } catch (error) {
    console.error(error);
    return res.status(500).json(JSend.error("Internal server error", error));
  }
}

/**
 * Lấy thống kê số lượng học viên theo lớp.
 * @route GET /api/admin/dashboard/student-in-class
 */
async function getCountStudentInClass(req, res, next) {
  try {
    const counts = await adminService.getCountStudentInClass();

    if (!counts) {
      return next(new ApiError(404, "Get fail"));
    }

    return res.status(200).json(JSend.success(counts));
  } catch (error) {
    console.error(error);
    return res.status(500).json(JSend.error("Internal server error", error));
  }
}

/**
 * Lấy thống kê học viên có chứng chỉ theo module.
 * @route GET /api/admin/dashboard/module-cert
 */
async function getModuleCertificateStats(req, res, next) {
  try {
    const counts = await adminService.getModuleCertificateStats();

    if (!counts) {
      return next(new ApiError(404, "Get fail"));
    }

    return res.status(200).json(JSend.success(counts));
  } catch (error) {
    console.error(error);
    return res.status(500).json(JSend.error("Internal server error", error));
  }
}

module.exports = {
  // Account Management
  createStudentAccount,
  createTeacherAccount,
  addNewAccount,
  getAccountList,
  updateAccount,
  getTeacherAccount,
  getStudentAccount,

  // Student Management
  getStudentList,
  getLastStudentCode,
  addNewStudent,
  updateStudentInfor,
  importStudentList,
  getListStudentCode,
  getStudentInClass,
  getStudentNotInClass,

  // Teacher Management
  getTeacherList,
  getLastTeacherCode,
  addNewTeacher,
  updateTeacherInfor,
  getListTeacherCode,

  // Class & Enrollment
  createClassWithTeacher,
  updateClass,
  addStudentsToClass,
  getClassCodeAndSemester,

  // Module Management
  getModuleList,
  getModuleCode,
  getModuleFilter,

  // Certificate Management
  getCertificates,
  getStudentEligible,
  addCertificates,
  getClassCert,

  // DashBoard Admin
  getDashboardStats,
  getCountStudentInClass,
  getModuleCertificateStats,
};

```

### backend\src\controllers\auth.controller.js
```js
const authService = require("../models/auth.model");
const JSend = require("../jsend");
const ApiError = require("../api-error");
const jwt = require("jsonwebtoken");

/**
 * Đăng nhập người dùng.
 *
 * @route POST /api/auth/login
 * @param {import('express').Request} req - Yêu cầu HTTP chứa username và password.
 * @param {import('express').Response} res - Phản hồi HTTP trả về token và thông tin người dùng.
 * @param {import('express').NextFunction} next - Middleware xử lý lỗi.
 * @returns {Promise<void>}
 */
async function login(req, res, next) {
  const { username, password } = req.body;

  if (!username || !password) {
    return next(new ApiError(400, "Username and password are required"));
  }

  try {
    const user = await authService.login(username, password);

    if (!user) {
      return next(new ApiError(401, "Invalid username or password"));
    }

    // Tạo JWT token (bạn có thể điều chỉnh secret và thời gian hết hạn)
    const token = jwt.sign(
      {
        id: user.user_id,
        username: user.user_username,
        role: user.user_role,
        status: user.user_status,
      },
      process.env.JWT_SECRET,
      {
        expiresIn: "48h",
      }
    );

    res.json(
      JSend.success({
        message: "Login successful",
        token,
        user: {
          id: user.user_id,
          username: user.user_username,
          role: user.user_role,
          status: user.user_status,
        },
      })
    );
  } catch (error) {
    console.log(error);
    return next(new ApiError(401, "Invalid username or password"));
  }
}

/**
 * Đăng xuất người dùng (huỷ session).
 *
 * @route POST /api/auth/logout
 * @param {import('express').Request} req - Yêu cầu HTTP chứa session hiện tại.
 * @param {import('express').Response} res - Phản hồi xác nhận đăng xuất.
 * @returns {Promise<import('express').Response>}
 */
async function logout(req, res) {
  req.session.destroy();
  return res.status(200).json(JSend.success({ message: "Logout successful" }));
}

module.exports = {
  login,
  logout,
};

```

### backend\src\controllers\errors.controller.js
```js
const ApiError = require('../api-error');
const JSend = require('../jsend');

function methodNotAllowed(req, res, next) {
    if (req.route) {
        // Determine which HTTP methods are supported
        const httpMethods = Object.keys(req.route.methods)
            .filter((method) => method !== '_all')
            .map((method) => method.toUpperCase());
        return next(
            new ApiError(405, 'Method Not Allowed', {
                Allow: httpMethods.join(', '),
            })
        );
    }
    return next();
}

function resourceNotFound(req, res, next) {
    // Handler for unknown URL path.
    // Call next() to pass to the error handling function.
    return next(new ApiError(404, 'Resource not found'));
}

function handleError(error, req, res, next) {
    // The centralized error handling function.
    // In any route handler, calling next(error)
    // will pass to this error handling function.
    if (res.headersSent) {
        return next(error);
    }
    const statusCode = error.statusCode || 500;
    const message = error.message || 'Internal Server Error';
    return res
        .status(statusCode)
        .set(error.headers || {})
        .json(
            statusCode >= 500 ? JSend.error(message) : JSend.fail(message)
        );
}

module.exports = {
    methodNotAllowed,
    resourceNotFound,
    handleError,
};
```

### backend\src\controllers\student.controller.js
```js
const studentService = require("../models/student.model");
const JSend = require("../jsend");
const ApiError = require("../api-error");

/**
 * Lấy tất cả điểm của học viên theo mã học viên.
 *
 * @route GET /api/student/score
 * @param {import('express').Request} req - Request chứa query `studentCode`.
 * @param {import('express').Response} res - Response trả về điểm học viên.
 * @param {import('express').NextFunction} next - Middleware tiếp theo xử lý lỗi.
 */
async function getScore(req, res, next) {
  const studentCode = req.query.studentCode;

  if (!studentCode) {
    return next(new ApiError(400, "Student code is required"));
  }

  try {
    const score = await studentService.getAllSubjectScore(studentCode);

    if (!score) {
      return next(new ApiError(401, "Data not found"));
    }

    return res.json(JSend.success(score));
  } catch (error) {
    console.log(error);
    return next(new ApiError(401, "Invalid student code or data not found"));
  }
}

/**
 * Lấy điểm học viên theo học kỳ.
 *
 * @route GET /api/student/score/semester
 * @param {import('express').Request} req - Query gồm `studentCode` và `semester`.
 * @param {import('express').Response} res - Response trả về danh sách điểm theo học kỳ.
 * @param {import('express').NextFunction} next - Middleware tiếp theo xử lý lỗi.
 */
async function getScoreBySemester(req, res, next) {
  const { studentCode, semester } = req.query;

  if (!studentCode || !semester) {
    return next(new ApiError(400, "Student code and Semester is required"));
  }

  try {
    const score = await studentService.filterSubjectScoreBySemester(
      studentCode,
      semester
    );

    if (!score) {
      return next(new ApiError(401, "Data not found"));
    }

    if (score.length === 0) {
      return next(
        new ApiError(
          404,
          "The student don't have scores found in this semester"
        )
      );
    }

    return res.json(JSend.success(score));
  } catch (error) {
    console.log(error);
    return next(new ApiError(401, "Invalid student code or data not found"));
  }
}

/**
 * Lấy thông tin học viên theo mã học viên.
 *
 * @route GET /api/student/info
 * @param {import('express').Request} req - Query chứa `studentCode`.
 * @param {import('express').Response} res - Response trả về thông tin học viên.
 * @param {import('express').NextFunction} next - Middleware tiếp theo xử lý lỗi.
 */
async function getStudentInfo(req, res, next) {
  const studentCode = req.query.studentCode;

  if (!studentCode) {
    return next(new ApiError(400, "Student code is required"));
  }

  try {
    const studentInfo = await studentService.getStudentInfo(studentCode);

    if (!studentInfo) {
      return next(new ApiError(401, "Data not found"));
    }

    return res.json(JSend.success(studentInfo));
  } catch (error) {
    console.log(error);
    return next(new ApiError(401, "Invalid student code or data not found"));
  }
}

/**
 * Cập nhật thông tin học viên.
 *
 * @route PUT /api/student/info
 * @param {import('express').Request} req - Query gồm `studentCode`, body chứa các trường thông tin cần cập nhật.
 * @param {import('express').Response} res - Response xác nhận cập nhật thành công.
 * @param {import('express').NextFunction} next - Middleware tiếp theo xử lý lỗi.
 */
async function updateStudentInfo(req, res, next) {
  const studentCode = req.query.studentCode;
  if (!studentCode) {
    return next(new ApiError(400, "Student code is required"));
  }

  const {
    student_date_of_birth,
    student_address,
    student_email,
    student_phone,
    student_IDCard,
    student_country,
    student_gender,
  } = req.body;

  if (
    !student_address ||
    !student_email ||
    !student_phone ||
    !student_IDCard ||
    !student_country
  ) {
    return next(new ApiError(400, "All fields are required"));
  }
  //   let dateOfBirth = null;
  //   if (student_date_of_birth) {
  //     dateOfBirth = moment(student_date_of_birth, "MM-DD-YYYY").format(
  //       "YYYY-MM-DD"
  //     );
  //   }

  const updateData = {
    student_date_of_birth,
    student_address,
    student_email,
    student_phone,
    student_IDCard,
    student_country,
    student_gender,
  };

  try {
    const updatedStudent = await studentService.updateStudentInfo(
      studentCode,
      updateData
    );
    if (!updatedStudent) {
      return next(new ApiError(401, "Data not found"));
    }

    return res.json(JSend.success(updateData));
  } catch (error) {
    console.log(error);
    return next(new ApiError(401, "Infomation not valid or data not found"));
  }
}

/**
 * Lấy danh sách chứng chỉ của học viên.
 *
 * @route GET /api/student/certificates
 * @param {import('express').Request} req - Query chứa `studentCode`.
 * @param {import('express').Response} res - Response trả về danh sách chứng chỉ của học viên.
 * @param {import('express').NextFunction} next - Middleware tiếp theo xử lý lỗi.
 */
async function getCertificatesOfStudent(req, res, next) {
  const studentCode = req.query.studentCode;

  try {
    const listCerts = await studentService.getCertificatesOfStudent(
      studentCode
    );
    if (!listCerts) {
      return next(new ApiError(401, "Data not found"));
    }

    return res.json(JSend.success(listCerts));
  } catch (error) {
    console.log(error);
    return next(new ApiError(401, "Infomation not valid or data not found"));
  }
}

module.exports = {
  getScore,
  getScoreBySemester,
  getStudentInfo,
  updateStudentInfo,
  getCertificatesOfStudent,
};

```

### backend\src\controllers\teacher.controller.js
```js
const teacherService = require("../models/teacher.model");
const JSend = require("../jsend");
const ApiError = require("../api-error");
const moment = require("moment");

async function getTeacherInfo(req, res, next) {
  const teacherCode = req.query.teacherCode;

  if (!teacherCode) {
    return next(new ApiError(400, "teacher code is required"));
  }

  try {
    const teacherInfo = await teacherService.getTeacherInfo(teacherCode);

    if (!teacherInfo) {
      return next(new ApiError(401, "Data not found"));
    }

    return res.json(JSend.success(teacherInfo));
  } catch (error) {
    console.log(error);
    return next(new ApiError(401, "Invalid teacher code or data not found"));
  }
}

async function updateTeacherInfo(req, res, next) {
  const teacherCode = req.query.teacherCode;
  if (!teacherCode) {
    return next(new ApiError(400, "Teacher code is required"));
  }

  const {
    teacher_date_of_birth,
    teacher_gender,
    teacher_address,
    teacher_email,
    teacher_phone,
  } = req.body;

  if (
    !teacher_date_of_birth ||
    !teacher_gender ||
    !teacher_address ||
    !teacher_email ||
    !teacher_phone
  ) {
    return next(new ApiError(400, "All fields are required"));
  }
  let dateOfBirth = null;
  if (teacher_date_of_birth) {
    dateOfBirth = moment(teacher_date_of_birth, "DD-MM-YYYY").format(
      "YYYY-MM-DD"
    );
  }

  const updateData = {
    teacher_date_of_birth: dateOfBirth,
    teacher_gender,
    teacher_address,
    teacher_email,
    teacher_phone,
  };

  try {
    const updatedTeacher = await teacherService.updateTeacherInfo(
      teacherCode,
      updateData
    );
    if (!updatedTeacher) {
      return next(new ApiError(401, "Data not found"));
    }

    return res.json(JSend.success(updateData));
  } catch (error) {
    console.log(error);
    return next(new ApiError(401, "Infomation not valid or data not found"));
  }
}

async function getModuleTeaching(req, res, next) {
  const teacherCode = req.query.teacherCode;

  if (!teacherCode) {
    return next(new ApiError(400, "teacher code is required"));
  }

  try {
    const moduleTeaching = await teacherService.getModuleTeaching(teacherCode);

    if (!moduleTeaching) {
      return next(new ApiError(401, "Data not found"));
    }

    return res.json(JSend.success(moduleTeaching));
  } catch (error) {
    console.log(error);
    return next(new ApiError(401, "Invalid teacher code or data not found"));
  }
}

async function getStudentInClass(req, res, next) {
  const { teacherCode, moduleCode, classCode } = req.query;

  if (!teacherCode || !moduleCode || !classCode) {
    return next(new ApiError(400, "All parameters are required"));
  }

  try {
    const students = await teacherService.getStudentInClass({
      teacherCode,
      moduleCode,
      classCode,
    });

    if (!students) {
      return next(new ApiError(401, "Data not found"));
    }

    return res.json(JSend.success(students));
  } catch (error) {
    console.log(error);
    return next(new ApiError(401, "Invalid parameters or data not found"));
  }
}

async function updateStudentScore(req, res, next) {
  const { classSubjectId, studentCode, score } = req.body;

  if (
    !classSubjectId ||
    !studentCode ||
    score === undefined ||
    score === null
  ) {
    return next(new ApiError(400, "All parameters are required"));
  }

  try {
    const scores = await teacherService.updateStudentScore(
      classSubjectId,
      studentCode,
      score
    );

    if (!scores) {
      return next(new ApiError(401, "Data not found"));
    }

    return res.json(JSend.success(scores));
  } catch (error) {
    console.log(error);
    return next(new ApiError(401, "Invalid parameters or data not found"));
  }
}

async function getStudentPassing(req, res, next) {
  const teacherCode = req.query.teacherCode;

  if (!teacherCode) {
    return next(new ApiError(400, "teacher code is required"));
  }

  try {
    const students = await teacherService.getStudentPassing(teacherCode);

    if (!students) {
      return next(new ApiError(401, "Data not found"));
    }

    return res.json(JSend.success(students));
  } catch (error) {
    console.log(error);
    return next(new ApiError(401, `${error.message}`));
  }
}

async function getPassingPropotion(req, res, next) {
  const teacherCode = req.query.teacherCode;

  if (!teacherCode) {
    return next(new ApiError(400, "teacher code is required"));
  }

  try {
    const students = await teacherService.getPassingPropotion(teacherCode);

    if (!students) {
      return next(new ApiError(401, "Data not found"));
    }

    return res.json(JSend.success(students));
  } catch (error) {
    console.log(error);
    return next(new ApiError(401, `${error.message}`));
  }
}

async function getAvgScore(req, res, next) {
  const teacherCode = req.query.teacherCode;

  if (!teacherCode) {
    return next(new ApiError(400, "teacher code is required"));
  }

  try {
    const students = await teacherService.getAvgScore(teacherCode);

    if (!students) {
      return next(new ApiError(401, "Data not found"));
    }

    return res.json(JSend.success(students));
  } catch (error) {
    console.log(error);
    return next(new ApiError(401, `${error.message}`));
  }
}

async function getStudentCodeByName(req, res, next) {
  const { studentMiddleName, studentName } = req.query;

  if (!studentMiddleName || !studentName) {
    return next(
      new ApiError(
        400,
        "Both student middle name and student name are required"
      )
    );
  }

  try {
    const studentCode = await teacherService.getStudentCodeByName(
      studentMiddleName,
      studentName
    );

    if (!studentCode) {
      return next(new ApiError(401, "Data not found"));
    }

    return res.json(JSend.success(studentCode));
  } catch (error) {
    console.log(error);
    return next(new ApiError(401, "Invalid parameters or data not found"));
  }
}

async function importStudentScores(req, res, next) {
  const { classSubjectId, students } = req.body;

  if (!classSubjectId || !students || !Array.isArray(students)) {
    return next(new ApiError(400, "Invalid input data"));
  }

  try {
    const result = await teacherService.importStudentScores(
      classSubjectId,
      students
    );

    /*
	{
	Testing data structure:
		"classSubjectId" : "2",
		"students" : [
			{"student_code": "0092/24-THUD", "score": ""},
			{"student_code": "0093/24-THUD", "score": 3.006666666666667},
			{"student_code": "0094/24-THUD", "score": 3.8},
			{"student_code": "0095/24-THUD", "score": 7.466666666666667},
			{"student_code": "0096/24-THUD", "score": 5},
			{"student_code": "0097/24-THUD", "score": 6},
			{"student_code": "0098/24-THUD", "score": 7},
			{"student_code": "0099/24-THUD", "score": 8},
			{"student_code": "0100/24-THUD", "score": 9},
			{"student_code": "0101/24-THUD", "score": 10}
		]
	}
	*/

    if (!result) {
      return next(new ApiError(401, "Data not found"));
    }

    return res.json(JSend.success(result));
  } catch (error) {
    console.log(error);
    return next(new ApiError(401, "Invalid parameters or data not found"));
  }
}

async function getScoreProgress(req, res, next) {
  const teacherCode = req.query.teacherCode;
  if (!teacherCode) {
    return next(new ApiError(400, "teacher code is required"));
  }

  try {
    const progress = await teacherService.getScoreProgress(teacherCode);

    if (!progress) {
      return next(new ApiError(401, "Data not found"));
    }

    return res.json(JSend.success(progress));
  } catch (error) {
    console.log(error);
    return next(new ApiError(401, `${error.message}`));
  }
}

async function getCountTeaching(req, res, next) {
  const teacherCode = req.query.teacherCode;

  if (!teacherCode) {
    return next(new ApiError(400, "teacher code is required"));
  }

  try {
    const count = await teacherService.getCountTeaching(teacherCode);

    if (count === null) {
      return next(new ApiError(401, "Data not found"));
    }

    return res.json(JSend.success(count));
  } catch (error) {
    console.log(error);
    return next(new ApiError(401, `${error.message}`));
  }
}

async function getLastUpdate(req, res, next) {
  const teacherCode = req.query.teacherCode;
  if (!teacherCode) {
    return next(new ApiError(400, "teacher code is required"));
  }
  try {
    const lastUpdate = await teacherService.getLastUpdate(teacherCode);

    if (!lastUpdate) {
      return next(new ApiError(401, "Data not found"));
    }

    const updatedAt = Object.values(lastUpdate)[0]; // lấy giá trị từ 'max(`updated_at`)' key
    const formatted = moment(updatedAt).format("HH:mm DD/MM/YYYY ");

    return res.json(JSend.success(formatted));
  } catch (error) {
    console.log(error);
    return next(new ApiError(401, `${error.message}`));
  }
}

module.exports = {
  // READ
  getTeacherInfo,
  getModuleTeaching,
  getStudentInClass,
  getStudentPassing,
  getPassingPropotion,
  getAvgScore,
  getStudentCodeByName,
  getScoreProgress,
  getCountTeaching,
  getLastUpdate,

  // UPDATE
  updateTeacherInfo,
  updateStudentScore,

  // BULK
  importStudentScores,
};

```

### backend\src\middlewares\auth.middleware.js
```js

```

### backend\src\models\admin.model.js
```js
const knex = require("../database/knex");
const moment = require("moment");

const admin = {
  // Account Management
  /**
   * Tạo tài khoản học viên mới.
   * @param {Object} param0 - Thông tin tài khoản.
   * @param {string} param0.username - Tên đăng nhập.
   * @param {string} param0.password - Mật khẩu.
   * @returns {Promise<Object|null>} Tài khoản vừa tạo hoặc null nếu thất bại.
   */
  createStudentAccount: async ({ username, password }) => {
    const student = await knex("system_user").insert({
      user_username: username,
      user_pass: password,
    });

    if (student.length > 0) {
      // Knex insert returns an array of IDs for MySQL; fetch the inserted record
      const insertedStudent = await knex("system_user")
        .where({ user_username: username })
        .first();
      return insertedStudent;
    }

    return null;
  },

  /**
   * Tạo tài khoản giảng viên mới.
   * @param {Object} param0 - Thông tin tài khoản.
   * @param {string} param0.username - Tên đăng nhập.
   * @param {string} param0.password - Mật khẩu.
   * @returns {Promise<Object|null>} Tài khoản vừa tạo hoặc null nếu thất bại.
   */
  createTeacherAccount: async ({ username, password }) => {
    const teacher = await knex("system_user").insert({
      user_username: username,
      user_pass: password,
      user_role: 2, // Assuming a role field exists
    });

    if (teacher.length > 0) {
      // Knex insert returns an array of IDs for MySQL; fetch the inserted record
      const insertedTeacher = await knex("system_user")
        .where({ user_username: username })
        .first();
      return insertedTeacher;
    }

    return null;
  },

  /**
   * Thêm nhiều tài khoản hệ thống.
   * @param {Array<Object>} datas - Danh sách tài khoản.
   * @returns {Promise<Array<Object>|null>} Danh sách tài khoản đã thêm.
   */

  addNewAccount: async (datas) => {
    const inserted = [];

    for (const data of datas) {
      try {
        const newAccount = await knex("system_user").insert({
          user_username: data.username,
          user_pass: data.pass,
          user_role: data.role,
        });

        if (newAccount) {
          inserted.push({
            user_username: data.username,
            user_pass: data.pass,
            user_role: data.role,
          });
        }
      } catch (err) {
        console.error("Lỗi khi thêm tài khoản:", data.username, err);
        // Bạn có thể bỏ qua hoặc xử lý thêm ở đây
      }
    }

    return inserted.length > 0 ? inserted : null;
  },

  /**
   * Kiểm tra tài khoản theo username.
   * @param {string} username - Tên đăng nhập.
   * @returns {Promise<Object|null>} Thông tin tài khoản nếu tồn tại.
   */
  checkUserAccount: async (username) => {
    const user = await knex("system_user")
      .where({ user_username: username })
      .first();

    if (user) {
      return user;
    }

    return null;
  },

  /**
   * Lấy danh sách tài khoản không phải admin.
   * @returns {Promise<Array<Object>|null>} Danh sách tài khoản người dùng.
   */
  getAccountList: async () => {
    const users = await knex("system_user")
      .select("*")
      .whereNot({ user_role: 0 }) // 0 = admin
      .orderBy("user_role", "asc")
      .orderBy("user_username", "asc");

    if (users.length === 0) return null;

    const result = [];

    for (const user of users) {
      let roleName = "";
      let extraInfo = null;

      if (user.user_role === 1) {
        roleName = "Học viên";
        extraInfo = await knex("student")
          .select(
            "student_middle_name",
            "student_name",
            "student_email",
            "student_phone"
          )
          .where({ student_code: user.user_username })
          .first();
      } else if (user.user_role === 2) {
        roleName = "Giảng viên";
        extraInfo = await knex("teacher")
          .select("teacher_name", "teacher_email", "teacher_phone")
          .where({ teacher_code: user.user_username })
          .first();
      }

      result.push({
        user_id: user.user_id,
        user_username: user.user_username,
        user_pass: user.user_pass,
        user_role: roleName,
        user_status: user.user_status,
        info: extraInfo || null,
      });
    }

    return result;
  },

  /**
   * Lấy danh sách tài khoản học viên.
   * @returns {Promise<Array<Object>|null>} Danh sách tài khoản học viên.
   */
  getStudentAccount: async () => {
    const users = await knex("system_user").select("*").where({
      user_role: 1, // Assuming 1 is the role for students
    });

    if (users.length === 0) {
      return null;
    }

    const result = [];

    for (const user of users) {
      let extraInfo = null;
      let roleName = "";
      roleName = "Học viên";
      extraInfo = await knex("student")
        .select(
          "student_middle_name",
          "student_name",
          "student_email",
          "student_phone"
        )
        .where({ student_code: user.user_username })
        .first();

      result.push({
        user_id: user.user_id,
        user_username: user.user_username,
        user_pass: user.user_pass,
        user_role: roleName,
        user_status: user.user_status,
        info: extraInfo || null,
      });
    }

    return result;
  },

  /**
   * Lấy danh sách tài khoản giảng viên.
   * @returns {Promise<Array<Object>|null>} Danh sách tài khoản giảng viên.
   */
  getTeacherAccount: async () => {
    const users = await knex("system_user").select("*").where({
      user_role: 2, // Assuming 2 is the role for teachers
    });

    if (users.length === 0) {
      return null;
    }

    const result = [];

    for (const user of users) {
      let extraInfo = null;
      let roleName = "";
      roleName = "Giảng viên";
      extraInfo = await knex("teacher")
        .select("teacher_name", "teacher_email", "teacher_phone")
        .where({ teacher_code: user.user_username })
        .first();

      result.push({
        user_id: user.user_id,
        user_username: user.user_username,
        user_pass: user.user_pass,
        user_role: roleName,
        user_status: user.user_status,
        info: extraInfo || null,
      });
    }

    return result;
  },

  /**
   * Cập nhật mật khẩu hoặc trạng thái tài khoản.
   * @param {Object} param0 - Dữ liệu cập nhật.
   * @param {string} param0.currentCode - Username cần cập nhật.
   * @param {string} [param0.newPassword] - Mật khẩu mới.
   * @param {number} [param0.newStatus] - Trạng thái tài khoản mới.
   * @returns {Promise<number>} Số bản ghi được cập nhật.
   */
  updateAccount: async ({ currentCode, newPassword, newStatus }) => {
    const updates = {};

    // chỉ thêm nếu có giá trị
    if (typeof newPassword === "string" && newPassword.trim() !== "") {
      updates.user_pass = newPassword.trim();
    }

    if (typeof newStatus === "number") {
      updates.user_status = newStatus;
    }

    // nếu không có gì để update, thì báo lỗi
    if (Object.keys(updates).length === 0) {
      throw new Error("No valid fields provided for update.");
    }

    const updatedRows = await knex("system_user")
      .where({ user_username: currentCode })
      .update(updates);

    return updatedRows;
  },

  // Student Management
  /**
   * Lấy danh sách học viên.
   * @returns {Promise<Array<Object>|null>} Danh sách học viên.
   */
  getStudentList: async () => {
    const students = await knex("student").select("*");

    if (students.length === 0) {
      return null;
    }

    const result = [];
    let formatted = 0;
    for (const student of students) {
      if (student.student_date_of_birth) {
        const dateOfBirth = student.student_date_of_birth; // lấy giá trị từ 'max(`updated_at`)' key
        formatted = moment(dateOfBirth).format("DD/MM/YYYY ");
      }

      result.push({
        student_code: student.student_code,
        student_middle_name: student.student_middle_name,
        student_name: student.student_name,
        student_date_of_birth: formatted,
        student_gender: student.student_gender,
        student_address: student.student_address,
        student_email: student.student_email,
        student_phone: student.student_phone,
        student_status: student.student_status,
        student_IDCard: student.student_IDCard,
        student_country: student.student_country,
      });
    }

    return result;
  },

  /**
   * Lấy mã học viên cuối cùng.
   * @returns {Promise<Object|null>} Mã học viên mới nhất.
   */
  getLastStudentCode: async () => {
    const stCode = await knex("student")
      .select("student_code")
      .orderBy("student_code", "desc")
      .limit(1);

    if (!stCode) {
      return null;
    }

    return stCode[0];
  },

  /**
   * Thêm một học viên mới.
   * @param {Object} student - Dữ liệu học viên.
   * @returns {Promise<Object|null>} Thông tin học viên đã thêm.
   */
  addNewStudent: async (student) => {
    let formatted = 0;
    const inserted = [];
    if (student.student_date_of_birth) {
      formatted = moment(student.student_date_of_birth, "DD/MM/YYYY").format(
        "YYYY-MM-DD"
      );
    }
    const newStudent = await knex("student").insert({
      student_code: student.student_code,
      student_middle_name: student.student_middle_name,
      student_name: student.student_name,
      student_phone: student.student_phone,
    });

    if (newStudent) {
      inserted.push({
        student_code: student.student_code,
        student_middle_name: student.student_middle_name,
        student_name: student.student_name,
        student_phone: student.student_phone,
      });
      return inserted[0];
    }

    return null;
  },

  /**
   * Cập nhật thông tin học viên.
   * @param {Object} student - Dữ liệu học viên cần cập nhật.
   * @returns {Promise<Object|null>} Thông tin cập nhật.
   */
  updateStudentInfor: async (student) => {
    const updateCount = await knex("student")
      .where({ student_code: student.student_code })
      .update({
        // student_code: student.student_code,
        student_middle_name: student.student_middle_name,
        student_name: student.student_name,
        student_status: student.student_status,
      });

    if (updateCount === 0) return null;

    return { message: "Cập nhật thành công", updated: updateCount };
  },

  /**
   * Nhập danh sách học viên từ tệp.
   * @param {Array<Object>} students - Danh sách học viên.
   * @returns {Promise<Object>} Kết quả chèn và danh sách bỏ qua.
   */
  importStudentList: async (students) => {
    const inserted = [];
    const skipped = [];
    for (const student of students) {
      try {
        const exists = await knex("student")
          .where({
            student_middle_name: student.student_middle_name,
            student_name: student.student_name,
          })
          .select("*")
          .first();

        if (exists) {
          skipped.push(
            student.student_middle_name + " " + student.student_name
          );
          continue;
        }

        if (student.student_middle_name === "" || student.student_name === "") {
          skipped.push(
            student.student_middle_name + " " + student.student_name
          );
          continue;
        }

        let formatted = 0;
        if (student.student_date_of_birth) {
          formatted = moment(
            student.student_date_of_birth,
            "DD/MM/YYYY"
          ).format("YYYY-MM-DD");
        }

        if (
          student.student_gender === null ||
          student.student_gender === "" ||
          student.student_gender === undefined
        ) {
          student.student_gender = "other";
        }

        await knex("student").insert({
          student_code: student.student_code,
          student_middle_name: student.student_middle_name,
          student_name: student.student_name,
          student_date_of_birth: formatted,
          student_gender: student.student_gender,
        });
        inserted.push(student.student_middle_name + " " + student.student_name);
      } catch (error) {
        console.error(
          `Error processing student ${student.student_code}:`,
          error
        );
        continue;
      }
    }
    // console.log("skip: \n" + skipped);
    // console.log("insert: \n" + inserted);
    return {
      insertedCount: inserted.length,
      inserted,
      skipped,
    };
  },

  /**
   * Lấy danh sách học viên chưa có tài khoản hệ thống.
   * @returns {Promise<Array<Object>|null>} Danh sách học viên.
   */
  getListStudentCode: async () => {
    const result = await knex("student")
      .select("student_code", "student_middle_name", "student_name")
      .whereNotIn("student_code", function () {
        this.select("user_username").from("system_user");
      });

    if (result.length == 0) {
      return null;
    }

    return result;
  },

  /**
   * Lấy danh sách học viên đã đăng ký vào lớp.
   * @param {number} class_subject_id - ID lớp môn học.
   * @returns {Promise<Array<Object>|null>} Danh sách học viên.
   */
  getStudentInClass: async (class_subject_id) => {
    const result = await knex("student")
      .select("student_code", "student_middle_name", "student_name")
      .whereIn("student_code", function () {
        this.select("student_code")
          .from("class_student")
          .where({ class_subject_id: class_subject_id });
      });

    if (result.length == 0) return null;

    return result;
  },

  /**
   * Lấy danh sách học viên chưa đăng ký lớp.
   * @param {number} class_subject_id - ID lớp môn học.
   * @returns {Promise<Array<Object>|null>} Danh sách học viên.
   */
  getStudentNotInClass: async (class_subject_id) => {
    const result = await knex("student")
      .select("student_code", "student_middle_name", "student_name")
      .whereNotIn("student_code", function () {
        this.select("student_code")
          .from("class_student")
          .where({ class_subject_id: class_subject_id });
      });

    if (result.length == 0) return null;

    return result;
  },

  // Teacher Management
  /**
   * Lấy danh sách giảng viên.
   * @returns {Promise<Array<Object>|null>} Danh sách giảng viên.
   */
  getTeacherList: async () => {
    const teachers = await knex("teacher").select("*");

    if (teachers.length === 0) {
      return null;
    }

    const result = [];
    let formatted = 0;
    for (const teacher of teachers) {
      if (teacher.teacher_date_of_birth) {
        const dateOfBirth = teacher.teacher_date_of_birth; // lấy giá trị từ 'max(`updated_at`)' key
        formatted = moment(dateOfBirth).format("DD/MM/YYYY ");
      }

      result.push({
        teacher_code: teacher.teacher_code,
        teacher_name: teacher.teacher_name,
        teacher_date_of_birth: formatted,
        teacher_gender: teacher.teacher_gender,
        teacher_address: teacher.teacher_address,
        teacher_email: teacher.teacher_email,
        teacher_phone: teacher.teacher_phone,
        teacher_status: teacher.teacher_status,
      });
    }

    return result;
  },

  /**
   * Lấy mã giảng viên cuối cùng.
   * @returns {Promise<Object|null>} Mã giảng viên cuối.
   */
  getLastTeacherCode: async () => {
    const teacherCode = await knex("teacher")
      .select("teacher_code")
      .orderBy("teacher_code", "desc")
      .limit(1);

    if (!teacherCode) {
      return null;
    }

    return teacherCode[0];
  },

  /**
   * Thêm giảng viên mới.
   * @param {Object} teacher - Dữ liệu giảng viên.
   * @returns {Promise<Object|null>} Thông tin giảng viên.
   */
  addNewTeacher: async (teacher) => {
    const inserted = [];
    console.log(teacher.teacher_date_of_birth);
    const newTeacher = await knex("teacher").insert({
      teacher_code: teacher.teacher_code,
      teacher_name: teacher.teacher_name,
      teacher_date_of_birth: teacher.teacher_date_of_birth,
      teacher_gender: teacher.teacher_gender,
      teacher_address: teacher.teacher_address,
      teacher_email: teacher.teacher_email,
      teacher_phone: teacher.teacher_phone,
    });

    if (newTeacher) {
      inserted.push({
        teacher_code: teacher.teacher_code,
        teacher_name: teacher.teacher_name,
        teacher_date_of_birth: teacher.teacher_date_of_birth,
        teacher_gender: teacher.teacher_gender,
        teacher_address: teacher.teacher_address,
        teacher_email: teacher.teacher_email,
        teacher_phone: teacher.teacher_phone,
      });
      return inserted[0];
    }

    return null;
  },

  /**
   * Cập nhật thông tin giảng viên.
   * @param {Object} teacher - Dữ liệu giảng viên cần cập nhật.
   * @returns {Promise<Object|null>} Thông tin cập nhật.
   */
  updateTeacherInfor: async (teacher) => {
    let updateCount = 0;
    if (teacher.teacher_date_of_birth) {
      updateCount = await knex("teacher")
        .where({ teacher_code: teacher.teacher_code })
        .update({
          teacher_name: teacher.teacher_name,
          teacher_date_of_birth: teacher.teacher_date_of_birth,
          teacher_gender: teacher.teacher_gender,
          teacher_address: teacher.teacher_address,
          teacher_email: teacher.teacher_email,
          teacher_phone: teacher.teacher_phone,
          teacher_status: teacher.teacher_status,
        });
    } else {
      updateCount = await knex("teacher")
        .where({ teacher_code: teacher.teacher_code })
        .update({
          teacher_name: teacher.teacher_name,
          teacher_gender: teacher.teacher_gender,
          teacher_address: teacher.teacher_address,
          teacher_email: teacher.teacher_email,
          teacher_phone: teacher.teacher_phone,
          teacher_status: teacher.teacher_status,
        });
    }

    if (updateCount === 0) return null;

    return { message: "Cập nhật thành công", updated: updateCount };
  },

  /**
   * Lấy danh sách giảng viên chưa có tài khoản hệ thống.
   * @returns {Promise<Array<Object>|null>} Danh sách giảng viên.
   */
  getListTeacherCode: async () => {
    const result = await knex("teacher")
      .select("teacher_code", "teacher_name")
      .whereNotIn("teacher_code", function () {
        this.select("user_username").from("system_user");
      });

    if (!result) {
      return null;
    }

    return result;
  },

  // Class & Enrollment
  /**
   * Tạo lớp học với giảng viên.
   * @param {Object} data - Dữ liệu lớp học.
   * @returns {Promise<Object>} Lớp học vừa tạo.
   */
  createClassWithTeacher: async ({
    classID,
    moduleID,
    semesterID,
    teacherCode,
  }) => {
    const trx = await knex.transaction();
    try {
      const [clsId] = await trx("class_subject").insert({
        class_id: classID,
        module_id: moduleID,
        semester_id: semesterID,
      });

      if (!clsId) {
        throw new Error("Failed to insert class_subject");
      }

      await trx("teacher_subject_class").insert({
        teacher_code: teacherCode,
        class_subject_id: clsId,
      });

      await trx.commit();
      const newClass = await knex("class_subject")
        .where("class_subject.class_subject_id", clsId)
        .join("class", "class_subject.class_id", "class.class_id")
        .join("module", "class_subject.module_id", "module.module_id")
        .join("semester", "class_subject.semester_id", "semester.semester_id")
        .join(
          "teacher_subject_class",
          "class_subject.class_subject_id",
          "teacher_subject_class.class_subject_id"
        )
        .join(
          "teacher",
          "teacher_subject_class.teacher_code",
          "teacher.teacher_code"
        )
        .select(
          "class_subject.class_subject_id",
          "module.module_name",
          "class.class_name",
          "semester.semester_number",
          "teacher.teacher_name"
        )
        .first();

      return newClass;
    } catch (error) {
      await trx.rollback();
      console.error("Error creating class_subject:", error.message);
      throw error;
    }
  },

  /**
   * Cập nhật lớp học.
   * @param {Object} payload - Dữ liệu lớp học cần cập nhật.
   * @returns {Promise<Object>} Kết quả cập nhật.
   */
  updateClass: async (payload) => {
    if (!payload.classSubjectID) {
      throw new Error("Thiếu class_subject_id");
    }

    const trx = await knex.transaction();
    try {
      const updateStatus = await trx("class_subject")
        .where({ class_subject_id: payload.classSubjectID })
        .update({
          semester_id: payload.semesterID,
          class_status: payload.classStatus,
        });

      const exist = await trx("teacher_subject_class")
        .select("*")
        .where({ class_subject_id: payload.classSubjectID });

      if (exist.length === 0) {
        await trx("teacher_subject_class").insert({
          teacher_code: payload.teacherCode,
          class_subject_id: payload.classSubjectID,
        });
      } else {
        await trx("teacher_subject_class")
          .update({ teacher_code: payload.teacherCode })
          .where({ class_subject_id: payload.classSubjectID });
      }

      await trx.commit();

      return {
        class_subject_updated: updateStatus,
        teacher_updated: payload.teacherCode,
      };
    } catch (error) {
      await trx.rollback();
      console.error("Error updating class_subject:", error.message);
      throw error;
    }
  },

  /**
   * Thêm học viên vào lớp học.
   * @param {Object} data - Danh sách học viên.
   * @returns {Promise<Array<string>>} Mã học viên đã thêm.
   */
  addStudentsToClass: async ({ class_subject_id, student_codes }) => {
    const trx = await knex.transaction();
    try {
      // Kiểm tra class_subject_id có tồn tại không
      const classSubject = await trx("class_subject")
        .where({ class_subject_id })
        .first();

      if (!classSubject) {
        throw new Error("Class subject not found");
      }

      const students = [];

      for (const studentCode of student_codes) {
        try {
          // Thêm vào class_student
          await trx("class_student").insert({
            class_subject_id,
            student_code: studentCode,
          });

          // Thêm vào score (với điểm NULL ban đầu)
          await trx("score").insert({
            class_subject_id,
            student_code: studentCode,
            score: null, // optional vì mặc định đã là null
          });

          students.push(studentCode);
        } catch (err) {
          // Nếu bị duplicate (đã tồn tại trong class_student hoặc score), ghi log và bỏ qua
          console.error("Lỗi khi thêm sinh viên:", err.message);

          // Nếu lỗi không phải duplicate thì rollback
          if (!err.message.includes("duplicate")) {
            throw err;
          }
        }
      }

      await trx.commit();
      return students;
    } catch (error) {
      await trx.rollback();
      console.error("Error adding students to class subject:", error.message);
      throw error;
    }
  },

  /**
   * Lấy danh sách lớp và học kỳ.
   * @returns {Promise<Array<Object>>} Danh sách lớp và học kỳ.
   */
  getClassCodeAndSemester: async () => {
    const classes = await knex("class").select("*");
    const result = [];

    if (classes && classes.length > 0) {
      for (const classItem of classes) {
        const semester = await knex("semester")
          .select("*")
          .where({ class_id: classItem.class_id });

        result.push({ class: classItem, semesters: semester });
      }
    }

    return result;
  },

  // Module Management
  /**
   * Lấy danh sách tất cả module.
   * @returns {Promise<Array<Object>|null>} Danh sách module.
   */
  getModuleCode: async () => {
    const module = await knex("module").select("*");

    if (!module) {
      return null;
    }

    return module;
  },

  /**
   * Lấy danh sách môn học đã phân lớp.
   * @returns {Promise<Array<Object>|null>} Danh sách lớp môn học.
   */
  getModuleList: async () => {
    const result = await knex("class_subject as cs")
      .join("class as c", "cs.class_id", "c.class_id")
      .join("module as m", "cs.module_id", "m.module_id")
      .join("semester as s", "cs.semester_id", "s.semester_id")
      .leftJoin(
        "teacher_subject_class as tsc",
        "cs.class_subject_id",
        "tsc.class_subject_id"
      )
      .leftJoin("teacher as t", "tsc.teacher_code", "t.teacher_code")
      .select(
        "cs.class_subject_id",
        "c.class_id",
        "c.class_code",
        "c.class_name",
        "m.module_code",
        "m.module_name",
        "s.semester_number",
        "cs.class_status",
        "s.semester_id",
        "s.semester_start_date",
        "s.semester_end_date",
        "tsc.teacher_code",
        "t.teacher_name"
      )
      .orderBy("s.semester_number", "asc");

    if (!result) return null;

    return result;
  },

  /**
   * Lấy danh sách module có phân lớp.
   * @returns {Promise<Array<Object>>} Danh sách module.
   */
  getModuleFilter: async () => {
    const modules = await knex("module")
      .distinct()
      .whereIn("module_id", function () {
        this.select("module_id").from("class_subject");
      });

    return modules || [];
  },

  // Certificate Management
  /**
   * Lấy danh sách chứng chỉ theo lớp học phần.
   * @param {number} class_subject_id - ID lớp học phần.
   * @returns {Promise<Array<Object>|null>} Danh sách chứng chỉ.
   */
  getCertificates: async (class_subject_id) => {
    if (!class_subject_id) {
      return;
    }
    const certificates = await knex("certificate as cert")
      .where({
        "cert.class_subject_id": class_subject_id,
      })
      .select(
        "cert.certificate_id",
        "cert.student_code",
        "s.student_middle_name",
        "s.student_name",
        "s.student_IDCard",
        "s.student_address",
        "s.student_date_of_birth",
        "s.student_gender",
        "m.module_name",
        "c.class_name",
        "cert.cert_number",
        "cert.cert_number_id",
        "cert.issued_date",
        "cert.note"
      )
      .join("student as s", "s.student_code", "cert.student_code")
      .join(
        "class_subject as cs",
        "cs.class_subject_id",
        "cert.class_subject_id"
      )
      .join("class as c", "c.class_id", "cs.class_id")
      .join("module as m", "m.module_id", "cs.module_id")
      .orderBy("cert.certificate_id", "desc");

    if (certificates.length == 0) {
      return null;
    }

    return certificates;
  },

  /**
   * Lấy danh sách học viên đủ điều kiện cấp chứng chỉ.
   * @returns {Promise<Array<Object>>} Danh sách học viên đủ điều kiện.
   */
  getStudentEligible: async () => {
    const lists = knex("score as sc")
      .select(
        "s.student_code",
        "s.student_middle_name",
        "s.student_name",
        "cs.class_subject_id",
        "m.module_code",
        "m.module_name",
        "sc.score",
        "c.class_name",
        "sem.semester_end_date as issued_date"
      )
      .join("student as s", "s.student_code", "sc.student_code")
      .join("class_subject as cs", "cs.class_subject_id", "sc.class_subject_id")
      .join("class as c", "cs.class_id", "c.class_id")
      .join("module as m", "cs.module_id", "m.module_id")
      .join("semester as sem", "sem.semester_id", "cs.semester_id")
      .where("sc.score", ">=", 5)
      .whereNotExists(function () {
        this.select(knex.raw(1))
          .from("certificate as c")
          .whereRaw("c.student_code = s.student_code")
          .andWhereRaw("c.class_subject_id = cs.class_subject_id");
      });

    if (lists.length == 0) return null;

    return lists;
  },

  /**
   * Thêm chứng chỉ cho học viên theo lớp học phần.
   * @param {Object} data - Dữ liệu chứng chỉ.
   * @returns {Promise<Array<Object>>} Danh sách chứng chỉ đã thêm.
   */
  addCertificates: async ({ class_subject_id, student_codes }) => {
    const inserted = [];

    for (let student_code of student_codes) {
      // Kiểm tra trùng chứng chỉ
      const exists = await knex("certificate")
        .where({ student_code, class_subject_id })
        .first();

      if (exists) continue;

      // Lấy module_code và module_name, semester_end_date
      const classInfo = await knex("class_subject as cs")
        .join("module as m", "m.module_id", "cs.module_id")
        .join("semester as sem", "sem.semester_id", "cs.semester_id")
        .where("cs.class_subject_id", class_subject_id)
        .select("m.module_code", "m.module_name", "sem.semester_end_date")
        .first();

      if (!classInfo) continue;

      const { module_code, module_name, semester_end_date } = classInfo;
      const issued_date = semester_end_date || new Date();
      const year = issued_date.getFullYear();

      // Tạo tên viết tắt của môn học (chỉ lấy chữ cái đầu mỗi từ)
      const initials = module_name
        .split(" ")
        .map((word) => word.charAt(0).toUpperCase())
        .join("");

      // Tạo mã chứng chỉ theo yêu cầu mới
      const cert_number = `${student_code}/${initials}`;
      const cert_number_id = `${student_code}/${module_code}.${year}`;

      // Thêm vào bảng certificate
      const [cert_id] = await knex("certificate").insert({
        student_code,
        class_subject_id,
        cert_number,
        cert_number_id,
        issued_date,
      });

      inserted.push({ student_code, cert_number, cert_number_id });
    }

    return inserted;
  },

  /**
   * Lấy danh sách lớp đã cấp chứng chỉ.
   * @returns {Promise<Array<Object>|null>} Danh sách lớp và thông tin chứng chỉ.
   */
  getClassCert: async () => {
    const classes = await knex("certificate as cert")
      .join(
        "class_subject as cs",
        "cs.class_subject_id",
        "cert.class_subject_id"
      )
      .join("class as c", "c.class_id", "cs.class_id")
      .join("module as m", "m.module_id", "cs.module_id")
      .join(
        "teacher_subject_class as tsc",
        "tsc.class_subject_id",
        "cert.class_subject_id"
      )
      .join("teacher as t", "t.teacher_code", "tsc.teacher_code")
      .distinct(
        "m.module_code",
        "cert.class_subject_id",
        "c.class_name",
        "m.module_name",
        "t.teacher_name"
      );

    if (classes.length == 0) return null;

    return classes;
  },

  // DashBoard Admin
  /**
   * Lấy thống kê tổng quan cho dashboard.
   * @returns {Promise<Object>} Số lượng lớp, học viên, giảng viên và tài khoản.
   */
  getDashboardStats: async () => {
    try {
      const [classResult] = await knex("class_subject").count(
        "* as total_classes"
      );
      const [studentResult] = await knex("student").count(
        "* as total_students"
      );
      const [teacherResult] = await knex("teacher").count(
        "* as total_teachers"
      );
      const [accountResult] = await knex("system_user").count(
        "* as total_accounts"
      );

      return {
        total_classes: Number(classResult.total_classes),
        total_students: Number(studentResult.total_students),
        total_teachers: Number(teacherResult.total_teachers),
        total_accounts: Number(accountResult.total_accounts),
      };
    } catch (error) {
      console.error("Lỗi khi thống kê dashboard:", error);
      throw error;
    }
  },

  /**
   * Lấy thống kê số lượng học viên theo lớp.
   * @returns {Promise<Array<Object>|null>} Danh sách lớp và số học viên.
   */
  getCountStudentInClass: async () => {
    try {
      const result = await knex("class as c")
        .select("c.class_name")
        .count("cs.student_code as student_count")
        .join("class_subject as csj", "csj.class_id", "c.class_id")
        .join(
          "class_student as cs",
          "cs.class_subject_id",
          "csj.class_subject_id"
        )
        .groupBy("c.class_name");

      if (!result) return null;

      return result;
    } catch (error) {
      console.error("Lỗi thống kê số lượng học viên theo lớp:", error);
      throw error;
    }
  },

  /**
   * Lấy thống kê số chứng chỉ theo module.
   * @returns {Promise<Array<Object>|null>} Danh sách module và số học viên có chứng chỉ.
   */
  getModuleCertificateStats: async () => {
    const countCert = await knex("module as m")
      .select(
        "m.module_name",
        knex.raw("COUNT(DISTINCT cs.student_code) AS total_students"),
        knex.raw("COUNT(DISTINCT c.student_code) AS certified_students")
      )
      .join("class_subject as csj", "m.module_id", "csj.module_id")
      .join(
        "class_student as cs",
        "csj.class_subject_id",
        "cs.class_subject_id"
      )
      .leftJoin("certificate as c", function () {
        this.on("cs.student_code", "=", "c.student_code").andOn(
          "csj.class_subject_id",
          "=",
          "c.class_subject_id"
        );
      })
      .groupBy("m.module_name");

    if (countCert.length == 0) return null;

    return countCert;
  },
};

module.exports = admin;

```

### backend\src\models\auth.model.js
```js
const knex = require("../database/knex");

const auth = {
  login: async (username, password) => {
    const user = await knex("system_user")
      .where("user_username", username)
      .andWhere("user_pass", password)
      .select("user_username", "user_role", "user_status", "user_id")
      .limit(1);

    if (user.length > 0) {
      return user[0];
    }
    return null;
  },

  checkAccount: async (username) => {
    const user = await knex("system_user")
      .where("user_name", username)
      .select("user_name")
      .first();
    return user || null;
  },

  register: async (RegisterData) => {
    return knex("userInfo").insert({
      user_name: RegisterData.username,
      user_passwd: RegisterData.password,
      user_phoneNum: RegisterData.userPhone,
    });
  },
};

module.exports = auth;

```

### backend\src\models\student.model.js
```js
const knex = require("../database/knex");

const student = {
  /**
   * Lấy tất cả điểm của học viên theo mã học viên.
   * @param {string} studentCode - Mã học viên.
   * @returns {Promise<Array<Object>>} Danh sách điểm theo từng môn học và học kỳ.
   */
  getAllSubjectScore: async (studentCode) => {
    const result = await knex("student as s")
      .join("class_student as cs", "s.student_code", "cs.student_code")
      .join(
        "class_subject as csub",
        "cs.class_subject_id",
        "csub.class_subject_id"
      )
      .join("class as c", "csub.class_id", "c.class_id")
      .join("module as m", "csub.module_id", "m.module_id")
      .join("semester as se", "csub.semester_id", "se.semester_id")
      .join("score as sc", function () {
        this.on("cs.class_subject_id", "=", "sc.class_subject_id").andOn(
          "s.student_code",
          "=",
          "sc.student_code"
        );
      })
      .where("s.student_code", studentCode)
      .distinct(
        "s.student_code as MÃ HS",
        "s.student_middle_name as HỌ ĐỆM",
        "s.student_name as TÊN",
        "m.module_code as Mã Môn học",
        "m.module_name as Tên Môn học",
        "c.class_name AS Đơn Vị Học",
        "se.semester_number as Học kỳ",
        "se.semester_start_date as Ngày bắt đầu",
        "se.semester_end_date as Ngày kết thúc",
        "sc.score as Tổng điểm"
      )
      .orderBy("m.module_code");

    return result;
  },

  /**
   * Lọc điểm của học viên theo học kỳ.
   * @param {string} studentCode - Mã học viên.
   * @param {number|string} semester - Số thứ tự học kỳ (VD: 1, 2, 3...).
   * @returns {Promise<Array<Object>>} Danh sách điểm lọc theo học kỳ.
   */
  filterSubjectScoreBySemester: async (studentCode, semester) => {
    const result = await knex("student as s")
      .join("class_student as cs", "s.student_code", "cs.student_code")
      .join(
        "class_subject as csub",
        "cs.class_subject_id",
        "csub.class_subject_id"
      )
      .join("class as c", "csub.class_id", "c.class_id")
      .join("module as m", "csub.module_id", "m.module_id")
      .join("semester as se", "csub.semester_id", "se.semester_id")
      .join("score as sc", function () {
        this.on("cs.class_subject_id", "=", "sc.class_subject_id").andOn(
          "s.student_code",
          "=",
          "sc.student_code"
        );
      })
      .where("s.student_code", studentCode)
      .andWhere("se.semester_number", semester)
      .distinct(
        "s.student_code as MÃ HS",
        "s.student_middle_name as HỌ ĐỆM",
        "s.student_name as TÊN",
        "m.module_code as Mã Môn học",
        "m.module_name as Tên Môn học",
        "c.class_name AS Đơn Vị Học",
        "se.semester_number as Học kỳ",
        "se.semester_start_date as Ngày bắt đầu",
        "se.semester_end_date as Ngày kết thúc",
        "sc.score as Tổng điểm"
      )
      .orderBy("m.module_code");

    return result;
  },

  /**
   * Lấy thông tin chi tiết của một học viên.
   * @param {string} studentCode - Mã học viên.
   * @returns {Promise<Object|null>} Thông tin học viên hoặc null nếu không tìm thấy.
   */
  getStudentInfo: async (studentCode) => {
    const result = await knex("student").where("student_code", studentCode);

    if (result.length === 0) {
      return null;
    }

    return result[0];
  },

  /**
   * Cập nhật thông tin của học viên.
   * @param {string} studentCode - Mã học viên cần cập nhật.
   * @param {Object} updateData - Dữ liệu cần cập nhật.
   * @param {string} [updateData.student_date_of_birth]
   * @param {string} updateData.student_address
   * @param {string} updateData.student_email
   * @param {string} updateData.student_phone
   * @param {string} updateData.student_IDCard
   * @param {string} updateData.student_country
   * @param {string} updateData.student_gender
   * @returns {Promise<number|null>} Số lượng bản ghi cập nhật hoặc null nếu không cập nhật.
   */
  updateStudentInfo: async (studentCode, updateData) => {
    const result = await knex("student")
      .where("student_code", studentCode)
      .update({
        student_date_of_birth: updateData.student_date_of_birth,
        student_address: updateData.student_address,
        student_email: updateData.student_email,
        student_phone: updateData.student_phone,
        student_IDCard: updateData.student_IDCard,
        student_country: updateData.student_country,
        student_gender: updateData.student_gender,
      });

    if (result === 0) {
      return null;
    }
    return result;
  },

  /**
   * Lấy danh sách chứng chỉ của học viên.
   * @param {string} student_code - Mã học viên.
   * @returns {Promise<Array<Object>|null>} Danh sách chứng chỉ hoặc null nếu không có.
   */
  getCertificatesOfStudent: async (student_code) => {
    const certs = await knex("certificate as c")
      .join("student as s", "c.student_code", "s.student_code")
      .join(
        "class_subject as csj",
        "c.class_subject_id",
        "csj.class_subject_id"
      )
      .join("class as cl", "csj.class_id", "cl.class_id")
      .join("module as m", "csj.module_id", "m.module_id")
      .where("c.student_code", student_code)
      .select(
        "c.cert_number as so_hieu",
        "s.student_code as ma_so",
        knex.raw("CONCAT(s.student_middle_name, ' ', s.student_name) as ten"),
        "s.student_IDCard as so_CMND",
        "cl.class_name as lop",
        "m.module_code as ma_mon",
        "m.module_name as ten_mon",
        "c.issued_date as ngay_cap"
      );

    if (certs.length == 0) return null;

    return certs;
  },
};

module.exports = student;

```

### backend\src\models\teacher.model.js
```js
const knex = require("../database/knex");

const teacher = {
  /**
   * Lấy thông tin giảng viên theo mã.
   * @function
   * @async
   * @param {string} teacherCode - Mã giảng viên.
   * @returns {Promise<Object|null>} Thông tin giảng viên hoặc null nếu không tìm thấy.
   * @route GET /api/teacher/info
   */
  getTeacherInfo: async (teacherCode) => {
    const result = await knex("teacher").where("teacher_code", teacherCode);

    if (result.length === 0) {
      return null;
    }

    return result[0];
  },

  /**
   * Cập nhật thông tin giảng viên.
   * @function
   * @async
   * @param {string} teacherCode - Mã giảng viên.
   * @param {Object} updateData - Dữ liệu cập nhật.
   * @returns {Promise<number|null>} Số dòng cập nhật hoặc null nếu không có dòng nào.
   */
  updateTeacherInfo: async (teacherCode, updateData) => {
    const result = await knex("teacher")
      .where("teacher_code", teacherCode)
      .update({
        teacher_date_of_birth: updateData.teacher_date_of_birth,
        teacher_gender: updateData.teacher_gender,
        teacher_address: updateData.teacher_address,
        teacher_email: updateData.teacher_email,
        teacher_phone: updateData.teacher_phone,
      });

    if (result === 0) {
      return null;
    }
    return result;
  },

  /**
   * Lấy danh sách lớp môn học mà giảng viên đang dạy.
   * @function
   * @async
   * @param {string} teacherCode - Mã giảng viên.
   * @returns {Promise<Array|null>} Danh sách lớp môn học hoặc null nếu không có.
   * @route GET /api/teacher/modules
   */
  getModuleTeaching: async (teacherCode) => {
    const result = await knex("teacher_subject_class as tsc")
      .join("teacher as t", "tsc.teacher_code", "t.teacher_code")
      .join(
        "class_subject as csub",
        "tsc.class_subject_id",
        "csub.class_subject_id"
      )
      .join("class as c", "csub.class_id", "c.class_id")
      .join("module as m", "csub.module_id", "m.module_id")
      .join("semester as se", "csub.semester_id", "se.semester_id")
      .where("t.teacher_code", teacherCode)
      .distinct(
        "csub.class_subject_id",
        "t.teacher_code",
        "t.teacher_name",
        "c.class_code",
        "c.class_name",
        "m.module_code",
        "m.module_name",
        "se.semester_number",
        "se.semester_start_date",
        "se.semester_end_date"
      )
      .orderBy("se.semester_number", "desc");

    if (result.length === 0) {
      return null;
    }

    return result;
  },

  /**
   * Lấy danh sách học viên trong lớp mà giảng viên giảng dạy.
   * @function
   * @async
   * @param {Object} params - Tham số bao gồm mã giảng viên, mã môn học và mã lớp.
   * @returns {Promise<Array>} Danh sách học viên trong lớp.
   * @route GET /api/teacher/students-in-class
   */
  getStudentInClass: async ({ teacherCode, moduleCode, classCode }) => {
    const result = await knex("teacher as t")
      .join(
        "teacher_subject_class as tsc",
        "t.teacher_code",
        "tsc.teacher_code"
      )
      .join(
        "class_subject as csub",
        "tsc.class_subject_id",
        "csub.class_subject_id"
      )
      .join("class as c", "csub.class_id", "c.class_id")
      .join("module as m", "csub.module_id", "m.module_id")
      .join("semester as se", "csub.semester_id", "se.semester_id")
      .join(
        "class_student as cs",
        "csub.class_subject_id",
        "cs.class_subject_id"
      )
      .join("student as s", "cs.student_code", "s.student_code")
      .leftJoin("score as sc", function () {
        this.on("cs.class_subject_id", "=", "sc.class_subject_id").andOn(
          "s.student_code",
          "=",
          "sc.student_code"
        );
      })
      .where("t.teacher_code", teacherCode)
      .andWhere("m.module_code", moduleCode)
      .andWhere("c.class_code", classCode)
      .distinct(
        "t.teacher_name",
        "c.class_name",
        "m.module_name",
        "s.student_code",
        "s.student_middle_name",
        "s.student_name",
        "sc.score"
      )
      .orderBy([{ column: "s.student_code" }]);

    return result;
  },

  /**
   * Cập nhật điểm cho học viên trong lớp học phần.
   * @function
   * @async
   * @param {number} classSubjectId - ID lớp học phần.
   * @param {string} studentCode - Mã học viên.
   * @param {number} score - Điểm cần cập nhật.
   * @returns {Promise<number|null>} Kết quả cập nhật.
   */
  updateStudentScore: async (classSubjectId, studentCode, score) => {
    const result = await knex("score")
      .where({
        class_subject_id: classSubjectId,
        student_code: studentCode,
      })
      .update({ score });

    if (result === 0) {
      return null;
    }
    return result;
  },

  /**
   * Lấy danh sách học viên qua môn theo lớp giảng dạy.
   * @function
   * @async
   * @param {string} teacherCode - Mã giảng viên.
   * @returns {Promise<Array|null>} Danh sách tổng số học viên và số lượng qua môn.
   * @route GET /api/teacher/students-passed
   */
  getStudentPassing: async (teacherCode) => {
    const result = await knex("teacher_subject_class as tsc")
      .join(
        "class_subject as csj",
        "tsc.class_subject_id",
        "csj.class_subject_id"
      )
      .join("class as c", "csj.class_id", "c.class_id")
      .join("module as m", "csj.module_id", "m.module_id")
      .join(
        "class_student as cs",
        "csj.class_subject_id",
        "cs.class_subject_id"
      )
      .leftJoin("score as sc", function () {
        this.on("sc.class_subject_id", "=", "csj.class_subject_id").andOn(
          "sc.student_code",
          "=",
          "cs.student_code"
        );
      })
      .where("tsc.teacher_code", teacherCode)
      .select(
        "c.class_code as class",
        "m.module_name as subject",
        knex.raw("COUNT(DISTINCT cs.student_code) as total_students"),
        knex.raw(
          "COUNT(DISTINCT CASE WHEN sc.score >= 4.0 THEN sc.student_code END) as passed_students"
        )
      )
      .groupBy(["c.class_code", "m.module_name"])
      .orderBy(["c.class_code", "m.module_name"]);

    if (result.length === 0) {
      return null;
    }

    return result;
  },

  /**
   * Tỷ lệ học viên qua môn của giảng viên.
   * @function
   * @async
   * @param {string} teacherCode - Mã giảng viên.
   * @returns {Promise<Object|null>} Tỷ lệ phần trăm học viên qua môn.
   * @route GET /api/teacher/passing-propotion
   */
  getPassingPropotion: async (teacherCode) => {
    const result = await knex("teacher_subject_class as tsc")
      .join(
        "class_subject as csj",
        "tsc.class_subject_id",
        "csj.class_subject_id"
      )
      .join(
        "class_student as cs",
        "cs.class_subject_id",
        "csj.class_subject_id"
      )
      .leftJoin("score as sc", function () {
        this.on("sc.class_subject_id", "=", "csj.class_subject_id").andOn(
          "sc.student_code",
          "=",
          "cs.student_code"
        );
      })
      .where("tsc.teacher_code", teacherCode)
      .select(
        knex.raw("COUNT(DISTINCT cs.student_code) AS total_students"),
        knex.raw(`
        COUNT(DISTINCT CASE WHEN sc.score >= 4.0 THEN sc.student_code END) AS passed_students
      `),
        knex.raw(`
        ROUND(
          COUNT(DISTINCT CASE WHEN sc.score >= 4.0 THEN sc.student_code END) * 100.0
          / NULLIF(COUNT(DISTINCT cs.student_code), 0), 2
        ) AS passing_percentage
      `)
      );

    if (!result || result.length === 0) {
      return null;
    }

    return result[0]; // vì chỉ có 1 hàng kết quả
  },

  /**
   * Tính điểm trung bình các môn học mà giảng viên phụ trách, theo từng lớp.
   * @route GET /api/teacher/avg-score
   * @param {string} teacherCode - Mã giảng viên.
   * @returns {Promise<Array<{ class: string, subject: string, average_score: number }>|null>}
   */
  getAvgScore: async (teacherCode) => {
    const result = await knex("teacher_subject_class as tsc")
      .join(
        "class_subject as csj",
        "tsc.class_subject_id",
        "csj.class_subject_id"
      )
      .join("class as c", "csj.class_id", "c.class_id")
      .join("module as m", "csj.module_id", "m.module_id")
      .join(
        "class_student as cs",
        "csj.class_subject_id",
        "cs.class_subject_id"
      )
      .join("score as sc", function () {
        this.on("sc.class_subject_id", "=", "csj.class_subject_id").andOn(
          "sc.student_code",
          "=",
          "cs.student_code"
        );
      })
      .where("tsc.teacher_code", teacherCode)
      .select(
        "c.class_code as class",
        "m.module_name as subject",
        knex.raw(" ROUND(AVG(sc.score), 2) as average_score")
      )
      .groupBy(["c.class_code", "m.module_name"])
      .orderBy("c.class_code", "asc");

    if (result.length === 0) {
      return null;
    }

    return result;
  },

  /**
   * Tìm mã học viên theo họ đệm và tên.
   * @route GET /api/teacher/student-code
   * @param {string} studentMiddleName - Họ đệm học viên.
   * @param {string} studentName - Tên học viên.
   * @returns {Promise<string|null>} - Mã học viên hoặc null nếu không tìm thấy.
   */
  getStudentCodeByName: async (studentMiddleName, studentName) => {
    const result = await knex("student")
      .where({
        student_middle_name: studentMiddleName,
        student_name: studentName,
      })
      .select("student_code");

    if (result.length === 0) {
      return null;
    }

    return result[0].student_code;
  },

  /**
   * Nhập điểm hàng loạt cho lớp học phần, bỏ qua học viên không hợp lệ hoặc không có thay đổi.
   * @route POST /api/teacher/import-scores
   * @param {string} classSubjectId - ID lớp học phần.
   * @param {Array<{ student_code: string, score: number|string }>} students - Danh sách học viên và điểm.
   * @returns {Promise<{ updatedCount: number, updated: string[], skipped: string[] }>}
   */
  importStudentScores: async (classSubjectId, students) => {
    const updated = [];
    const skipped = [];
    for (const student of students) {
      try {
        const exists = await knex("score")
          .where({
            class_subject_id: classSubjectId,
            student_code: student.student_code,
          })
          .select("score")
          .first();

        if (!exists) {
          skipped.push(student.student_code);
          continue;
        }

        if (student.score === "" || student.score === undefined) {
          skipped.push(student.student_code);
          continue;
        }

        if (Number(exists.score) === Number(student.score)) {
          skipped.push(student.student_code);
          continue;
        }

        await knex("score")
          .where({
            class_subject_id: classSubjectId,
            student_code: student.student_code,
          })
          .update({ score: student.score });

        updated.push(student.student_code);
      } catch (error) {
        console.error(
          `Error processing student ${student.student_code}:`,
          error
        );
        continue;
      }
    }
    return {
      updatedCount: updated.length,
      updated,
      skipped,
    };
  },

  /**
   * Lấy tiến độ nhập điểm của giảng viên, bao gồm tổng số sinh viên và số sinh viên đã có điểm.
   * @route GET /api/teacher/score-progress
   * @param {string} teacherCode - Mã giảng viên.
   * @returns {Promise<{ tong_sinh_vien: string, so_diem_da_nhap: string }|null>}
   */
  getScoreProgress: async (teacherCode) => {
    const result = await knex("teacher_subject_class as tsc")
      .join(
        "class_student as cs",
        "cs.class_subject_id",
        "tsc.class_subject_id"
      )
      .leftJoin("score as s", function () {
        this.on("s.class_subject_id", "=", "cs.class_subject_id")
          .andOn("s.student_code", "=", "cs.student_code")
          .andOnNotNull("s.score");
      })
      .where("tsc.teacher_code", teacherCode)
      .countDistinct("cs.student_code as tong_sinh_vien")
      .countDistinct({ so_diem_da_nhap: "s.student_code" })
      .groupBy("tsc.teacher_code");

    if (result.length === 0) {
      return null;
    }

    return result[0];
  },

  /**
   * Đếm tổng số lớp học phần mà giảng viên đang giảng dạy.
   * @route GET /api/teacher/count-teaching
   * @param {string} teacherCode - Mã giảng viên.
   * @returns {Promise<string|null>} - Số lượng lớp học phần.
   */
  getCountTeaching: async (teacherCode) => {
    const result = await knex("teacher_subject_class as tsc")
      .where("tsc.teacher_code", teacherCode)
      .countDistinct("tsc.class_subject_id as count_teaching");

    if (result.length === 0) {
      return null;
    }

    return result[0].count_teaching;
  },

  /**
   * Lấy thời điểm cập nhật điểm gần nhất của giảng viên.
   * @route GET /api/teacher/last-update
   * @param {string} teacherCode - Mã giảng viên.
   * @returns {Promise<{ last_update: string }|null>}
   */
  getLastUpdate: async (teacherCode) => {
    const result = await knex("score as s")
      .join(
        "teacher_subject_class as tsc",
        "tsc.class_subject_id",
        "s.class_subject_id"
      )
      .where("tsc.teacher_code", teacherCode)
      .whereNotNull("s.score")
      .max("updated_at as last_update")
      .first();

    if (!result) {
      return null;
    }

    return result;
  },
};

module.exports = teacher;

```

### backend\src\routes\admin.router.js
```js
const express = require("express");
const adminController = require("../controllers/admin.controller");
const { methodNotAllowed } = require("../controllers/errors.controller");

const router = express.Router();

// Account Management
router.post("/createStudentAccount", adminController.createStudentAccount);
router.all("/createStudentAccount", methodNotAllowed);

router.post("/createTeacherAccount", adminController.createTeacherAccount);
router.all("/createTeacherAccount", methodNotAllowed);

router.get("/getAccountList", adminController.getAccountList);
router.all("/getAccountList", methodNotAllowed);

router.put("/updateAccount", adminController.updateAccount);
router.all("/updateAccount", methodNotAllowed);

router.post("/addNewAccount", adminController.addNewAccount);
router.all("/addNewAccount", methodNotAllowed);

router.get("/getStudentAccount", adminController.getStudentAccount);
router.all("/getStudentAccount", methodNotAllowed);

router.get("/getTeacherAccount", adminController.getTeacherAccount);
router.all("/getTeacherAccount", methodNotAllowed);

// Student Management

router.get("/getStudentList", adminController.getStudentList);
router.all("/getStudentList", methodNotAllowed);

router.post("/importStudentList", adminController.importStudentList);
router.all("/importStudentList", methodNotAllowed);

router.get("/getLastStudentCode", adminController.getLastStudentCode);
router.all("/getLastStudentCode", methodNotAllowed);

router.post("/addNewStudent", adminController.addNewStudent);
router.all("/addNewStudent", methodNotAllowed);

router.put("/updateStudentInfor", adminController.updateStudentInfor);
router.all("/updateStudentInfor", methodNotAllowed);

router.get("/getListStudentCode", adminController.getListStudentCode);
router.all("/getListStudentCode", methodNotAllowed);

router.get("/getStudentNotInClass", adminController.getStudentNotInClass);
router.all("/getStudentNotInClass", methodNotAllowed);

router.get("/getStudentInClass", adminController.getStudentInClass);
router.all("/getStudentInClass", methodNotAllowed);

// Teacher Management

router.get("/getTeacherList", adminController.getTeacherList);
router.all("/getTeacherList", methodNotAllowed);

router.get("/getLastTeacherCode", adminController.getLastTeacherCode);
router.all("/getLastTeacherCode", methodNotAllowed);

router.post("/addNewTeacher", adminController.addNewTeacher);
router.all("/addNewTeacher", methodNotAllowed);

router.put("/updateTeacherInfor", adminController.updateTeacherInfor);
router.all("/updateTeacherInfor", methodNotAllowed);

router.get("/getListTeacherCode", adminController.getListTeacherCode);
router.all("/getListTeacherCode", methodNotAllowed);

// Class & Enrollment
router.post("/createClass", adminController.createClassWithTeacher);
router.all("/createClass", methodNotAllowed);

router.post("/addStudentsToClass", adminController.addStudentsToClass);
router.all("/addStudentsToClass", methodNotAllowed);

router.put("/updateClass", adminController.updateClass);
router.all("/updateClass", methodNotAllowed);

router.get("/getClassCodeAndSemester", adminController.getClassCodeAndSemester);
router.all("/getClassCodeAndSemester", methodNotAllowed);

// Module Management
router.get("/getModuleList", adminController.getModuleList);
router.all("/getModuleList", methodNotAllowed);

router.get("/getModuleCode", adminController.getModuleCode);
router.all("/getModuleCode", methodNotAllowed);

router.get("/getModuleFilter", adminController.getModuleFilter);
router.all("/getModuleFilter", methodNotAllowed);

// Certificate Management
router.get("/getCertificates", adminController.getCertificates);
router.all("/getCertificates", methodNotAllowed);

router.get("/getStudentEligible", adminController.getStudentEligible);
router.all("/getStudentEligible", methodNotAllowed);

router.get("/getClassCert", adminController.getClassCert);
router.all("/getClassCert", methodNotAllowed);

router.post("/addCertificates", adminController.addCertificates);
router.all("/addCertificates", methodNotAllowed);

// Admin Dash Board
router.get("/getDashboardStats", adminController.getDashboardStats);
router.all("/getDashboardStats", methodNotAllowed);

router.get("/getCountStudentInClass", adminController.getCountStudentInClass);
router.all("/getCountStudentInClass", methodNotAllowed);

router.get(
  "/getModuleCertificateStats",
  adminController.getModuleCertificateStats
);
router.all("/getModuleCertificateStats", methodNotAllowed);

// Default
router.all("/", methodNotAllowed);

module.exports.setup = (app) => {
  app.use("/api/v1/admin", router);
};

```

### backend\src\routes\auth.router.js
```js
const express = require("express");
const authController = require("../controllers/auth.controller");
const { methodNotAllowed } = require("../controllers/errors.controller");
// const authorization = require("../middlewares/authorization");

const router = express.Router();

router.post("/login", authController.login);
router.post("/logout", authController.logout);
router.all("/", methodNotAllowed);

module.exports.setup = (app) => {
  app.use("/api/v1/auth", router);
};

```

### backend\src\routes\student.router.js
```js
const express = require("express");
const studentController = require("../controllers/student.controller");
const { methodNotAllowed } = require("../controllers/errors.controller");
// const authorization = require("../middlewares/authorization");

const router = express.Router();

router.get("/getScore", studentController.getScore);
router.all("/getScore", methodNotAllowed);
router.get("/getScoreBySemester", studentController.getScoreBySemester);
router.all("/getScoreBySemester", methodNotAllowed);
router.get("/getStudentInfo", studentController.getStudentInfo);
router.all("/getStudentInfo", methodNotAllowed);
router.put("/updateStudentInfo", studentController.updateStudentInfo);
router.all("/updateStudentInfo", methodNotAllowed);
router.get(
  "/getCertificatesOfStudent",
  studentController.getCertificatesOfStudent
);
router.all("/getCertificatesOfStudent", methodNotAllowed);

router.all("/", methodNotAllowed);

module.exports.setup = (app) => {
  app.use("/api/v1/student", router);
};

```

### backend\src\routes\teacher.router.js
```js
const express = require("express");
const teacherController = require("../controllers/teacher.controller");
const { methodNotAllowed } = require("../controllers/errors.controller");
// const authorization = require("../middlewares/authorization");

const router = express.Router();

router.get("/getTeacherInfo", teacherController.getTeacherInfo);
router.all("/getTeacherInfo", methodNotAllowed);
router.put("/updateTeacherInfo", teacherController.updateTeacherInfo);
router.all("/updateTeacherInfo", methodNotAllowed);
router.get("/getModuleTeaching", teacherController.getModuleTeaching);
router.all("/getModuleTeaching", methodNotAllowed);
router.get("/getStudentInClass", teacherController.getStudentInClass);
router.all("/getStudentInClass", methodNotAllowed);
router.put("/updateStudentScore", teacherController.updateStudentScore);
router.all("/updateStudentScore", methodNotAllowed);
router.get("/getStudentPassing", teacherController.getStudentPassing);
router.all("/getStudentPassing", methodNotAllowed);
router.get("/getPassingPropotion", teacherController.getPassingPropotion);
router.all("/getPassingPropotion", methodNotAllowed);
router.get("/getAvgScore", teacherController.getAvgScore);
router.all("/getAvgScore", methodNotAllowed);
router.get("/getStudentCodeByName", teacherController.getStudentCodeByName);
router.all("/getStudentCodeByName", methodNotAllowed);
router.post("/importStudentScores", teacherController.importStudentScores);
router.all("/importStudentScores", methodNotAllowed);
router.get("/getScoreProgress", teacherController.getScoreProgress);
router.all("/getScoreProgress", methodNotAllowed);
router.get("/getCountTeaching", teacherController.getCountTeaching);
router.all("/getCountTeaching", methodNotAllowed);
router.get("/getLastUpdate", teacherController.getLastUpdate);
router.all("/getLastUpdate", methodNotAllowed);

router.all("/", methodNotAllowed);

module.exports.setup = (app) => {
  app.use("/api/v1/teacher", router);
};

```

### frontend\js\toast.js
```js
function showToast(message, type = "info") {
  const bgColors = {
    success: "linear-gradient(to right, #00b09b, #96c93d)",
    error: "linear-gradient(to right, #e52d27, #b31217)",
    info: "linear-gradient(to right, #2193b0, #6dd5ed)",
    warn: "linear-gradient(to right, #f7971e, #ffd200)",
  };

  const icons = {
    success: "✅",
    error: "❌",
    info: "ℹ️",
    warn: "⚠️",
  };

  const icon = icons[type] || "";
  const textWithIcon = `<span style="display:flex;align-items:center;gap:6px;">${icon} ${message}</span>`;

  Toastify({
    text: textWithIcon,
    duration: 3000,
    close: false,
    gravity: "top",
    position: "right",
    backgroundColor: bgColors[type] || bgColors.info,
    stopOnFocus: true,
    escapeMarkup: false, // <--- Cho phép hiển thị HTML
  }).showToast();
}

window.showToast = showToast;

```

### frontend\js\Administrator\manage_account\account_management.js
```js
/**
 * Sự kiện sau khi DOM đã tải xong: khởi tạo toggle password, modal, sự kiện submit,
 * và lấy danh sách tài khoản.
 */
document.addEventListener("DOMContentLoaded", function () {
  document.querySelectorAll(".toggle-password").forEach((icon) => {
    icon.addEventListener("click", function () {
      const input = this.previousElementSibling;
      const isPassword = input.type === "password";

      input.type = isPassword ? "text" : "password";

      // Đổi icon
      this.classList.toggle("bi-eye-fill", isPassword);
      this.classList.toggle("bi-eye-slash-fill", !isPassword);
    });
  });

  const inputs = document.querySelectorAll(".password-field");

  inputs.forEach((input) => {
    input.style.width = input.value.length + 1 + "ch";
  });

  const editModal = document.getElementById("editModal");
  editModal.addEventListener("show.bs.modal", function (event) {
    const button = event.relatedTarget;
    const code = button.getAttribute("data-editMaSV");
    const passwd = button.getAttribute("data-editMatKhau");
    const name = button.getAttribute("data-editTen");
    const status = button.getAttribute("data-editTrangThai");

    document.getElementById("editMaSV").value = code;
    document.getElementById("editMaSV").readOnly = true;
    document.getElementById("editMatKhau").value = passwd;
    document.getElementById("editTen").value = name;
    document.getElementById("editTen").readOnly = true;
    document.getElementById("editTrangThai").value = status;
  });

  document.getElementById("editForm").addEventListener("submit", function (e) {
    e.preventDefault(); // Ngăn reload trang
    const currentCode = document.getElementById("editMaSV").value;
    const newPassword = document.getElementById("editMatKhau").value;
    const newStatus = document.getElementById("editTrangThai").value;
    console.log("Current Code:", currentCode);
    console.log("New Password:", newPassword);
    console.log("New Status:", newStatus);
    updateAccount(currentCode, newPassword, newStatus);
  });

  getAccountList();
});

/**
 * Gửi yêu cầu API để lấy danh sách toàn bộ tài khoản.
 * Gán kết quả vào listAccount và gọi hàm hiển thị.
 */
async function getAccountList() {
  const API_BASE = "http://localhost:3000";
  try {
    const res = await fetch(`${API_BASE}/api/v1/admin/getAccountList`);
    const result = await res.json();

    if (result.status === "success" && Array.isArray(result.data)) {
      console.log("Account:", result.data);
      listAccount = result.data;
      searchAccounts = [...listAccount];
      renderListAccount(result.data);
    } else {
      Swal.fire("Thông báo", "Không lấy được dữ liệu!", "warning");
    }
  } catch (error) {
    console.error(error);
    Swal.fire("Lỗi", "Lỗi khi lấy dữ liệu!", "error");
  }
}

const limitRows = 10;
let currentPage = 1;
let listAccount = [];
let searchAccounts = [];

/**
 * Gán danh sách dữ liệu tài khoản cần hiển thị và thực hiện hiển thị theo trang.
 * @param {Array<Object>} datas - Danh sách tài khoản.
 */
function renderListAccount(datas) {
  searchAccounts = datas;
  displayListAccount(currentPage);
  renderPagination();
}

/**
 * Tạo các nút phân trang dựa trên số lượng tài khoản và trang hiện tại.
 */
function renderPagination() {
  const totalPages = Math.ceil(searchAccounts.length / limitRows);
  const pagination = document.getElementById("pagination");
  pagination.innerHTML = "";

  const maxVisible = 3; // Số nút trang muốn hiển thị xung quanh trang hiện tại
  let startPage = Math.max(1, currentPage - Math.floor(maxVisible / 2));
  let endPage = Math.min(totalPages, startPage + maxVisible - 1);

  // Điều chỉnh nếu cuối danh sách
  if (endPage - startPage < maxVisible - 1) {
    startPage = Math.max(1, endPage - maxVisible + 1);
  }

  // Nút "«" ← previous
  if (currentPage > 1) {
    pagination.appendChild(createPageItem("«", currentPage - 1));
  }

  // Nút trang đầu + dấu ...
  if (startPage > 1) {
    pagination.appendChild(createPageItem(1, 1));
    if (startPage > 2) {
      pagination.appendChild(createEllipsis());
    }
  }

  // Các nút trang chính giữa
  for (let i = startPage; i <= endPage; i++) {
    const li = createPageItem(i, i);
    if (i === currentPage) li.classList.add("active");
    pagination.appendChild(li);
  }

  // Dấu ... + trang cuối
  if (endPage < totalPages) {
    if (endPage < totalPages - 1) {
      pagination.appendChild(createEllipsis());
    }
    pagination.appendChild(createPageItem(totalPages, totalPages));
  }

  // Nút "»" → next
  if (currentPage < totalPages) {
    pagination.appendChild(createPageItem("»", currentPage + 1));
  }
}

/**
 * Tạo nút phân trang.
 * @param {string|number} label - Nội dung nút (số trang hoặc ký tự).
 * @param {number} pageNum - Số trang tương ứng.
 * @returns {HTMLLIElement} - Phần tử nút trang.
 */
function createPageItem(label, pageNum) {
  const li = document.createElement("li");
  li.className = "page-item";
  const a = document.createElement("a");
  a.className = "page-link";
  a.href = "#";
  a.textContent = label;
  a.addEventListener("click", (e) => {
    e.preventDefault();
    currentPage = pageNum;
    displayListAccount(currentPage);
    renderPagination();
  });
  li.appendChild(a);
  return li;
}

/**
 * Tạo phần tử dấu ba chấm (...) trong phân trang.
 * @returns {HTMLLIElement} - Phần tử dấu ba chấm.
 */
function createEllipsis() {
  const li = document.createElement("li");
  li.className = "page-item disabled";
  li.innerHTML = `<span class="page-link">...</span>`;
  return li;
}

/**
 * Hiển thị danh sách tài khoản tương ứng với trang hiện tại.
 * @param {number} page - Trang cần hiển thị.
 */
function displayListAccount(page) {
  const accountList = document.getElementById("account-list");
  accountList.innerHTML = ""; // Clear existing rows
  const start = (page - 1) * limitRows;
  const end = start + limitRows;
  const items = searchAccounts.slice(start, end);

  items.forEach((account, index) => {
    const row = document.createElement("tr");

    // Tạo input password
    const passwordField = document.createElement("input");
    passwordField.type = "password";
    passwordField.className = "unstyled-input password-field";
    passwordField.value = account.user_pass;
    passwordField.readOnly = true;
    passwordField.style.width = passwordField.value.length + 1 + "ch";

    // Icon toggle
    const eyeIcon = document.createElement("i");
    eyeIcon.className = "bi bi-eye-slash-fill toggle-password";
    eyeIcon.style.cursor = "pointer";
    eyeIcon.addEventListener("click", function () {
      const isHidden = passwordField.type === "password";
      passwordField.type = isHidden ? "text" : "password";
      eyeIcon.className = isHidden
        ? "bi bi-eye-fill toggle-password"
        : "bi bi-eye-slash-fill toggle-password";
    });

    // Tên tài khoản (tuỳ role)
    let name = "-";
    if (account.user_role === "Học viên" && account.info) {
      name = `${account.info.student_middle_name} ${account.info.student_name}`;
    } else if (account.user_role === "Giảng viên" && account.info) {
      name = account.info.teacher_name;
    }

    let statusText =
      account.user_status === 1 ? "Đang hoạt động" : "Ngừng hoạt động";
    if (account.user_status === 0) {
      statusText = `<span class="text-danger">${statusText}</span>`;
    } else if (account.user_status === 1) {
      statusText = `<span class="text-primary">${statusText}</span>`;
    }
    row.innerHTML = `
      <td>${index + 1}</td>
      <td>${account.user_username}</td>
      <td></td>
      <td>${name}</td>
      <td>${account.user_role}</td>
      <td>${statusText}</td>
      <td>
        <button class="btn btn-sm btn-warning me-1 btn-edit" 
			data-bs-toggle="modal"
			data-bs-target="#editModal"
			data-editMaSV="${account.user_username}"
  			data-editMatKhau="${account.user_pass}"
  			data-editTen="${name}"
			data-editTrangThai="${account.user_status}">
          <i class="bi bi-pencil-square"></i> Sửa
        </button>
      </td>
    `;

    // Thêm input password và icon vào cột thứ 3
    const passwordCell = row.children[2];
    passwordCell.appendChild(passwordField);
    passwordCell.appendChild(eyeIcon);

    accountList.appendChild(row);
  });
}

/**
 * Gửi API lấy danh sách tài khoản của học viên.
 * Gọi render sau khi lấy dữ liệu thành công.
 */
async function getStudentAccount() {
  const API_BASE = "http://localhost:3000";
  try {
    const res = await fetch(`${API_BASE}/api/v1/admin/getStudentAccount`);
    const result = await res.json();

    if (result.status === "success" && Array.isArray(result.data)) {
      console.log("Student Account:", result.data);
      renderListAccount(result.data);
    } else {
      Swal.fire("Thông báo", "Không lấy được dữ liệu sinh viên!", "warning");
    }
  } catch (error) {
    console.error(error);
    Swal.fire("Lỗi", "Lỗi khi lấy dữ liệu sinh viên!", "error");
  }
}

/**
 * Gửi API lấy danh sách tài khoản của giảng viên.
 * Gọi render sau khi lấy dữ liệu thành công.
 */
async function getTeacherAccount() {
  const API_BASE = "http://localhost:3000";
  try {
    const res = await fetch(`${API_BASE}/api/v1/admin/getTeacherAccount`);
    const result = await res.json();

    if (result.status === "success" && Array.isArray(result.data)) {
      console.log("Teacher Account:", result.data);
      renderListAccount(result.data);
    } else {
      Swal.fire("Thông báo", "Không lấy được dữ liệu giảng viên!", "warning");
    }
  } catch (error) {
    console.error(error);
    Swal.fire("Lỗi", "Lỗi khi lấy dữ liệu giảng viên!", "error");
  }
}

/**
 * Lọc tài khoản theo vai trò được chọn từ select box.
 */
function filterAccounts() {
  const fliter = document.getElementById("role_filter").value;

  switch (fliter) {
    case "1":
      getStudentAccount();
      break;
    case "2":
      getTeacherAccount();
      break;
    case "all":
      getAccountList();
  }
}

/**
 * Gửi yêu cầu cập nhật mật khẩu và trạng thái của tài khoản.
 *
 * @param {string} currentCode - Tên đăng nhập (username).
 * @param {string} newPassword - Mật khẩu mới.
 * @param {number|string} newStatus - Trạng thái mới (0 hoặc 1).
 */
async function updateAccount(currentCode, newPassword, newStatus) {
  const API_BASE = "http://localhost:3000";

  if (!currentCode || !newPassword || !newStatus) {
    Swal.fire("Lỗi", "Thiếu dữ liệu để cập nhật điểm!", "error");
    return;
  }

  console.log("update: " + currentCode, newPassword, newStatus);
  console.log("Status:", typeof newStatus, JSON.stringify(newStatus));
  newStatus = Number(newStatus);
  try {
    const res = await fetch(`${API_BASE}/api/v1/admin/updateAccount`, {
      method: "PUT",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        currentCode,
        newPassword,
        newStatus,
      }),
    });

    const data = await res.json();

    if (data.status === "success") {
      Swal.fire("Thành công", "Cập nhật thành công!", "success");
      getAccountList();
    } else {
      Swal.fire("Lỗi", data.message || "Không thể cập nhật điểm!", "error");
    }
  } catch (error) {
    console.error("Error:", error);
    Swal.fire("Lỗi", "Có lỗi xảy ra khi cập nhật điểm!", "error");
  }
}

/**
 * Bắt sự kiện nhập liệu vào ô tìm kiếm, lọc danh sách tài khoản theo tên hoặc username.
 */
document.getElementById("searchInput").addEventListener("input", function () {
  const keyword = this.value.trim().toLowerCase();

  const filtered = listAccount.filter((account) => {
    const fullName = account.info
      ? `${account.info.student_middle_name || ""} ${
          account.info.student_name || ""
        }`.toLowerCase()
      : "";

    const teacherName = account.info?.teacher_name?.toLowerCase() || "";

    return (
      account.user_username.toLowerCase().includes(keyword) ||
      fullName.includes(keyword) ||
      teacherName.includes(keyword)
    );
  });

  currentPage = 1;
  renderListAccount(filtered);
});

```

### frontend\js\Administrator\manage_account\admin_add_account_list.js
```js
document.addEventListener("DOMContentLoaded", async () => {});

/**
 * Sự kiện submit form thêm mới tài khoản.
 * Kiểm tra có chọn tài khoản nào không, nếu có thì gửi yêu cầu tạo tài khoản.
 */
document
  .getElementById("addNewAccountForm")
  .addEventListener("submit", async function (e) {
    e.preventDefault();

    const accounts = selectedRows();
    if (accounts.length === 0) {
      Swal.fire("Thông báo", "Bạn chưa chọn tài khoản nào!", "warning");
      return;
    }

    await addNewAccount(accounts);
  });

/**
 * Lấy danh sách tài khoản được chọn trong bảng (checkbox đã chọn).
 *
 * @returns {Array<{username: string, pass: string, role: string}>}
 * Mảng các tài khoản chứa username, password và role (vai trò).
 */
function selectedRows() {
  const selectedRows = document.querySelectorAll("#form-list tr");
  const accounts = [];

  selectedRows.forEach((row) => {
    const checkbox = row.querySelector(".checkbox-input");
    const passwordInput = row.querySelector(".password-input");
    const usernameSpan = row.querySelector("td:nth-child(2) span");

    if (checkbox && checkbox.checked) {
      const username = usernameSpan?.textContent?.trim();
      const password = passwordInput?.value?.trim();

      if (username && password) {
        accounts.push({
          username: username,
          pass: password,
          role: currentRole,
        });
      }
    }
  });

  return accounts;
}

/**
 * Gửi dữ liệu tài khoản mới lên server để thêm mới.
 *
 * @param {Array<{username: string, pass: string, role: string}>} datas - Mảng tài khoản cần tạo.
 * @returns {Promise<void>}
 */
async function addNewAccount(datas) {
  const API_BASE = "http://localhost:3000";
  try {
    const res = await fetch(`${API_BASE}/api/v1/admin/addNewAccount`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(datas),
    });

    const result = await res.json();

    if (result.status === "success") {
      Swal.fire("Thành công", "Đã tạo tài khoản thành công!", "success");
      await loadListByRole();
    } else {
      Swal.fire("Lỗi", result.message || "Tạo tài khoản thất bại!", "error");
    }
  } catch (err) {
    console.error("Lỗi khi gửi dữ liệu:", err);
    Swal.fire("Lỗi", "Không thể gửi yêu cầu tạo tài khoản!", "error");
  }
}

```

### frontend\js\Administrator\manage_account\admin_display_account_list.js
```js
/**
 * Sự kiện DOMContentLoaded được kích hoạt khi toàn bộ HTML được tải xong.
 * Gọi hàm load danh sách theo vai trò ban đầu.
 */
document.addEventListener("DOMContentLoaded", async () => {
  await loadListByRole();
});

/**
 * Sự kiện khi thay đổi lựa chọn vai trò (sinh viên / giảng viên).
 * Đặt lại trang hiện tại về 1 và tải lại danh sách theo vai trò mới.
 */
document.getElementById("role").addEventListener("change", async () => {
  currentPage = 1;
  await loadListByRole();
});

/**
 * Tạo mật khẩu ngẫu nhiên với độ dài nhất định.
 *
 * @param {number} length - Độ dài chuỗi mật khẩu mong muốn.
 * @returns {string} - Mật khẩu được sinh ra ngẫu nhiên.
 */
function generateRandomPassword(length) {
  const chars =
    "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%&*";
  let password = "";
  for (let i = 0; i < length; i++) {
    const randomIndex = Math.floor(Math.random() * chars.length);
    password += chars[randomIndex];
  }
  return password;
}

// === Biến toàn cục ===
/** @type {number} */
const limitRows = 5;
/** @type {number} */
let currentPage = 1;
/** @type {Array<Object>} */
let filterDatas = [];
let currentRole = "1";

/**
 * Kiểm tra vai trò được chọn (sinh viên hoặc giảng viên) và gọi API tương ứng để lấy danh sách.
 */
async function loadListByRole() {
  const roleValue = document.getElementById("role").value;
  currentRole = roleValue;

  if (roleValue === "2") {
    // Giảng viên
    await getListTeacherCode();
  } else {
    // Sinh viên
    await getListStudentCode();
  }
}

/**
 * Gửi yêu cầu API để lấy danh sách mã học viên.
 * Gọi hàm render danh sách học viên nếu thành công.
 */
async function getListStudentCode() {
  const API_BASE = "http://localhost:3000";
  try {
    const res = await fetch(`${API_BASE}/api/v1/admin/getListStudentCode`);

    const result = await res.json();

    if (result.status === "success" && result.data) {
      filterDatas = [...result.data];
      renderStudentList(filterDatas);
    } else {
      Swal.fire("Thông báo", "Không lấy được dữ liệu!", "warning");
    }
  } catch (error) {
    console.error(error);
    Swal.fire("Lỗi", "Lỗi khi lấy dữ liệu!", "error");
  }
}

/**
 * Gửi yêu cầu API để lấy danh sách mã giảng viên.
 * Gọi hàm render danh sách giảng viên nếu thành công.
 */
async function getListTeacherCode() {
  const API_BASE = "http://localhost:3000";
  try {
    const res = await fetch(`${API_BASE}/api/v1/admin/getListTeacherCode`);

    const result = await res.json();

    if (result.status === "success" && result.data) {
      filterDatas = [...result.data];
      renderTeacherList(filterDatas);
    } else {
      Swal.fire("Thông báo", "Không lấy được dữ liệu!", "warning");
    }
  } catch (error) {
    console.error(error);
    Swal.fire("Lỗi", "Lỗi khi lấy dữ liệu!", "error");
  }
}

/**
 * Gán dữ liệu và hiển thị danh sách học viên trên giao diện, kèm phân trang.
 *
 * @param {Array<Object>} students - Mảng dữ liệu học viên từ server.
 */
function renderStudentList(students) {
  filterDatas = students;
  displayStudentListPage(currentPage);
  renderPagination();
}

/**
 * Hiển thị danh sách học viên theo trang.
 *
 * @param {number} page - Trang cần hiển thị.
 */
function displayStudentListPage(page) {
  const studentList = document.getElementById("form-list");
  studentList.innerHTML = ""; // Clear existing rows
  const start = (page - 1) * limitRows;
  const end = start + limitRows;
  const items = filterDatas.slice(start, end);

  items.forEach((student) => {
    const newPassword = generateRandomPassword(8);
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>
        <input class="form-check-input checkbox-input" type="checkbox" />
	  </td>
      <td><span>${student.student_code}</span></td>
      <td><span>${student.student_middle_name}
	  ${student.student_name}</span></td>
      <td>
			<input
			type="password"
			class="form-control password-input"
			name="password"
			required
			value="${newPassword}"
			/>
		</td>
	`;
    studentList.appendChild(row);
  });
}

/**
 * Gán dữ liệu và hiển thị danh sách giảng viên trên giao diện, kèm phân trang.
 *
 * @param {Array<Object>} teacher - Mảng dữ liệu giảng viên từ server.
 */
function renderTeacherList(teacher) {
  filterDatas = teacher;
  displayTeacherListPage(currentPage);
  renderPagination();
}

/**
 * Hiển thị danh sách giảng viên theo trang.
 *
 * @param {number} page - Trang cần hiển thị.
 */
function displayTeacherListPage(page) {
  const teacherList = document.getElementById("form-list");
  teacherList.innerHTML = ""; // Clear existing rows
  const start = (page - 1) * limitRows;
  const end = start + limitRows;
  const items = filterDatas.slice(start, end);

  items.forEach((teacher) => {
    const newPassword = generateRandomPassword(8);
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>
        <input class="form-check-input checkbox-input" type="checkbox"/>
	  </td>
      <td><span>${teacher.teacher_code}</span></td>
      <td><span>${teacher.teacher_name}</span></td>
      <td>
			<input
			type="password"
			class="form-control password-input"
			name="password"
			value="${newPassword}"
			/>
		</td>
	`;
    teacherList.appendChild(row);
  });
}

/**
 * Vẽ thanh phân trang ở dưới bảng dữ liệu.
 * Bao gồm nút "«", "»", các trang hiện tại, đầu/cuối, và dấu "...".
 */
function renderPagination() {
  const totalPages = Math.ceil(filterDatas.length / limitRows);
  const pagination = document.getElementById("pagination");
  pagination.innerHTML = "";

  const maxVisible = 3; // Số nút trang muốn hiển thị xung quanh trang hiện tại
  let startPage = Math.max(1, currentPage - Math.floor(maxVisible / 2));
  let endPage = Math.min(totalPages, startPage + maxVisible - 1);

  // Điều chỉnh nếu cuối danh sách
  if (endPage - startPage < maxVisible - 1) {
    startPage = Math.max(1, endPage - maxVisible + 1);
  }

  // Nút "«" ← previous
  if (currentPage > 1) {
    pagination.appendChild(createPageItem("«", currentPage - 1));
  }

  // Nút trang đầu + dấu ...
  if (startPage > 1) {
    pagination.appendChild(createPageItem(1, 1));
    if (startPage > 2) {
      pagination.appendChild(createEllipsis());
    }
  }

  // Các nút trang chính giữa
  for (let i = startPage; i <= endPage; i++) {
    const li = createPageItem(i, i);
    if (i === currentPage) li.classList.add("active");
    pagination.appendChild(li);
  }

  // Dấu ... + trang cuối
  if (endPage < totalPages) {
    if (endPage < totalPages - 1) {
      pagination.appendChild(createEllipsis());
    }
    pagination.appendChild(createPageItem(totalPages, totalPages));
  }

  // Nút "»" → next
  if (currentPage < totalPages) {
    pagination.appendChild(createPageItem("»", currentPage + 1));
  }
}

/**
 * Tạo một phần tử nút trang (ví dụ: 1, 2, «, »).
 *
 * @param {string|number} label - Nhãn hiển thị của nút (ví dụ: "1", "»").
 * @param {number} pageNum - Trang sẽ được hiển thị khi click.
 * @returns {HTMLLIElement} - Phần tử <li> tương ứng.
 */
function createPageItem(label, pageNum) {
  const li = document.createElement("li");
  li.className = "page-item";
  const a = document.createElement("a");
  a.className = "page-link";
  a.href = "#";
  a.textContent = label;
  a.addEventListener("click", (e) => {
    e.preventDefault();
    currentPage = pageNum;
    if (currentRole === "2") {
      displayTeacherListPage(currentPage);
    } else {
      displayStudentListPage(currentPage);
    }

    renderPagination();
  });
  li.appendChild(a);
  return li;
}

/**
 * Tạo phần tử dấu ba chấm (...) trong thanh phân trang.
 *
 * @returns {HTMLLIElement} - Phần tử <li> disabled hiển thị "...".
 */
function createEllipsis() {
  const li = document.createElement("li");
  li.className = "page-item disabled";
  li.innerHTML = `<span class="page-link">...</span>`;
  return li;
}

```

### frontend\js\Administrator\manage_certificate\admin_add_certificate.js
```js
let listModule = [];

/**
 * Sự kiện click vào nút "Duyệt chứng chỉ" trên từng dòng học viên.
 * Gửi mã học viên và class_subject_id để thực hiện Duyệt chứng chỉ.
 */
document.getElementById("form-list").addEventListener("click", async (e) => {
  const btn = e.target.closest(".btn-addCert");
  if (!btn) return;

  const stCode = btn.getAttribute("data-code");
  const clsID = btn.getAttribute("data-class-subject");

  if (!stCode || !clsID) {
    console.log("Không lấy được dữ liệu");
    return;
  }

  console.log("stCode", stCode);
  console.log("clsID", clsID);

  await addCertificates(stCode, clsID);
});

/**
 * Gửi yêu cầu API để cấp chứng chỉ cho học viên (hoặc danh sách học viên).
 *
 * @param {string|string[]} stCode - Mã học viên (hoặc danh sách mã).
 * @param {string|number} clsID - ID của lớp học phần (class_subject_id).
 * @returns {Promise<void>}
 */
async function addCertificates(stCode, clsID) {
  const API_BASE = "http://localhost:3000";
  try {
    const res = await fetch(`${API_BASE}/api/v1/admin/addCertificates`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        class_subject_id: Number(clsID),
        student_codes: Array.isArray(stCode) ? stCode : [stCode],
      }),
    });

    const result = await res.json();

    if (result.status === "success") {
      getStudentEligible?.(); // nếu có hàm làm mới danh sách
      Swal.fire("Thành Công", "Cấp chứng chỉ thành công!", "success");
    } else {
      Swal.fire("Lỗi", result.message || "Không thành công!", "error");
    }
  } catch (err) {
    console.error("Fetch error:", err);
    Swal.fire("Lỗi", err.message || "Lỗi hệ thống", "error");
  }
}

/**
 * Lấy danh sách mã học viên từ các dòng được checkbox chọn.
 *
 * @returns {string[]} - Mảng các mã học viên.
 */
function selectedRows() {
  const checkboxes = document.querySelectorAll(".checkbox-input");
  const students = [];

  checkboxes.forEach((checkbox) => {
    if (checkbox.checked) {
      const row = checkbox.closest("tr");
      const studentCode = row
        ?.querySelector("td:nth-child(2)")
        ?.textContent?.trim();
      if (studentCode) students.push(studentCode);
    }
  });

  return students;
}

/**
 * Sự kiện click vào nút "Phê duyệt" để cấp chứng chỉ hàng loạt.
 * Gọi `addCertificates` với danh sách mã học viên được chọn.
 */
document.getElementById("btnApprove").addEventListener("click", async (e) => {
  e.preventDefault();
  const students = selectedRows();

  if (students.length === 0) {
    Swal.fire("Thông báo", "Bạn chưa chọn học sinh nào!", "warning");
    return;
  }

  await addCertificates(students, class_subject_id);
});

/**
 * Gửi yêu cầu API để lấy danh sách môn học (module) để lọc.
 *
 * @returns {Promise<Array<Object>>} - Danh sách các môn học, hoặc [] nếu lỗi.
 */
async function getModuleFilter() {
  const API_BASE = "http://localhost:3000";
  try {
    const res = await fetch(`${API_BASE}/api/v1/admin/getModuleFilter`);
    const result = await res.json();
    if (result.status === "success") return result.data;
    Swal.fire(
      "Lỗi",
      result.message || "Không lấy được danh sách môn học",
      "error"
    );
  } catch (err) {
    console.error("Lỗi khi gửi dữ liệu:", err);
    Swal.fire("Lỗi", "Không thể kết nối máy chủ", "error");
  }
  return [];
}

/**
 * Sự kiện DOMContentLoaded: lấy danh sách môn học và hiển thị trong dropdown lọc.
 * Gán vào biến toàn cục `listModule` và `filterDatas`.
 */
document.addEventListener("DOMContentLoaded", async () => {
  listModule = await getModuleFilter();
  filterDatas = [...listModule];

  const moduleFilter = document.getElementById("courseFilter");
  moduleFilter.innerHTML = `<option value="">-- Chọn môn học --</option>`;

  listModule.forEach((item) => {
    const moduleItem = document.createElement("option");
    moduleItem.value = item.module_code;
    moduleItem.textContent = `${item.module_code} - ${item.module_name}`;
    moduleFilter.appendChild(moduleItem);
  });
});

/**
 * Sự kiện khi người dùng chọn môn học từ dropdown.
 * Lọc danh sách học viên theo mã hoặc tên môn học.
 */
document.getElementById("courseFilter").addEventListener("change", function () {
  const keyword = this.value.trim().toLowerCase();

  const filtered = studentDatas.filter((student) => {
    return (
      student.module_code.toLowerCase().includes(keyword) ||
      student.module_name.toLowerCase().includes(keyword)
    );
  });

  currentPage = 1;
  filterDatas = filtered;
  renderStudentList(filtered);
});

```

### frontend\js\Administrator\manage_certificate\admin_display_certificate.js
```js
const urlParams = new URLSearchParams(window.location.search);
let class_subject_id = urlParams.get("class_subject"); // có thể gán trực tiếp

let className = urlParams.get("class_name");
let moduleName = urlParams.get("module_name");

/**
 * Khi DOM đã tải xong, thực hiện:
 * - Lấy dữ liệu chứng chỉ từ API (`getCertificates`)
 * - Hiển thị tên môn học và lớp học trên giao diện.
 */
document.addEventListener("DOMContentLoaded", async () => {
  await getCertificates();
  renderModuleName();
});

/**
 * Hiển thị tên môn học và tên lớp học lên giao diện.
 * Lấy dữ liệu từ URL query params: `module_name`, `class_name`.
 */
function renderModuleName() {
  document.querySelector(".module_name").textContent = moduleName;
  document.querySelector(".class_name").textContent = className;
}

/**
 * Gửi yêu cầu API để lấy danh sách học viên đã được cấp chứng chỉ cho lớp học phần hiện tại.
 * Dữ liệu được lấy theo `class_subject_id` trong URL.
 * Gán dữ liệu vào biến toàn cục `studentDatas` và `filterDatas`, rồi hiển thị ra bảng.
 */
async function getCertificates() {
  const API_BASE = "http://localhost:3000";
  try {
    const res = await fetch(
      `${API_BASE}/api/v1/admin/getCertificates?class_subject_id=${class_subject_id}`
    );
    const result = await res.json();

    if (result.status === "success" && Array.isArray(result.data)) {
      console.log("Student List:", result.data);
      studentDatas = result.data;
      filterDatas = [...studentDatas];
      renderStudentList(filterDatas);
    } else {
      console.log("Chưa Có Dữ Liệu!!!");
      //   Swal.fire("Thông báo", "Không lấy được dữ liệu!", "warning");
    }
  } catch (error) {
    console.error(error);
    Swal.fire("Lỗi", "Lỗi khi lấy dữ liệu!", "error");
  }
}

// === Biến toàn cục ===
/** @type {number} */
const limitRows = 8;
/** @type {number} */
let currentPage = 1;
/** @type {Array<Object>} */
let studentDatas = []; // Dữ liệu gốc
/** @type {Array<Object>} */
let filterDatas = []; // Dữ liệu sẽ hiển thị khi tìm kiếm

/**
 * Gán dữ liệu danh sách học viên và hiển thị bảng danh sách theo trang.
 *
 * @param {Array<Object>} students - Mảng đối tượng học viên (có thông tin chứng chỉ).
 */
function renderStudentList(students) {
  filterDatas = students;
  displayStudentListPage(currentPage);
  renderPagination();
}

/**
 * Hiển thị bảng danh sách học viên cho một trang cụ thể.
 *
 * @param {number} page - Trang cần hiển thị (bắt đầu từ 1).
 */
function displayStudentListPage(page) {
  const studentList = document.getElementById("form-list");
  studentList.innerHTML = ""; // Clear existing rows
  const start = (page - 1) * limitRows;
  const end = start + limitRows;
  const items = filterDatas.slice(start, end);

  items.forEach((student, index) => {
    let day = student.issued_date;
    let idCard = student.student_IDCard || "Chưa có thông tin";
    let address = student.student_address || "Chưa có thông tin";
    formatDate = day ? dayjs(day).format("DD/MM/YYYY") : "-";
    const row = document.createElement("tr");
    row.innerHTML = `
      	<td>${index + start + 1}</td>
		<td>${student.student_code}</td>
		<td>${student.student_middle_name} ${student.student_name}</td>
		<td class="${idCard === "Chưa có thông tin" ? "text-danger" : ""}">
			${idCard}
		</td>
		<td class="${address === "Chưa có thông tin" ? "text-danger" : ""}">
			${address}
		</td>
		<td>${student.cert_number}</td>
		<td>${student.cert_number_id}</td>
		<td>${formatDate}</td>
		
	`;
    studentList.appendChild(row);
  });
}

/**
 * Vẽ thanh phân trang phía dưới bảng.
 * Tự động thêm các nút trang, dấu "..." và nút chuyển trang trước/sau.
 */
function renderPagination() {
  const totalPages = Math.ceil(filterDatas.length / limitRows);
  const pagination = document.getElementById("pagination");
  pagination.innerHTML = "";

  const maxVisible = 3; // Số nút trang muốn hiển thị xung quanh trang hiện tại
  let startPage = Math.max(1, currentPage - Math.floor(maxVisible / 2));
  let endPage = Math.min(totalPages, startPage + maxVisible - 1);

  // Điều chỉnh nếu cuối danh sách
  if (endPage - startPage < maxVisible - 1) {
    startPage = Math.max(1, endPage - maxVisible + 1);
  }

  // Nút "«" ← previous
  if (currentPage > 1) {
    pagination.appendChild(createPageItem("«", currentPage - 1));
  }

  // Nút trang đầu + dấu ...
  if (startPage > 1) {
    pagination.appendChild(createPageItem(1, 1));
    if (startPage > 2) {
      pagination.appendChild(createEllipsis());
    }
  }

  // Các nút trang chính giữa
  for (let i = startPage; i <= endPage; i++) {
    const li = createPageItem(i, i);
    if (i === currentPage) li.classList.add("active");
    pagination.appendChild(li);
  }

  // Dấu ... + trang cuối
  if (endPage < totalPages) {
    if (endPage < totalPages - 1) {
      pagination.appendChild(createEllipsis());
    }
    pagination.appendChild(createPageItem(totalPages, totalPages));
  }

  // Nút "»" → next
  if (currentPage < totalPages) {
    pagination.appendChild(createPageItem("»", currentPage + 1));
  }
}

/**
 * Tạo một phần tử nút trang (có thể là số trang hoặc ký hiệu điều hướng).
 *
 * @param {string|number} label - Nội dung hiển thị của nút (ví dụ: 1, "«", "»").
 * @param {number} pageNum - Trang sẽ hiển thị khi người dùng click vào nút này.
 * @returns {HTMLLIElement} - Phần tử <li> chứa nút chuyển trang.
 */
function createPageItem(label, pageNum) {
  const li = document.createElement("li");
  li.className = "page-item";
  const a = document.createElement("a");
  a.className = "page-link";
  a.href = "#";
  a.textContent = label;
  a.addEventListener("click", (e) => {
    e.preventDefault();
    currentPage = pageNum;
    displayStudentListPage(currentPage);
    renderPagination();
  });
  li.appendChild(a);
  return li;
}

/**
 * Tạo phần tử dấu ba chấm "..." dùng trong phân trang để biểu thị trang bị ẩn.
 *
 * @returns {HTMLLIElement} - Phần tử <li> disabled với nội dung "...".
 */
function createEllipsis() {
  const li = document.createElement("li");
  li.className = "page-item disabled";
  li.innerHTML = `<span class="page-link">...</span>`;
  return li;
}

/**
 * (Tạm thời bị comment)
 * Tìm kiếm học viên theo mã sinh viên, họ tên hoặc số điện thoại.
 * Lọc từ `studentDatas` gốc và hiển thị lại bảng theo kết quả lọc.
 */
// document.getElementById("searchInput").addEventListener("input", function () {
//   const keyword = this.value.trim().toLowerCase();

//   // filter dữ liệu từ danh sách sinh viên gốc
//   const filtered = studentDatas.filter((student) => {
//     const fullName =
//       `${student.student_middle_name} ${student.student_name}`.toLowerCase();
//     return (
//       student.student_code.toLowerCase().includes(keyword) ||
//       fullName.includes(keyword) ||
//       student.student_phone?.toLowerCase().includes(keyword)
//     );
//   });

//   currentPage = 1;
//   renderStudentList(filtered);
// });

function sendReminder() {
  const rows = document.querySelectorAll("#form-list tr");
  const studentsToRemind = [];

  rows.forEach((row, index) => {
    const cccd = row.children[3]?.textContent?.trim();
    const address = row.children[4]?.textContent?.trim();
    const studentCode = row.children[1]?.textContent?.trim();

    console.log("cccd", cccd);
    console.log("address", address);
    console.log("studentCode", studentCode);

    if (
      cccd.toLowerCase() === "chưa có thông tin" ||
      address.toLowerCase() === "chưa có thông tin"
    ) {
      studentsToRemind.push(studentCode || `Học viên dòng ${index + 1}`);
    }
  });

  if (studentsToRemind.length === 0) {
    Swal.fire({
      icon: "success",
      title: "Tất cả thông tin đã đầy đủ!",
      text: "Không có học viên nào cần nhắc nhở.",
    });
  } else {
    Swal.fire({
      icon: "warning",
      title: "Cần nhắc nhở cập nhật thông tin",
      html: `
          <p>Các học viên sau chưa cập nhật đầy đủ CCCD hoặc địa chỉ:</p>
          <ul style="text-align: left;">
            ${studentsToRemind.map((code) => `<li>${code}</li>`).join("")}
          </ul>
          <p>Bạn có muốn gửi thông báo nhắc nhở không?</p>
        `,
      showCancelButton: true,
      confirmButtonText: "Gửi",
      cancelButtonText: "Huỷ",
    }).then((result) => {
      if (result.isConfirmed) {
        Swal.fire({
          icon: "success",
          title: "Đã gửi nhắc nhở!",
          text: "Thông báo đã được gửi đến các học viên.",
        });

        // TODO: Gửi thông báo thực tế thông qua API hoặc WebSocket nếu cần
      }
    });
  }
}

```

### frontend\js\Administrator\manage_certificate\admin_display_cert_class.js
```js
/**
 * Sự kiện được gọi khi toàn bộ DOM đã tải hoàn tất.
 * Gọi hàm `getCertClass` để lấy dữ liệu các lớp đã được cấp chứng chỉ.
 */
document.addEventListener("DOMContentLoaded", function () {
  getCertClass();
});

/**
 * Gửi yêu cầu API để lấy danh sách các lớp học đã cấp chứng chỉ.
 * Nếu thành công, gọi hàm `renderCertClass` để hiển thị dữ liệu.
 *
 * @returns {Promise<void>}
 */
async function getCertClass() {
  const API_BASE = "http://localhost:3000";
  try {
    const res = await fetch(`${API_BASE}/api/v1/admin/getClassCert`);

    const result = await res.json();
    console.log("result: ", result);

    if (result.status === "success") {
      const CertClass = result.data;
      renderCertClass(CertClass);
    } else {
      Swal.fire("Thông báo", "Không lấy được dữ liệu!", "warning");
    }
  } catch (error) {
    console.error(error);
    Swal.fire("Lỗi", "Lỗi khi lấy dữ liệu!", "error");
  }
}

/**
 * Tạo và hiển thị danh sách các lớp học đã cấp chứng chỉ dưới dạng thẻ (card).
 *
 * @param {Array<Object>} CertClasses - Mảng đối tượng chứa thông tin lớp, giảng viên, môn học, class_subject_id.
 *
 * Mỗi phần tử phải có cấu trúc:
 * {
 *   module_code: string,
 *   module_name: string,
 *   teacher_name: string,
 *   class_name: string,
 *   class_subject_id: number
 * }
 */
function renderCertClass(CertClasses) {
  const certClassList = document.querySelector(".class-cert-list");
  certClassList.innerHTML = ""; // Xoá nội dung cũ

  CertClasses.forEach((CertClasses) => {
    const div = document.createElement("div");
    div.className = "col-md-3 col-sm-6";
    div.innerHTML = `
	<div class="card ">
		<img src="../images/b3.jpg" class="card-img-top" alt="..." />
		<div class="card-body">
		<h5 class="card-title marquee-hover text-center">
			<span>${CertClasses.module_code} - ${CertClasses.module_name}</span>
		</h5>
		<p
			class="card-text card_teacher_name marquee-hover text-center"
		>
			<span>${CertClasses.teacher_name}</span>
		</p>
		<p class="card-text card_class_name marquee-hover text-center">
			<span>Class: ${CertClasses.class_name}</span>
		</p>
		<div class="text-center">
			<button
			class="btn btn-primary"
			onclick="location.href='page_certificate.html?module=${CertClasses["module_code"]}&class_subject=${CertClasses["class_subject_id"]}&class_name=${CertClasses["class_name"]}&module_name=${CertClasses["module_name"]}'"
			>
			Access
			</button>
		</div>
		</div>
	</div>
	`;
    certClassList.appendChild(div);
  });
}

```

### frontend\js\Administrator\manage_certificate\admin_get_student.js
```js
/**
 * Khi DOM được tải xong, gọi hàm `getStudentEligible` để lấy danh sách học viên đủ điều kiện cấp chứng chỉ.
 */
document.addEventListener("DOMContentLoaded", async () => {
  getStudentEligible();
});

/**
 * Gửi yêu cầu đến API để lấy danh sách học viên đủ điều kiện cấp chứng chỉ.
 * Nếu thành công,
 * gán dữ liệu vào biến toàn cục `studentDatas` và `filterDatas`,
 * sau đó hiển thị bằng `renderStudentList`.
 *
 * @returns {Promise<void>}
 */
async function getStudentEligible() {
  const API_BASE = "http://localhost:3000";
  try {
    const res = await fetch(`${API_BASE}/api/v1/admin/getStudentEligible`);
    const result = await res.json();

    if (result.status === "success" && Array.isArray(result.data)) {
      console.log("Student List:", result.data);
      studentDatas = result.data;
      filterDatas = [...studentDatas];
      renderStudentList(filterDatas);
    } else {
      console.log("Chưa Có Dữ Liệu!!!");
      //   Swal.fire("Thông báo", "Không lấy được dữ liệu!", "warning");
    }
  } catch (error) {
    console.error(error);
    Swal.fire("Lỗi", "Lỗi khi lấy dữ liệu!", "error");
  }
}

/** @type {number} */
const limitRows = 5; // Số dòng hiển thị mỗi trang

/** @type {number} */
let currentPage = 1; // Trang hiện tại

/** @type {Array<Object>} */
let studentDatas = []; // Danh sách học viên gốc từ API

/** @type {Array<Object>} */
let filterDatas = []; // Dữ liệu học viên sau khi lọc hoặc phân trang

/** @type {number} */
let class_subject_id = 0; // ID lớp học phần lấy từ từng dòng học viên

/**
 * Gán danh sách học viên và hiển thị dữ liệu cho trang hiện tại.
 *
 * @param {Array<Object>} students - Mảng đối tượng học viên từ API.
 */
function renderStudentList(students) {
  filterDatas = students;
  displayStudentListPage(currentPage);
  renderPagination();
}

/**
 * Hiển thị bảng học viên theo một trang cụ thể.
 * Gồm thông tin mã SV, tên, môn học, lớp, điểm, ngày cấp chứng chỉ và nút "Duyệt".
 *
 * @param {number} page - Số trang cần hiển thị.
 */
function displayStudentListPage(page) {
  const studentList = document.getElementById("form-list");
  studentList.innerHTML = ""; // Clear existing rows
  const start = (page - 1) * limitRows;
  const end = start + limitRows;
  const items = filterDatas.slice(start, end);

  if (items.length > 0) {
    items.forEach((student) => {
      let day = student.issued_date;
      class_subject_id = student.class_subject_id;
      formatDate = day ? dayjs(day).format("DD/MM/YYYY") : "-";
      const row = document.createElement("tr");
      row.innerHTML = `
				<td><input type="checkbox" class="checkbox-input" /></td>
			  <td>${student.student_code}</td>
			  <td>${student.student_middle_name} ${student.student_name}</td>
			  <td>${student.module_name}</td>
			  <td>${student.class_name}</td>
			  <td>${student.score}</td>
			  <td>${formatDate}</td>
			  <td>
				  <button
					  data-code="${student["student_code"]}"
					  data-class-subject="${student["class_subject_id"]}"
					  type="button" class="btn btn-primary btn-addCert"
				  >
				  <i class="bi bi-patch-check"></i> Duyệt Chứng Chỉ
				  </button>
			  </td>
		  `;
      studentList.appendChild(row);
    });
  } else {
    studentList.innerHTML = `
		<tr>
			<td colspan="8" class="text-center text-muted bg-body-secondary">Chưa có học sinh đủ điều kiện</td>
		</tr>
	`;
  }
}

/**
 * Vẽ thanh phân trang cho bảng học viên.
 * Bao gồm các nút điều hướng "«", "»", số trang, và dấu "..." nếu cần.
 */
function renderPagination() {
  const totalPages = Math.ceil(filterDatas.length / limitRows);
  const pagination = document.getElementById("pagination");
  pagination.innerHTML = "";

  const maxVisible = 3; // Số nút trang muốn hiển thị xung quanh trang hiện tại
  let startPage = Math.max(1, currentPage - Math.floor(maxVisible / 2));
  let endPage = Math.min(totalPages, startPage + maxVisible - 1);

  // Điều chỉnh nếu cuối danh sách
  if (endPage - startPage < maxVisible - 1) {
    startPage = Math.max(1, endPage - maxVisible + 1);
  }

  // Nút "«" ← previous
  if (currentPage > 1) {
    pagination.appendChild(createPageItem("«", currentPage - 1));
  }

  // Nút trang đầu + dấu ...
  if (startPage > 1) {
    pagination.appendChild(createPageItem(1, 1));
    if (startPage > 2) {
      pagination.appendChild(createEllipsis());
    }
  }

  // Các nút trang chính giữa
  for (let i = startPage; i <= endPage; i++) {
    const li = createPageItem(i, i);
    if (i === currentPage) li.classList.add("active");
    pagination.appendChild(li);
  }

  // Dấu ... + trang cuối
  if (endPage < totalPages) {
    if (endPage < totalPages - 1) {
      pagination.appendChild(createEllipsis());
    }
    pagination.appendChild(createPageItem(totalPages, totalPages));
  }

  // Nút "»" → next
  if (currentPage < totalPages) {
    pagination.appendChild(createPageItem("»", currentPage + 1));
  }
}

/**
 * Tạo một nút trang (số hoặc điều hướng).
 * @param {string|number} label - Nội dung hiển thị của nút
 * @param {number} pageNum - Số trang tương ứng khi click
 * @returns {HTMLLIElement} - Phần tử <li> chứa nút
 */
function createPageItem(label, pageNum) {
  const li = document.createElement("li");
  li.className = "page-item";
  const a = document.createElement("a");
  a.className = "page-link";
  a.href = "#";
  a.textContent = label;
  a.addEventListener("click", (e) => {
    e.preventDefault();
    currentPage = pageNum;
    displayStudentListPage(currentPage);
    renderPagination();
  });
  li.appendChild(a);
  return li;
}

/**
 * Tạo phần tử dấu ba chấm "..." trong thanh phân trang.
 * Dùng khi danh sách trang dài.
 *
 * @returns {HTMLLIElement} - Phần tử <li> đã disable, chỉ hiển thị "…"
 */
function createEllipsis() {
  const li = document.createElement("li");
  li.className = "page-item disabled";
  li.innerHTML = `<span class="page-link">...</span>`;
  return li;
}

/**
 * (Đã bị comment)
 * Lọc danh sách học viên theo ô tìm kiếm.
 * Lọc theo mã SV, tên đầy đủ hoặc số điện thoại (nếu có).
 */
// document.getElementById("searchInput").addEventListener("input", function () {
//   const keyword = this.value.trim().toLowerCase();

//   // filter dữ liệu từ danh sách sinh viên gốc
//   const filtered = studentDatas.filter((student) => {
//     const fullName =
//       `${student.student_middle_name} ${student.student_name}`.toLowerCase();
//     return (
//       student.student_code.toLowerCase().includes(keyword) ||
//       fullName.includes(keyword) ||
//       student.student_phone?.toLowerCase().includes(keyword)
//     );
//   });

//   currentPage = 1;
//   renderStudentList(filtered);
// });

```

### frontend\js\Administrator\manage_class\admin_add_class.js
```js
/**
 * Khi DOM được load xong, gọi API để lấy danh sách môn học (module),
 * sau đó render các option vào dropdown filter `#courseFilter`.
 */
document.addEventListener("DOMContentLoaded", async () => {
  listModule = await getModuleFilter();
  console.log("list filter: ", listModule);
  const moduleFilter = document.getElementById("courseFilter");
  moduleFilter.innerHTML = `<option value="">-- Chọn môn học --</option>`;

  listModule.forEach((item) => {
    const moduleItem = document.createElement("option");
    moduleItem.value = item.module_code;
    moduleItem.textContent = `${item.module_code} - ${item.module_name}`;
    moduleFilter.appendChild(moduleItem);
  });
});

/**
 * Lắng nghe sự kiện submit của form tạo lớp.
 * Lấy dữ liệu từ form và gọi hàm `createClassWithTeacher` để gửi về server.
 * Sau khi tạo thành công, đóng modal và reset form.
 */
document
  .getElementById("createClassForm")
  .addEventListener("submit", async function (e) {
    e.preventDefault();

    const classID = document.getElementById("newTenLop").value.trim();
    const moduleID = document.getElementById("newTenMon").value.trim();
    const semesterID = document.getElementById("newHocKi").value.trim();
    const teacherCode = document.getElementById("newGiangVien").value.trim();

    await createClassWithTeacher(classID, moduleID, semesterID, teacherCode);

    const modal = bootstrap.Modal.getInstance(
      document.getElementById("createClassModal")
    );
    modal.hide();
    modal.reset();
  });

/**
 * Gửi yêu cầu lấy danh sách các lớp học và học kỳ tương ứng từ backend.
 * Dữ liệu này được sử dụng trong modal tạo lớp.
 *
 * @returns {Promise<Array<Object>|undefined>} - Danh sách lớp và học kỳ.
 */
async function getClassCodeAndSemester() {
  const API_BASE = "http://localhost:3000";
  try {
    const res = await fetch(`${API_BASE}/api/v1/admin/getClassCodeAndSemester`);

    const result = await res.json();

    if (result.status === "success") {
      return result.data;
    } else {
      Swal.fire(
        "Lỗi",
        result.message || "Lấy danh sách lớp thất bại!",
        "error"
      );
    }
  } catch (err) {
    console.error("Lỗi khi gửi dữ liệu:", err);
    Swal.fire("Lỗi", "Không thể gửi yêu cầu lấy danh sách lớp!", "error");
  }
}

/**
 * Lấy danh sách tất cả môn học (module) từ backend.
 *
 * @returns {Promise<Array<Object>|undefined>} - Danh sách môn học.
 */
async function getModuleCode() {
  const API_BASE = "http://localhost:3000";
  try {
    const res = await fetch(`${API_BASE}/api/v1/admin/getModuleCode`);

    const result = await res.json();

    if (result.status === "success") {
      return result.data;
    } else {
      Swal.fire(
        "Lỗi",
        result.message || "Lấy danh sách lớp thất bại!",
        "error"
      );
    }
  } catch (err) {
    console.error("Lỗi khi gửi dữ liệu:", err);
    Swal.fire("Lỗi", "Không thể gửi yêu cầu lấy danh sách lớp!", "error");
  }
}

/**
 * Lấy danh sách môn học dùng để lọc danh sách lớp hiển thị.
 *
 * @returns {Promise<Array<Object>|undefined>} - Danh sách môn học để hiển thị trong dropdown lọc.
 */
async function getModuleFilter() {
  const API_BASE = "http://localhost:3000";
  try {
    const res = await fetch(`${API_BASE}/api/v1/admin/getModuleFilter`);

    const result = await res.json();

    if (result.status === "success") {
      return result.data;
    } else {
      Swal.fire(
        "Lỗi",
        result.message || "Lấy danh sách lớp thất bại!",
        "error"
      );
    }
  } catch (err) {
    console.error("Lỗi khi gửi dữ liệu:", err);
    Swal.fire("Lỗi", "Không thể gửi yêu cầu lấy danh sách lớp!", "error");
  }
}

/**
 * Lấy danh sách giảng viên từ backend.
 * Dữ liệu dùng để chọn giảng viên khi tạo lớp mới.
 *
 * @returns {Promise<Array<Object>|undefined>} - Danh sách giảng viên.
 */
async function getTeacherList() {
  const API_BASE = "http://localhost:3000";
  try {
    const res = await fetch(`${API_BASE}/api/v1/admin/getTeacherList`);
    const result = await res.json();

    if (result.status === "success" && Array.isArray(result.data)) {
      return result.data;
    } else {
      Swal.fire("Thông báo", "Không lấy được dữ liệu!", "warning");
    }
  } catch (error) {
    console.error(error);
    Swal.fire("Lỗi", "Lỗi khi lấy dữ liệu!", "error");
  }
}

/**
 * Gửi yêu cầu tạo lớp học mới với thông tin lớp, môn học, học kỳ, và giảng viên.
 * Nếu thành công, hiển thị thông báo và làm mới danh sách lớp học.
 *
 * @param {string} classID - ID lớp học được chọn.
 * @param {string} moduleID - ID môn học được chọn.
 * @param {string} semesterID - ID học kỳ được chọn.
 * @param {string} teacherCode - Mã giảng viên được chọn.
 * @returns {Promise<void>}
 */
async function createClassWithTeacher(
  classID,
  moduleID,
  semesterID,
  teacherCode
) {
  const API_BASE = "http://localhost:3000";
  try {
    const res = await fetch(`${API_BASE}/api/v1/admin/createClass`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ classID, moduleID, semesterID, teacherCode }),
    });

    const result = await res.json();

    if (result.status === "success") {
      await getModuleList();
      Swal.fire("Thành công", "Đã tạo tài lớp thành công!", "success");
    } else {
      Swal.fire("Lỗi", result.message || "Tạo lớp thất bại!", "error");
    }
  } catch (err) {
    console.error("Lỗi khi gửi dữ liệu:", err);
    Swal.fire("Lỗi", "Không thể gửi yêu cầu tạo lớp!", "error");
  }
}

/**
 * Khi modal `#createClassModal` hiển thị,
 * load dữ liệu lớp, học kỳ, môn học và giảng viên.
 * Tự động populate dropdown tương ứng.
 * Lắng nghe sự kiện thay đổi lớp để hiển thị các học kỳ phù hợp.
 */
document
  .getElementById("createClassModal")
  .addEventListener("show.bs.modal", async function (event) {
    classDataWithSemesters = await getClassCodeAndSemester();
    listModule = await getModuleCode();
    listTeacher = await getTeacherList();
    console.log("classDataWithSemesters:", classDataWithSemesters);
    console.log("listModule:", listModule);
    console.log("listTeacher:", listTeacher);

    const classSelect = document.getElementById("newTenLop");
    const semesterSelect = document.getElementById("newHocKi");
    const moduleSelect = document.getElementById("newTenMon");
    const teacherSelect = document.getElementById("newGiangVien");

    classSelect.innerHTML = `<option value="">-- Chọn lớp học --</option>`;
    semesterSelect.innerHTML = `<option value="">-- Chọn học kỳ --</option>`;
    moduleSelect.innerHTML = `<option value="">-- Chọn môn học --</option>`;
    teacherSelect.innerHTML = `<option value="">-- Chọn giảng viên --</option>`;

    semesterSelect.disabled = true;

    classDataWithSemesters.forEach((item) => {
      const option = document.createElement("option");
      option.value = item.class.class_id;
      option.textContent = `${item.class.class_code} - ${item.class.class_name}`;
      classSelect.appendChild(option);
    });

    listModule.forEach((item) => {
      const moduleItem = document.createElement("option");
      moduleItem.value = item.module_id;
      moduleItem.textContent = `${item.module_code} - ${item.module_name}`;
      moduleSelect.appendChild(moduleItem);
    });

    listTeacher.forEach((item) => {
      const teacherItem = document.createElement("option");
      teacherItem.value = item.teacher_code;
      teacherItem.textContent = `${item.teacher_name}`;
      teacherSelect.appendChild(teacherItem);
    });

    classSelect.addEventListener("change", (e) => {
      const selectedId = parseInt(e.target.value);
      const selected = classDataWithSemesters.find(
        (item) => item.class.class_id === selectedId
      );
      semesterSelect.innerHTML = `<option value="">-- Chọn học kỳ --</option>`;
      if (selected) {
        semesterSelect.disabled = false;

        selected.semesters.forEach((sem) => {
          const opt = document.createElement("option");
          opt.value = sem.semester_id;
          opt.textContent = `Học kỳ ${sem.semester_number}`;
          semesterSelect.appendChild(opt);
        });
      } else {
        semesterSelect.disabled = true;
      }
    });
  });

/**
 * Khi người dùng thay đổi bộ lọc môn học `#courseFilter`,
 * lọc danh sách lớp hiện tại và hiển thị theo môn học được chọn.
 */
document.getElementById("courseFilter").addEventListener("change", function () {
  const keyword = this.value.trim().toLowerCase();

  const filtered = moduleDatas.filter((module) => {
    return (
      module.module_code.toLowerCase().includes(keyword) ||
      module.module_name.toLowerCase().includes(keyword)
    );
  });

  currentPage = 1;
  filterDatas = filtered;
  renderModuleList(filtered);
});

```

### frontend\js\Administrator\manage_class\admin_add_student_to_class.js
```js
/**
 * Lắng nghe sự kiện submit của form `#addStudentForm`.
 * Kiểm tra các checkbox đã chọn học sinh chưa, sau đó gửi yêu cầu thêm học sinh vào lớp.
 */
document
  .getElementById("addStudentForm")
  .addEventListener("submit", async function (e) {
    e.preventDefault();

    const students = selectedRows();
    if (students.length === 0) {
      Swal.fire("Thông báo", "Bạn chưa chọn học sinh nào!", "warning");
      return;
    }

    await addStudentsToClass(students);
  });

/**
 * Lấy danh sách mã học sinh từ các hàng đã được chọn (checkbox).
 *
 * @returns {Array<string>} - Mảng mã học sinh đã được chọn.
 */
function selectedRows() {
  const checkboxes = document.querySelectorAll(".checkbox-input");
  const students = [];

  checkboxes.forEach((checkbox) => {
    if (checkbox.checked) {
      const row = checkbox.closest("tr");
      const studentCode = row
        .querySelector("td:nth-child(3)")
        .textContent.trim();
      students.push(studentCode);
    }
  });

  return students;
}

/**
 * Gửi danh sách mã học sinh được chọn đến backend để thêm vào lớp học phần.
 * Nếu thành công, gọi lại hàm `getStudentNotInClass` để cập nhật danh sách.
 *
 * @param {Array<string>} datas - Mảng mã học sinh.
 * @returns {Promise<void>}
 */
async function addStudentsToClass(datas) {
  const classSubject = getParams();

  const API_BASE = "http://localhost:3000";
  try {
    const res = await fetch(`${API_BASE}/api/v1/admin/addStudentsToClass`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        class_subject_id: classSubject.class_subject_id,
        student_codes: datas,
      }),
    });

    const result = await res.json();

    if (result.status === "success") {
      await getStudentNotInClass();
      Swal.fire("Thành công", "Đã thêm thành công!", "success");
    } else {
      Swal.fire("Lỗi", result.message || "Thêm thất bại!", "error");
    }
  } catch (err) {
    console.error("Lỗi khi gửi dữ liệu:", err);
    Swal.fire("Lỗi", "Không thể gửi yêu cầu thêm!", "error");
  }
}

```

### frontend\js\Administrator\manage_class\admin_display_class.js
```js
/**
 * Khi trang tải xong, gọi API để lấy danh sách lớp học phần (module list).
 */
document.addEventListener("DOMContentLoaded", async () => {
  getModuleList();
});

/**
 * Chuyển đổi giá trị kỹ thuật thành chuỗi dễ hiểu cho người dùng.
 *
 * @param {*} value - Giá trị cần chuyển đổi.
 * @returns {string} - Giá trị chuyển đổi phù hợp để hiển thị.
 */
function transferValue(value) {
  if (value === null || value === undefined || value === "") {
    return "-";
  } else if (value === "active") {
    return "Đang hoạt động";
  } else if (value === "inactive") {
    return "Dừng hoạt động";
  } else if (value === "completed") {
    return "Hoàn Thành";
  } else if (value === "draft") {
    return "Đang chuẩn bị";
  } else {
    return value;
  }
}

/**
 * Gửi yêu cầu API để lấy danh sách lớp học phần (module list).
 * Nếu thành công, render danh sách và phân trang.
 */
async function getModuleList() {
  const API_BASE = "http://localhost:3000";
  try {
    const res = await fetch(`${API_BASE}/api/v1/admin/getModuleList`);
    const result = await res.json();

    if (result.status === "success" && Array.isArray(result.data)) {
      console.log("Module List:", result.data);
      moduleDatas = result.data;
      filterDatas = [...moduleDatas];
      renderModuleList(filterDatas);
    } else {
      Swal.fire("Thông báo", "Không lấy được dữ liệu!", "warning");
    }
  } catch (error) {
    console.error(error);
    Swal.fire("Lỗi", "Lỗi khi lấy dữ liệu!", "error");
  }
}

// === Biến toàn cục ===
/** @type {number} */
const limitRows = 5;
/** @type {number} */
let currentPage = 1;
/** @type {Array<Object>} */
let moduleDatas = []; // Dữ liệu gốc
/** @type {Array<Object>} */
let filterDatas = []; // Dữ liệu sẽ hiển thị khi tìm kiếm

/**
 * Cập nhật dữ liệu hiển thị và vẽ danh sách học phần theo trang.
 *
 * @param {Array<Object>} modules - Danh sách học phần từ server.
 */
function renderModuleList(modules) {
  filterDatas = modules;
  displayModuleListPage(currentPage);
  renderPagination();
}

/**
 * Hiển thị danh sách học phần theo trang cụ thể.
 *
 * @param {number} page - Số trang cần hiển thị.
 */
function displayModuleListPage(page) {
  const moduleList = document.getElementById("module-list");
  moduleList.innerHTML = ""; // Clear existing rows
  const start = (page - 1) * limitRows;
  const end = start + limitRows;
  const items = filterDatas.slice(start, end);

  items.forEach((module, index) => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td><span>${start + index + 1}</span></td>
      <td><span>${module.class_name}</span></td>
	  <td>
		<a
			href="./page_add_student_to_class.html?class_subject_id=${
        module["class_subject_id"]
      }&class_name=${module["class_name"]}&module_name=${module["module_name"]}"
			class="text-decoration-none text-body detail_class"
		><span>${module.module_name} </span></a
	  ></td>
      <td><span>${module.semester_number}</span></td>
      <td><span>${transferValue(module.class_status)}</span></td>
      <td>
        <button
		 class="btn btn-sm btn-warning me-1 btn-edit"
		 data-bs-toggle="modal"
         data-bs-target="#editClassModal"
		    data-class-subject-id="${module["class_subject_id"]}"
		 	data-class-id="${module["class_id"]}"
			data-class-code="${module["class_code"]}"
			data-class-name="${module["class_name"]}"
			data-module-id="${module["module_id"]}"
			data-module-code="${module["module_code"]}"
			data-module-name="${module["module_name"]}"
			data-teacher-code="${module["teacher_code"]}"
			data-teacher-name="${module["teacher_name"]}"
			data-semester-id="${module["semester_id"]}"
			data-semester="${module["semester_number"]}"
			data-status="${module["class_status"]}">
			<i class="bi bi-pencil-square"></i> Sửa
		</button>
              <button
                data-bs-toggle="modal"
                data-bs-target="#viewClassModal"
                type="button"
                class="btn btn-primary"
				data-class-id="${module["class_id"]}"
				data-class-code="${module["class_code"]}"
				data-class-name="${module["class_name"]}"
				data-module-id="${module["module_id"]}"
				data-module-code="${module["module_code"]}"
				data-module-name="${module["module_name"]}"
				data-teacher-code="${module["teacher_code"]}"
				data-teacher-name="${module["teacher_name"]}"
				data-semester-id="${module["semester_id"]}"
				data-semester="${module["semester_number"]}"
				data-start="${module["semester_start_date"]}"
				data-end="${module["semester_end_date"]}"
                id="btnSaveClass"
              >
                <i class="bi bi-list-ul"></i>
              </button>
      </td>
    `;
    moduleList.appendChild(row);
  });
}

/**
 * Vẽ thanh phân trang phía dưới bảng.
 * Tự động thêm các nút trang, dấu "..." và nút chuyển trang trước/sau.
 */
function renderPagination() {
  const totalPages = Math.ceil(filterDatas.length / limitRows);
  const pagination = document.getElementById("pagination");
  pagination.innerHTML = "";

  const maxVisible = 3; // Số nút trang muốn hiển thị xung quanh trang hiện tại
  let startPage = Math.max(1, currentPage - Math.floor(maxVisible / 2));
  let endPage = Math.min(totalPages, startPage + maxVisible - 1);

  // Điều chỉnh nếu cuối danh sách
  if (endPage - startPage < maxVisible - 1) {
    startPage = Math.max(1, endPage - maxVisible + 1);
  }

  // Nút "«" ← previous
  if (currentPage > 1) {
    pagination.appendChild(createPageItem("«", currentPage - 1));
  }

  // Nút trang đầu + dấu ...
  if (startPage > 1) {
    pagination.appendChild(createPageItem(1, 1));
    if (startPage > 2) {
      pagination.appendChild(createEllipsis());
    }
  }

  // Các nút trang chính giữa
  for (let i = startPage; i <= endPage; i++) {
    const li = createPageItem(i, i);
    if (i === currentPage) li.classList.add("active");
    pagination.appendChild(li);
  }

  // Dấu ... + trang cuối
  if (endPage < totalPages) {
    if (endPage < totalPages - 1) {
      pagination.appendChild(createEllipsis());
    }
    pagination.appendChild(createPageItem(totalPages, totalPages));
  }

  // Nút "»" → next
  if (currentPage < totalPages) {
    pagination.appendChild(createPageItem("»", currentPage + 1));
  }
}

/**
 * Tạo một nút trang (số hoặc điều hướng).
 * @param {string|number} label - Nội dung hiển thị của nút
 * @param {number} pageNum - Số trang tương ứng khi click
 * @returns {HTMLLIElement} - Phần tử <li> chứa nút
 */
function createPageItem(label, pageNum) {
  const li = document.createElement("li");
  li.className = "page-item";
  const a = document.createElement("a");
  a.className = "page-link";
  a.href = "#";
  a.textContent = label;
  a.addEventListener("click", (e) => {
    e.preventDefault();
    currentPage = pageNum;
    displayModuleListPage(currentPage);
    renderPagination();
  });
  li.appendChild(a);
  return li;
}

/**
 * Tạo phần tử phân trang dấu ba chấm "..." khi có nhiều trang.
 *
 * @returns {HTMLLIElement} - Thẻ <li> đã disable chứa "...".
 */
function createEllipsis() {
  const li = document.createElement("li");
  li.className = "page-item disabled";
  li.innerHTML = `<span class="page-link">...</span>`;
  return li;
}

/**
 * Lắng nghe input ô tìm kiếm và lọc dữ liệu từ `studentDatas` gốc.
 * Hiển thị danh sách học viên phù hợp.
 */
// document.getElementById("searchInput").addEventListener("input", function () {
//   const keyword = this.value.trim().toLowerCase();

//   // filter dữ liệu từ danh sách sinh viên gốc
//   const filtered = teacherDatas.filter((teacher) => {
//     const fullName = `${teacher.teacher_name}`.toLowerCase();
//     return (
//       teacher.teacher_code.toLowerCase().includes(keyword) ||
//       fullName.includes(keyword) ||
//       teacher.teacher_phone?.toLowerCase().includes(keyword)
//     );
//   });

//   currentPage = 1;
//   renderTeacherList(filtered);
// });

/**
 * Khi mở modal xem thông tin lớp học:
 * - Lấy dữ liệu từ nút được click.
 * - Hiển thị thông tin lớp học lên modal.
 */
document
  .getElementById("viewClassModal")
  .addEventListener("show.bs.modal", function (event) {
    const trigger = event.relatedTarget;

    const class_code = trigger.getAttribute("data-class-code") || "-";
    const class_name = trigger.getAttribute("data-class-name") || "-";
    const module_code = trigger.getAttribute("data-module-code") || "-";
    const module_name = trigger.getAttribute("data-module-name") || "-";
    const teacher_code = trigger.getAttribute("data-teacher-code") || "-";
    const teacher_name = trigger.getAttribute("data-teacher-name") || "-";
    const semester = trigger.getAttribute("data-semester") || "-";
    let start = trigger.getAttribute("data-start");
    let end = trigger.getAttribute("data-end");

    const formatStart = start ? dayjs(start).format("DD/MM/YYYY") : "-";
    const formatEnd = start ? dayjs(end).format("DD/MM/YYYY") : "-";

    document.getElementById("modal-class-code").textContent = class_code;
    document.getElementById("modal-class-name").textContent = class_name;
    document.getElementById("modal-module-code").textContent = module_code;
    document.getElementById("modal-module-name").textContent = module_name;
    document.getElementById("modal-teacher-code").textContent = teacher_code;
    document.getElementById("modal-teacher-name").textContent = teacher_name;
    document.getElementById("modal-semester").textContent = semester;
    document.getElementById("modal-start").textContent = formatStart;
    document.getElementById("modal-end").textContent = formatEnd;
  });

```

### frontend\js\Administrator\manage_class\admin_display_class_student.js
```js
/**
 * Khi tài liệu được tải xong:
 * - Gọi API để lấy danh sách học viên chưa thuộc lớp học phần.
 * - Hiển thị thông tin lớp học.
 * - Cập nhật link "Xem danh sách lớp" dựa theo tham số URL.
 */
document.addEventListener("DOMContentLoaded", async () => {
  getStudentNotInClass();
  displayClass();

  const { class_subject_id, class_name, module_name } = getParams();

  // Gán giá trị vào href
  const viewBtn = document.getElementById("viewClassListBtn");
  viewBtn.href = `page_list_student_in_class.html?class_subject_id=${class_subject_id}&class_name=${class_name}&module_name=${module_name}`;
});

/**
 * Trích xuất các tham số từ URL hiện tại.
 *
 * @returns {{ class_subject_id: string, class_name: string, module_name: string }}
 */
function getParams() {
  const urlParams = new URLSearchParams(window.location.search);
  return {
    class_subject_id: urlParams.get("class_subject_id"),
    class_name: urlParams.get("class_name"),
    module_name: urlParams.get("module_name"),
  };
}

/**
 * Gán tên lớp học và tên môn học từ URL vào các phần tử tương ứng trong giao diện.
 */
function displayClass() {
  class_name = getParams();
  module_name = getParams();

  document.querySelector(".class_name").textContent = class_name.class_name;
  document.querySelector(".module_name").textContent = module_name.module_name;
}

/**
 * Gửi yêu cầu đến API để lấy danh sách học viên chưa được xếp vào lớp học phần.
 * Nếu thành công, hiển thị danh sách và phân trang.
 *
 * @returns {Promise<void>}
 */
async function getStudentNotInClass() {
  const API_BASE = "http://localhost:3000";
  const class_subject_id = getParams();
  try {
    const res = await fetch(
      `${API_BASE}/api/v1/admin/getStudentNotInClass?class_subject_id=${class_subject_id.class_subject_id}`
    );
    const result = await res.json();

    if (result.status === "success" && Array.isArray(result.data)) {
      console.log("Student List:", result.data);
      studentDatas = result.data;
      filterDatas = [...studentDatas];
      renderStudentList(filterDatas);
    } else {
      Swal.fire("Thông báo", "Không lấy được dữ liệu!", "warning");
    }
  } catch (error) {
    console.error(error);
    Swal.fire("Lỗi", "Lỗi khi lấy dữ liệu!", "error");
  }
}

// === Biến toàn cục ===
/** @type {number} */
const limitRows = 10;
/** @type {number} */
let currentPage = 1;
/** @type {Array<Object>} */
let studentDatas = []; // Dữ liệu gốc
/** @type {Array<Object>} */
let filterDatas = []; // Dữ liệu sẽ hiển thị khi tìm kiếm

/**
 * Cập nhật dữ liệu hiển thị và render danh sách học viên cùng phân trang.
 *
 * @param {Array<Object>} students - Mảng đối tượng học viên.
 */
function renderStudentList(students) {
  filterDatas = students;
  displayStudentListPage(currentPage);
  renderPagination();
}

/**
 * Hiển thị danh sách học viên theo trang hiện tại.
 *
 * @param {number} page - Số trang cần hiển thị.
 */
function displayStudentListPage(page) {
  const studentList = document.getElementById("form-list");
  studentList.innerHTML = ""; // Clear existing rows
  const start = (page - 1) * limitRows;
  const end = start + limitRows;
  const items = filterDatas.slice(start, end);

  items.forEach((student, index) => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>
        <input class="form-check-input checkbox-input" type="checkbox" />
	  </td>
      <td><span>${start + index + 1}</span></td>
      <td><span>${student.student_code}</span></td>
      <td><span>${student.student_middle_name}
	  ${student.student_name}</span></td>
	`;
    studentList.appendChild(row);
  });
}

/**
 * Vẽ thanh phân trang phía dưới bảng.
 * Tự động thêm các nút trang, dấu "..." và nút chuyển trang trước/sau.
 */
function renderPagination() {
  const totalPages = Math.ceil(filterDatas.length / limitRows);
  const pagination = document.getElementById("pagination");
  pagination.innerHTML = "";

  const maxVisible = 3; // Số nút trang muốn hiển thị xung quanh trang hiện tại
  let startPage = Math.max(1, currentPage - Math.floor(maxVisible / 2));
  let endPage = Math.min(totalPages, startPage + maxVisible - 1);

  // Điều chỉnh nếu cuối danh sách
  if (endPage - startPage < maxVisible - 1) {
    startPage = Math.max(1, endPage - maxVisible + 1);
  }

  // Nút "«" ← previous
  if (currentPage > 1) {
    pagination.appendChild(createPageItem("«", currentPage - 1));
  }

  // Nút trang đầu + dấu ...
  if (startPage > 1) {
    pagination.appendChild(createPageItem(1, 1));
    if (startPage > 2) {
      pagination.appendChild(createEllipsis());
    }
  }

  // Các nút trang chính giữa
  for (let i = startPage; i <= endPage; i++) {
    const li = createPageItem(i, i);
    if (i === currentPage) li.classList.add("active");
    pagination.appendChild(li);
  }

  // Dấu ... + trang cuối
  if (endPage < totalPages) {
    if (endPage < totalPages - 1) {
      pagination.appendChild(createEllipsis());
    }
    pagination.appendChild(createPageItem(totalPages, totalPages));
  }

  // Nút "»" → next
  if (currentPage < totalPages) {
    pagination.appendChild(createPageItem("»", currentPage + 1));
  }
}

/**
 * Tạo một nút trang (số hoặc điều hướng).
 * @param {string|number} label - Nội dung hiển thị của nút
 * @param {number} pageNum - Số trang tương ứng khi click
 * @returns {HTMLLIElement} - Phần tử <li> chứa nút
 */
function createPageItem(label, pageNum) {
  const li = document.createElement("li");
  li.className = "page-item";
  const a = document.createElement("a");
  a.className = "page-link";
  a.href = "#";
  a.textContent = label;
  a.addEventListener("click", (e) => {
    e.preventDefault();
    currentPage = pageNum;
    displayStudentListPage(currentPage);
    renderPagination();
  });
  li.appendChild(a);
  return li;
}

/**
 * Tạo phần tử dấu ba chấm "..." dùng trong phân trang.
 *
 * @returns {HTMLLIElement} - Thẻ <li> có style disabled chứa "...".
 */
function createEllipsis() {
  const li = document.createElement("li");
  li.className = "page-item disabled";
  li.innerHTML = `<span class="page-link">...</span>`;
  return li;
}

/**
 * Xử lý sự kiện nhập liệu trong ô tìm kiếm.
 * Lọc danh sách học viên theo tên, mã số hoặc số điện thoại.
 */
document.getElementById("searchInput").addEventListener("input", function () {
  const keyword = this.value.trim().toLowerCase();

  // filter dữ liệu từ danh sách sinh viên gốc
  const filtered = studentDatas.filter((student) => {
    const fullName =
      `${student.student_middle_name} ${student.student_name}`.toLowerCase();
    return (
      student.student_code.toLowerCase().includes(keyword) ||
      fullName.includes(keyword) ||
      student.student_phone?.toLowerCase().includes(keyword)
    );
  });

  currentPage = 1;
  renderStudentList(filtered);
});

```

### frontend\js\Administrator\manage_class\admin_student_in_class.js
```js
/**
 * Khi trang được tải xong, gọi API để lấy danh sách học viên trong lớp
 * và hiển thị thông tin lớp học lên giao diện.
 */
document.addEventListener("DOMContentLoaded", async () => {
  getStudentInClass();
  displayClass();
});

/**
 * Lấy các tham số từ URL hiện tại để phục vụ việc truy xuất dữ liệu lớp học.
 *
 * @returns {{ class_subject_id: string|null, class_name: string|null, module_name: string|null }}
 * Các thông tin: mã lớp học phần, tên lớp, tên môn học.
 */
function getParams() {
  const urlParams = new URLSearchParams(window.location.search);
  return {
    class_subject_id: urlParams.get("class_subject_id"),
    class_name: urlParams.get("class_name"),
    module_name: urlParams.get("module_name"),
  };
}

/**
 * Hiển thị tên lớp và tên môn học lên giao diện dựa trên tham số từ URL.
 */
function displayClass() {
  const { class_name, module_name } = getParams();

  document.querySelector(".class_name").textContent = class_name;
  document.querySelector(".module_name").textContent = module_name;
}

/**
 * Gửi yêu cầu đến backend để lấy danh sách học viên đã thuộc lớp học phần.
 * Sau đó cập nhật giao diện và phân trang danh sách.
 */
async function getStudentInClass() {
  const API_BASE = "http://localhost:3000";
  const class_subject_id = getParams();
  try {
    const res = await fetch(
      `${API_BASE}/api/v1/admin/getStudentInClass?class_subject_id=${class_subject_id.class_subject_id}`
    );
    const result = await res.json();

    if (result.status === "success" && Array.isArray(result.data)) {
      console.log("Student List:", result.data);
      studentDatas = result.data;
      filterDatas = [...studentDatas];
      renderStudentList(filterDatas);
    } else {
      console.log("Chưa Có Dữ Liệu!!!");
      //   Swal.fire("Thông báo", "Không lấy được dữ liệu!", "warning");
    }
  } catch (error) {
    console.error(error);
    Swal.fire("Lỗi", "Lỗi khi lấy dữ liệu!", "error");
  }
}

// === Biến toàn cục ===
/** @type {number} */
const limitRows = 10;
/** @type {number} */
let currentPage = 1;
/** @type {Array<Object>} */
let studentDatas = []; // Dữ liệu học viên từ server
/** @type {Array<Object>} */
let filterDatas = []; // Dữ liệu học viên sau khi lọc tìm kiếm

/**
 * Gán dữ liệu và hiển thị danh sách học viên theo trang.
 *
 * @param {Array<Object>} students - Mảng dữ liệu học viên từ server.
 */
function renderStudentList(students) {
  filterDatas = students;
  displayStudentListPage(currentPage);
  renderPagination();
}

/**
 * Hiển thị danh sách học viên trong một trang cụ thể.
 *
 * @param {number} page - Số trang cần hiển thị.
 */
function displayStudentListPage(page) {
  const studentList = document.getElementById("form-list");
  studentList.innerHTML = ""; // Clear existing rows
  const start = (page - 1) * limitRows;
  const end = start + limitRows;
  const items = filterDatas.slice(start, end);

  items.forEach((student, index) => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td><span>${start + index + 1}</span></td>
      <td><span>${student.student_code}</span></td>
      <td><span>${student.student_middle_name}
	  ${student.student_name}</span></td>
	`;
    studentList.appendChild(row);
  });
}

/**
 * Vẽ thanh phân trang phía dưới bảng.
 * Tự động thêm các nút trang, dấu "..." và nút chuyển trang trước/sau.
 */
function renderPagination() {
  const totalPages = Math.ceil(filterDatas.length / limitRows);
  const pagination = document.getElementById("pagination");
  pagination.innerHTML = "";

  const maxVisible = 3; // Số nút trang muốn hiển thị xung quanh trang hiện tại
  let startPage = Math.max(1, currentPage - Math.floor(maxVisible / 2));
  let endPage = Math.min(totalPages, startPage + maxVisible - 1);

  // Điều chỉnh nếu cuối danh sách
  if (endPage - startPage < maxVisible - 1) {
    startPage = Math.max(1, endPage - maxVisible + 1);
  }

  // Nút "«" ← previous
  if (currentPage > 1) {
    pagination.appendChild(createPageItem("«", currentPage - 1));
  }

  // Nút trang đầu + dấu ...
  if (startPage > 1) {
    pagination.appendChild(createPageItem(1, 1));
    if (startPage > 2) {
      pagination.appendChild(createEllipsis());
    }
  }

  // Các nút trang chính giữa
  for (let i = startPage; i <= endPage; i++) {
    const li = createPageItem(i, i);
    if (i === currentPage) li.classList.add("active");
    pagination.appendChild(li);
  }

  // Dấu ... + trang cuối
  if (endPage < totalPages) {
    if (endPage < totalPages - 1) {
      pagination.appendChild(createEllipsis());
    }
    pagination.appendChild(createPageItem(totalPages, totalPages));
  }

  // Nút "»" → next
  if (currentPage < totalPages) {
    pagination.appendChild(createPageItem("»", currentPage + 1));
  }
}

/**
 * Tạo một nút trang (số hoặc điều hướng).
 * @param {string|number} label - Nội dung hiển thị của nút
 * @param {number} pageNum - Số trang tương ứng khi click
 * @returns {HTMLLIElement} - Phần tử <li> chứa nút
 */
function createPageItem(label, pageNum) {
  const li = document.createElement("li");
  li.className = "page-item";
  const a = document.createElement("a");
  a.className = "page-link";
  a.href = "#";
  a.textContent = label;
  a.addEventListener("click", (e) => {
    e.preventDefault();
    currentPage = pageNum;
    displayStudentListPage(currentPage);
    renderPagination();
  });
  li.appendChild(a);
  return li;
}

/**
 * Tạo một phần tử phân trang dạng "..." (dấu ba chấm).
 * @returns {HTMLLIElement} - Phần tử <li> disabled
 */
function createEllipsis() {
  const li = document.createElement("li");
  li.className = "page-item disabled";
  li.innerHTML = `<span class="page-link">...</span>`;
  return li;
}

/**
 * Lắng nghe sự kiện nhập liệu trong ô tìm kiếm và lọc danh sách học viên
 * theo mã sinh viên, họ tên hoặc số điện thoại.
 */
document.getElementById("searchInput").addEventListener("input", function () {
  const keyword = this.value.trim().toLowerCase();

  // filter dữ liệu từ danh sách sinh viên gốc
  const filtered = studentDatas.filter((student) => {
    const fullName =
      `${student.student_middle_name} ${student.student_name}`.toLowerCase();
    return (
      student.student_code.toLowerCase().includes(keyword) ||
      fullName.includes(keyword) ||
      student.student_phone?.toLowerCase().includes(keyword)
    );
  });

  currentPage = 1;
  renderStudentList(filtered);
});

```

### frontend\js\Administrator\manage_class\admin_update_class.js
```js
/**
 * Biến toàn cục
 * @type {string|null}
 */
let classSubjectID = null;

/**
 * Sự kiện được gọi khi modal chỉnh sửa lớp học phần được hiển thị.
 * - Lấy danh sách học kỳ và giảng viên
 * - Đổ dữ liệu từ nút trigger vào form modal
 * - Gán các giá trị đã chọn vào các ô input tương ứng trong modal
 *
 * @param {Event} event - Sự kiện Bootstrap modal show
 */
document
  .getElementById("editClassModal")
  .addEventListener("show.bs.modal", async function (event) {
    const trigger = event.relatedTarget;
    classDataWithSemesters = await getClassCodeAndSemester();
    console.log("classDataWithSemesters", classDataWithSemesters);
    listTeacher = await getTeacherList();
    const teacherSelect = document.getElementById("editTeacher");
    teacherSelect.innerHTML = `<option value="" disabled>-- Chọn giảng viên --</option>`;
    listTeacher.forEach((item) => {
      const teacherItem = document.createElement("option");
      teacherItem.value = item.teacher_code;
      teacherItem.textContent = `${item.teacher_name}`;
      teacherSelect.appendChild(teacherItem);
    });

    // Lấy dữ liệu từ nút được click
    classSubjectID = trigger.getAttribute("data-class-subject-id");
    console.log("classSubjectID", classSubjectID);
    const classId = trigger.getAttribute("data-class-id");
    const classCode = trigger.getAttribute("data-class-code");
    const className = trigger.getAttribute("data-class-name");
    const moduleId = trigger.getAttribute("data-module-id");
    const moduleCode = trigger.getAttribute("data-module-code");
    const moduleName = trigger.getAttribute("data-module-name");
    const teacherCode = trigger.getAttribute("data-teacher-code");
    // const teacherName = trigger.getAttribute("data-teacher-name");
    const semesterId = trigger.getAttribute("data-semester-id");
    const status = trigger.getAttribute("data-status");

    document.getElementById(
      "editClassName"
    ).innerHTML = `<option value="${classId}">${classCode} - ${className}</option>`;

    document.getElementById(
      "editModule"
    ).innerHTML = `<option value="${moduleId}">${moduleCode} - ${moduleName}</option>`;

    document.getElementById("editTeacher").value = teacherCode;
    document.getElementById("editStatus").value = status;

    const semesterSelect = document.getElementById("editSemester");
    semesterSelect.innerHTML = `<option value="" disabled>-- Chọn học kỳ --</option>`;

    const selected = classDataWithSemesters.find(
      (item) => item.class.class_id.toString() === classId
    );

    console.log("selected: ", selected);

    if (selected) {
      selected.semesters.forEach((sem) => {
        const opt = document.createElement("option");
        opt.value = sem.semester_id;
        opt.textContent = `Học kỳ ${sem.semester_number}`;
        semesterSelect.appendChild(opt);
      });

      // Set giá trị mặc định học kỳ đang chọn
      semesterSelect.value = semesterId;
    }
  });

/**
 * Gửi yêu cầu cập nhật thông tin lớp học phần đến backend.
 *
 * @param {Object} payload - Dữ liệu cập nhật lớp học phần.
 * @param {string} payload.classSubjectID - ID lớp học phần.
 * @param {string} payload.semesterID - ID học kỳ.
 * @param {string} payload.classStatus - Trạng thái lớp (active/inactive...).
 * @param {string} payload.teacherCode - Mã giảng viên phụ trách.
 */
async function updateClass(payload) {
  if (!payload) {
    Swal.fire("Lỗi", "Thiếu thông tin để cập nhật!", "error");
    return;
  }
  const API_BASE = "http://localhost:3000";
  try {
    const res = await fetch(`${API_BASE}/api/v1/admin/updateClass`, {
      method: "PUT",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(payload),
    });

    const data = await res.json();

    if (data.status === "success") {
      getModuleList();
      Swal.fire("Thành công", "Thông tin đã được cập nhật!", "success");
    } else {
      Swal.fire(
        "Lỗi",
        data.message || "Không thể cập nhật thông tin!",
        "error"
      );
    }
  } catch (error) {
    console.error("Error:", error);
    Swal.fire("Lỗi", "Có lỗi xảy ra khi cập nhật!", "error");
  }
}

/**
 * Xử lý khi người dùng nhấn nút "Lưu" trên form chỉnh sửa lớp học phần.
 * - Lấy dữ liệu từ form
 * - Đóng modal
 * - Gửi yêu cầu cập nhật qua `updateClass()`
 *
 * @param {Event} e - Sự kiện submit của form
 */
document
  .getElementById("editClassForm")
  .addEventListener("submit", function (e) {
    e.preventDefault(); // Ngăn reload trang
    const moduleID = document.getElementById("editModule").value;
    const semesterID = document.getElementById("editSemester").value;
    const classStatus = document.getElementById("editStatus").value;
    const teacherCode = document.getElementById("editTeacher").value;
    const classID = document.getElementById("editClassName").value;
    const payload = {
      classSubjectID,
      semesterID,
      classStatus,
      teacherCode,
    };

    bootstrap.Modal.getInstance(
      document.getElementById("editClassModal")
    ).hide();

    updateClass(payload);
  });

```

### frontend\js\Administrator\manage_dashboard\admin_display_stats.js
```js
/**
 * Khi DOM đã được tải hoàn tất, tự động lấy và hiển thị dữ liệu thống kê dashboard.
 */
document.addEventListener("DOMContentLoaded", async function () {
  getDashboardStats();
  const message = localStorage.getItem("loginSuccess");
  if (message) {
    // Hiển thị toast
    Swal.fire({
      toast: true,
      position: "top-end",
      icon: "success",
      title: message,
      showConfirmButton: false,
      timer: 1500,
      timerProgressBar: true,
    });

    // Xóa sau khi hiển thị
    localStorage.removeItem("loginSuccess");
  }
});

/**
 * Gửi request đến API backend để lấy dữ liệu thống kê tổng quan.
 * Nếu thành công, gọi hàm `renderStatData()` để hiển thị lên UI.
 */
async function getDashboardStats() {
  const API_BASE = "http://localhost:3000";
  try {
    const res = await fetch(`${API_BASE}/api/v1/admin/getDashboardStats`);
    const result = await res.json();

    if (result.status === "success") {
      const statDatas = result.data;
      console.log(statDatas);
      renderStatData(statDatas);
    } else {
      Swal.fire("Thông báo", "Không lấy được dữ liệu!", "warning");
    }
  } catch (error) {
    console.error(error);
    Swal.fire("Lỗi", "Lỗi khi lấy dữ liệu!", "error");
  }
}

/**
 * Hiển thị các số liệu thống kê lên giao diện người dùng.
 *
 * @param {Object} statDatas - Dữ liệu thống kê nhận từ server
 * @param {number} statDatas.total_classes - Tổng số lớp học
 * @param {number} statDatas.total_students - Tổng số học viên
 * @param {number} statDatas.total_teachers - Tổng số giảng viên
 * @param {number} statDatas.total_accounts - Tổng số tài khoản hệ thống
 */
function renderStatData(statDatas) {
  const total_class = statDatas.total_classes;
  const total_student = statDatas.total_students;
  const total_teacher = statDatas.total_teachers;
  const total_account = statDatas.total_accounts;
  document.getElementById("total-class").textContent = total_class;
  document.getElementById("total-student").textContent = total_student;
  document.getElementById("total-teacher").textContent = total_teacher;
  document.getElementById("total-account").textContent = total_account;
}

```

### frontend\js\Administrator\manage_dashboard\dashboard_chart.js
```js
/**
 * Khi trang được load hoàn tất, thực hiện gọi các API thống kê.
 */
document.addEventListener("DOMContentLoaded", function () {
  getCountStudentInClass();
  getModuleCertificateStats();
});

/**
 * Gửi yêu cầu đến API để lấy số lượng sinh viên theo từng lớp học.
 * Nếu thành công, hiển thị biểu đồ cột bằng Chart.js.
 */
async function getCountStudentInClass() {
  const API_BASE = "http://localhost:3000";
  try {
    const res = await fetch(`${API_BASE}/api/v1/admin/getCountStudentInClass`);
    const result = await res.json();

    if (result.status === "success") {
      const countDatas = result.data;
      console.log("Dữ liệu lớp:", countDatas);
      renderCountStudentInClass(countDatas);
    } else {
      Swal.fire("Thông báo", "Không lấy được dữ liệu!", "warning");
    }
  } catch (error) {
    console.error(error);
    Swal.fire("Lỗi", "Lỗi khi lấy dữ liệu!", "error");
  }
}

/**
 * Gửi yêu cầu đến API để lấy thống kê số sinh viên đã và chưa đạt chứng chỉ theo môn học.
 * Nếu thành công, hiển thị hai biểu đồ: biểu đồ tròn và biểu đồ cột.
 */
async function getModuleCertificateStats() {
  const API_BASE = "http://localhost:3000";
  try {
    const res = await fetch(
      `${API_BASE}/api/v1/admin/getModuleCertificateStats`
    );
    const result = await res.json();

    if (result.status === "success") {
      const stats = result.data;
      console.log("Dữ liệu lớp:", stats);

      // Tiếp tục render biểu đồ
      renderModuleChart(stats);
      renderPieChart(stats);
    } else {
      Swal.fire("Thông báo", "Không lấy được dữ liệu!", "warning");
    }
  } catch (error) {
    console.error(error);
    Swal.fire("Lỗi", "Lỗi khi lấy dữ liệu!", "error");
  }
}

/**
 * Hiển thị biểu đồ tròn tỷ lệ sinh viên đã được cấp chứng chỉ.
 *
 * @param {Array<Object>} data - Danh sách thống kê theo từng module.
 * @param {number} data[].certified_students - Số sinh viên đã có chứng chỉ.
 * @param {number} data[].total_students - Tổng số sinh viên của module.
 */
function renderPieChart(data) {
  const certifiedTotal = data.reduce(
    (sum, item) => sum + item.certified_students,
    0
  );
  const total = data.reduce((sum, item) => sum + item.total_students, 0);
  const uncertifiedTotal = total - certifiedTotal;

  const ctx = document.getElementById("certPieChart").getContext("2d");

  new Chart(ctx, {
    type: "pie",
    data: {
      labels: ["Đã cấp chứng chỉ", "Chưa cấp chứng chỉ"],
      datasets: [
        {
          data: [certifiedTotal, uncertifiedTotal],
          backgroundColor: ["#10B981", "#F87171"],
          borderWidth: 1,
        },
      ],
    },
    options: {
      responsive: true,
      plugins: {
        legend: { position: "bottom" },
        title: {
          display: true,
          text: "Tỷ lệ sinh viên đạt chứng chỉ",
        },
      },
    },
  });
}

/**
 * Hiển thị biểu đồ cột so sánh tổng sinh viên và số sinh viên đã đạt chứng chỉ theo từng môn học.
 *
 * @param {Array<Object>} data - Danh sách thống kê theo từng module.
 * @param {string} data[].module_name - Tên môn học.
 * @param {number} data[].total_students - Tổng số sinh viên.
 * @param {number} data[].certified_students - Số sinh viên có chứng chỉ.
 */
function renderModuleChart(data) {
  const labels = data.map((item) => item.module_name);
  const totalStudents = data.map((item) => item.total_students);
  const certifiedStudents = data.map((item) => item.certified_students);

  const ctx = document.getElementById("moduleChart").getContext("2d");

  new Chart(ctx, {
    type: "bar",
    data: {
      labels: labels,
      datasets: [
        {
          label: "Tổng số sinh viên",
          data: totalStudents,
          backgroundColor: "#3B82F6",
          borderRadius: 6,
        },
        {
          label: "Đã cấp chứng chỉ",
          data: certifiedStudents,
          backgroundColor: "#10B981",
          borderRadius: 6,
        },
      ],
    },
    options: {
      responsive: true,
      plugins: {
        legend: {
          labels: {
            font: {
              size: 10, // 🔽 Nhỏ hơn mặc định (~14)
            },
          },
        },
        title: {
          display: true,
          text: "Số sinh viên đạt theo lớp - môn",
          font: {
            size: 12, // 🔽 Nhỏ hơn
          },
        },
        tooltip: {
          bodyFont: {
            size: 12,
          },
          titleFont: {
            size: 13,
          },
        },
      },
      scales: {
        x: {
          ticks: {
            font: {
              size: 10,
            },
          },
        },
        y: {
          beginAtZero: true,
          ticks: {
            font: {
              size: 10,
            },
          },
        },
      },
    },
  });
}

/**
 * Hiển thị biểu đồ cột thể hiện số sinh viên theo từng lớp học.
 *
 * @param {Array<Object>} data - Dữ liệu số lượng sinh viên theo lớp.
 * @param {string} data[].class_name - Tên lớp.
 * @param {number} data[].student_count - Số sinh viên trong lớp.
 */
function renderCountStudentInClass(data) {
  const labels = data.map((item) => item.class_name);
  const values = data.map((item) => item.student_count);

  const ctx = document.getElementById("classChart").getContext("2d");
  new Chart(ctx, {
    type: "bar",
    data: {
      labels: labels,
      datasets: [
        {
          label: "Số sinh viên",
          data: values,
          backgroundColor: "#3B82F6",
          borderRadius: 5,
        },
      ],
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: false },
      },
      scales: {
        y: {
          beginAtZero: true,
          title: {
            display: true,
            text: "Số lượng sinh viên",
          },
        },
        x: {
          ticks: {
            autoSkip: false,
            maxRotation: 45,
            minRotation: 0,
          },
        },
      },
    },
  });
}

```

### frontend\js\Administrator\manage_student\admin_add_student.js
```js
document.addEventListener("DOMContentLoaded", async () => {
  const newCode = await getNewCode();
  console.log("after format code: " + newCode);
});

/**
 * Gửi yêu cầu đến backend để lấy mã học viên cuối cùng hiện tại.
 * @returns {Promise<string|undefined>} - Mã học viên cuối nếu thành công
 */

async function getLastStudentCode() {
  const API_BASE = "http://localhost:3000";
  try {
    const res = await fetch(`${API_BASE}/api/v1/admin/getLastStudentCode`);

    const result = await res.json();

    if (result.status === "success" && result.data) {
      const lastStudentCode = result.data.student_code;
      return lastStudentCode;
    } else {
      Swal.fire("Thông báo", "Không lấy được dữ liệu!", "warning");
    }
  } catch (error) {
    console.error(error);
    Swal.fire("Lỗi", "Lỗi khi lấy dữ liệu!", "error");
  }
}

/**
 * Tăng số thứ tự của mã học viên lên 1 và định dạng lại.
 * @param {string} studentCode - Mã học viên hiện tại dạng chuỗi
 * @returns {string|null} - Mã mới được định dạng hoặc null nếu lỗi
 */

function formatStudentCode(studentCode) {
  if (!studentCode) {
    Swal.fire("Thông báo", "Không lấy được mã học viên cuối!", "warning");
    return null;
  }

  const oldCode = studentCode;
  const numberPart = oldCode.slice(0, 4);
  let newNumber = Number(numberPart) + 1;

  const formattedNumber = String(newNumber).padStart(4, "0");
  const newCode = `${formattedNumber}/25-THUD`;
  return newCode;
}

/**
 * Lấy mã học viên cuối và tạo mã học viên mới.
 * @returns {Promise<string|null>} - Mã mới được tạo
 */
async function getNewCode() {
  const beforeFormat = await getLastStudentCode();
  const afterFormat = formatStudentCode(beforeFormat);
  return afterFormat;
}

/**
 * Khi modal thêm học viên hiển thị, tự động gán mã học viên mới vào input.
 */
document
  .getElementById("addStudentModal")
  .addEventListener("show.bs.modal", async function (event) {
    // const button = event.relatedTarget; // nút gọi modal
    const newCode = await getNewCode();
    const student_code = document.getElementById("maSo");
    student_code.value = newCode; // gán giá trị vào input
  });

/**
 * Gửi thông tin học viên mới đến backend để thêm vào hệ thống.
 * @param {Object} student - Đối tượng học viên chứa các trường cần thiết
 */
async function addNewStudent(student) {
  if (!student) {
    Swal.fire("Cảnh Báo", "Không nhận được dữ liệu nhập vào!!!", "error");
    console.error("Thiếu dữ liệu cần thiết");
    return;
  }

  console.log(student);

  const API_BASE = "http://localhost:3000";
  try {
    const res = await fetch(`${API_BASE}/api/v1/admin/addNewStudent`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(student),
    });

    const data = await res.json();

    if (data.status === "success") {
      Swal.fire("Thành công", "Thêm dữ liệu thành công!", "success");
      getStudentList();
    } else {
      Swal.fire("Lỗi", data.message || "Không thể thêm dữ liệu!", "error");
    }
  } catch (error) {
    console.error("Error:", error);
    Swal.fire("Lỗi", "Có lỗi xảy ra khi cập nhật điểm!", "error");
  }
}

/**
 * Lắng nghe sự kiện submit form thêm học viên.
 * Tạo object học viên, gọi hàm thêm và reset form sau khi hoàn tất.
 */
document.getElementById("studentForm").addEventListener("submit", async (e) => {
  e.preventDefault(); // Ngăn form reload trang

  const student = {
    student_code: document.getElementById("maSo").value.trim(),
    student_middle_name: document.getElementById("hoDem").value.trim(),
    student_name: document.getElementById("tenHocVien").value.trim(),
    student_phone: document.getElementById("sdt").value.trim(),
  };

  // Gửi dữ liệu lên server
  await addNewStudent(student);

  // Đóng modal sau khi thêm
  const modal = bootstrap.Modal.getInstance(
    document.getElementById("addStudentModal")
  );
  modal.hide();

  // Reset form
  document.getElementById("studentForm").reset();
});

```

### frontend\js\Administrator\manage_student\admin_display_student.js
```js
document.addEventListener("DOMContentLoaded", async () => {
  getStudentList();
});

/**
 * Chuyển đổi các giá trị kỹ thuật thành dạng dễ đọc cho người dùng.
 * @param {*} value - Giá trị cần chuyển đổi (string, null, undefined)
 * @returns {string} - Giá trị đã chuyển đổi phù hợp để hiển thị
 */

function transferValue(value) {
  if (value === null || value === undefined || value === "") {
    return "-";
  } else if (value === "studying") {
    return "Đang học";
  } else if (value === "female") {
    return "Nữ";
  } else if (value === "male") {
    return "Nam";
  } else if (value === "other") {
    return "Khác";
  } else if (value === "inactive") {
    return "Tạm nghỉ";
  } else if (value === "graduated") {
    return "Đã tốt nghiệp";
  } else if (value === "dropout") {
    return "Bỏ học";
  } else {
    return value;
  }
}

/**
 * Gửi request đến API backend để lấy danh sách học viên.
 * Nếu thành công sẽ gọi hàm hiển thị dữ liệu và phân trang.
 */
async function getStudentList() {
  const API_BASE = "http://localhost:3000";
  try {
    const res = await fetch(`${API_BASE}/api/v1/admin/getStudentList`);
    const result = await res.json();

    if (result.status === "success" && Array.isArray(result.data)) {
      console.log("Student List:", result.data);
      studentDatas = result.data;
      filterDatas = [...studentDatas];
      renderStudentList(filterDatas);
    } else {
      Swal.fire("Thông báo", "Không lấy được dữ liệu!", "warning");
    }
  } catch (error) {
    console.error(error);
    Swal.fire("Lỗi", "Lỗi khi lấy dữ liệu!", "error");
  }
}

// === Biến toàn cục ===
/** @type {number} */
const limitRows = 10;
/** @type {number} */
let currentPage = 1;
/** @type {Array<Object>} */
let studentDatas = []; // Dữ liệu gốc
/** @type {Array<Object>} */
let filterDatas = []; // Dữ liệu sẽ hiển thị khi tìm kiếm

/**
 * Gán dữ liệu và hiển thị danh sách học viên trên giao diện kèm phân trang.
 * @param {Array<Object>} students - Mảng dữ liệu học viên từ server
 */
function renderStudentList(students) {
  filterDatas = students;
  displayStudentListPage(currentPage);
  renderPagination();
}

/**
 * Hiển thị học viên cho một trang cụ thể.
 * @param {number} page - Số trang cần hiển thị
 */
function displayStudentListPage(page) {
  const studentList = document.getElementById("student_list");
  studentList.innerHTML = ""; // Clear existing rows
  const start = (page - 1) * limitRows;
  const end = start + limitRows;
  const items = filterDatas.slice(start, end);

  items.forEach((student, index) => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td><span>${start + index + 1}</span></td>
      <td class="marquee-hover"><span>${student.student_code}</span></td>
      <td class="marquee-hover"><span>${student.student_middle_name} ${
      student.student_name
    }</span></td>
      <td class="marquee-hover"><span>${transferValue(student.student_gender)}</span></td>
      <td class="marquee-hover"><span>${transferValue(student.student_date_of_birth)}</span></td>
      <td class="marquee-hover"><span>${transferValue(
        student.student_address
      )}</span></td>
      <td class="marquee-hover"><span>${transferValue(
        student.student_email
      )}</span></td>
      <td class="marquee-hover"><span>${transferValue(
        student.student_phone
      )}</span></td>
      <td class="marquee-hover"><span>${transferValue(student.student_status)}</span></td>
      <td >
        <button
      data-bs-toggle="modal"
      data-bs-target="#editModal"
      data-student-code="${student.student_code}"
      data-middle-name="${student.student_middle_name}"
      data-name="${student.student_name}"
      data-status="${student.student_status}"
      class="btn btn-sm btn-warning me-1 btn-edit">
      <i class="bi bi-pencil-square me-1"></i>Sửa
    </button>
      </td>
    `;
    studentList.appendChild(row);
  });
}

/**
 * Vẽ thanh phân trang phía dưới bảng.
 * Tự động thêm các nút trang, dấu "..." và nút chuyển trang trước/sau.
 */
function renderPagination() {
  const totalPages = Math.ceil(filterDatas.length / limitRows);
  const pagination = document.getElementById("pagination");
  pagination.innerHTML = "";

  const maxVisible = 3; // Số nút trang muốn hiển thị xung quanh trang hiện tại
  let startPage = Math.max(1, currentPage - Math.floor(maxVisible / 2));
  let endPage = Math.min(totalPages, startPage + maxVisible - 1);

  // Điều chỉnh nếu cuối danh sách
  if (endPage - startPage < maxVisible - 1) {
    startPage = Math.max(1, endPage - maxVisible + 1);
  }

  // Nút "«" ← previous
  if (currentPage > 1) {
    pagination.appendChild(createPageItem("«", currentPage - 1));
  }

  // Nút trang đầu + dấu ...
  if (startPage > 1) {
    pagination.appendChild(createPageItem(1, 1));
    if (startPage > 2) {
      pagination.appendChild(createEllipsis());
    }
  }

  // Các nút trang chính giữa
  for (let i = startPage; i <= endPage; i++) {
    const li = createPageItem(i, i);
    if (i === currentPage) li.classList.add("active");
    pagination.appendChild(li);
  }

  // Dấu ... + trang cuối
  if (endPage < totalPages) {
    if (endPage < totalPages - 1) {
      pagination.appendChild(createEllipsis());
    }
    pagination.appendChild(createPageItem(totalPages, totalPages));
  }

  // Nút "»" → next
  if (currentPage < totalPages) {
    pagination.appendChild(createPageItem("»", currentPage + 1));
  }
}

/**
 * Tạo một nút trang (số hoặc điều hướng).
 * @param {string|number} label - Nội dung hiển thị của nút
 * @param {number} pageNum - Số trang tương ứng khi click
 * @returns {HTMLLIElement} - Phần tử <li> chứa nút
 */
function createPageItem(label, pageNum) {
  const li = document.createElement("li");
  li.className = "page-item";
  const a = document.createElement("a");
  a.className = "page-link";
  a.href = "#";
  a.textContent = label;
  a.addEventListener("click", (e) => {
    e.preventDefault();
    currentPage = pageNum;
    displayStudentListPage(currentPage);
    renderPagination();
  });
  li.appendChild(a);
  return li;
}

/**
 * Tạo một phần tử phân trang dạng "..." (dấu ba chấm).
 * @returns {HTMLLIElement} - Phần tử <li> disabled
 */
function createEllipsis() {
  const li = document.createElement("li");
  li.className = "page-item disabled";
  li.innerHTML = `<span class="page-link">...</span>`;
  return li;
}

/**
 * Lắng nghe input ô tìm kiếm và lọc dữ liệu từ `studentDatas` gốc.
 * Hiển thị danh sách học viên phù hợp.
 */
document.getElementById("searchInput").addEventListener("input", function () {
  const keyword = this.value.trim().toLowerCase();

  // filter dữ liệu từ danh sách sinh viên gốc
  const filtered = studentDatas.filter((student) => {
    const fullName =
      `${student.student_middle_name} ${student.student_name}`.toLowerCase();
    return (
      student.student_code.toLowerCase().includes(keyword) ||
      fullName.includes(keyword) ||
      student.student_phone?.toLowerCase().includes(keyword)
    );
  });

  currentPage = 1;
  renderStudentList(filtered);
});

```

### frontend\js\Administrator\manage_student\admin_import_student_list.js
```js
document.addEventListener("DOMContentLoaded", function () {
  getLastStudentCode();
});

/**
 * Chuyển đổi mã ngày dạng số serial từ Excel sang định dạng dd/mm/yyyy.
 * @param {number} serial - Mã ngày dạng số (Excel serial date)
 * @returns {string} - Ngày ở định dạng dd/mm/yyyy
 */

function formatDate(serial) {
  const utc_days = Math.floor(serial - 25569); // Excel's base date offset
  const utc_value = utc_days * 86400; // seconds
  const date = new Date(utc_value * 1000);

  const day = String(date.getUTCDate()).padStart(2, "0");
  const month = String(date.getUTCMonth() + 1).padStart(2, "0"); // tháng bắt đầu từ 0
  const year = date.getUTCFullYear();

  return `${day}/${month}/${year}`;
}

/**
 * Đọc và phân tích nội dung file Excel để chuyển thành danh sách học viên.
 * @param {File} file - File Excel được chọn từ input
 * @returns {Promise<Array<Object>|null>} - Mảng học viên đã xử lý hoặc null nếu lỗi
 */

async function parseExcelFile(file) {
  if (!file) {
    console.error("Không có file Excel được chọn");
    Swal.fire("Lỗi", "Không có file Excel được chọn!", "");
    return null;
  }

  try {
    const data = await file.arrayBuffer();
    const workbook = XLSX.read(await file.arrayBuffer(), { type: "array" });
    const sheet = workbook.Sheets[workbook.SheetNames[0]];
    const rows = XLSX.utils.sheet_to_json(sheet, { range: 7 });

    if (rows.length === 0) {
      console.warn("File Excel không có dữ liệu.");
      Swal.fire("Lỗi", "File Excel không có dữ liệu!", "error");
      return null;
    }
    const formatDatas = rows.slice(1, -1);

    const lastStudentCode = await getLastStudentCode();
    const trimmed = lastStudentCode.slice(0, 4);
    let convertNumber = Number(trimmed);

    const parsed = formatDatas.map((row) => {
      let student_code = row["MÃ HS"] || row["MÃ\nHS"] || "";
      const student_middle_name = row["HỌ ĐỆM"] || row["Họ và tên đệm"] || "";
      const student_name = row["TÊN"] || "";
      let ngaySinh = row["NGÀY SINH"] || "";
      const student_date_of_birth = isNaN(ngaySinh)
        ? ngaySinh
        : formatDate(ngaySinh);

      if (!student_code || student_code.trim() === "") {
        convertNumber++;
        const formattedNumber = String(convertNumber).padStart(4, "0"); // → "0140"
        student_code = `${formattedNumber}/25-THUD`;
      }

      return {
        student_code,
        student_middle_name,
        student_name,
        student_date_of_birth,
      };
    });

    if (parsed.length === 0) {
      console.warn("Không có dữ liệu hợp lệ trong file Excel.");
      Swal.fire("Lỗi", "Không có dữ liệu hợp lệ trong file Excel!", "error");
      return null;
    }

    return parsed;
  } catch (err) {
    console.error("❌ Lỗi khi đọc file Excel:", err);
    return null;
  }
}

/**
 * Gọi API để lấy mã học viên cuối cùng hiện có trong hệ thống.
 * @returns {Promise<string|undefined>} - Mã học viên cuối nếu thành công
 */

async function getLastStudentCode() {
  const API_BASE = "http://localhost:3000";
  try {
    const res = await fetch(`${API_BASE}/api/v1/admin/getLastStudentCode`);

    const result = await res.json();

    if (result.status === "success" && result.data) {
      const lastStudentCode = result.data.student_code;
      //   console.log("Student Code:", lastStudentCode);
      return lastStudentCode;
    } else {
      Swal.fire("Thông báo", "Không lấy được dữ liệu!", "warning");
    }
  } catch (error) {
    console.error(error);
    Swal.fire("Lỗi", "Lỗi khi lấy dữ liệu!", "error");
  }
}

/**
 * Gửi danh sách học viên đã xử lý lên server để thêm vào hệ thống.
 * @param {Array<Object>} payload - Danh sách học viên để import
 */

async function importStudentList(payload) {
  if (!payload || !Array.isArray(payload)) {
    Swal.fire("Lỗi", "Dữ liệu không hợp lệ!", "error");
    console.error("Dữ liệu không hợp lệ:", payload);
    return;
  }

  const API_BASE = "http://localhost:3000";
  try {
    const res = await fetch(`${API_BASE}/api/v1/admin/importStudentList`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(payload),
    });

    const result = await res.json();
    if (result.data.insertedCount === 0) {
      Swal.fire(
        "Thông báo",
        "Không có học sinh nào được thêm vào hệ thống!",
        "info"
      );
      return;
    }

    if (result.status === "success") {
      Swal.fire(
        "Thành công",
        `Đã thêm ${result.data.insertedCount}! vào hệ thống`,
        "success"
      ).then(() => {
        getStudentList();
      });
    } else {
      Swal.fire("Thông báo", "Không thể thêm dữ liệu!", "warning");
      console.error("Lỗi khi thêm dữ liệu:", result.message);
    }
  } catch (error) {
    console.error("❌ Lỗi khi thêm dữ liệu:", error);
    Swal.fire("Lỗi", "Lỗi khi thêm dữ liệu!", "error");
  }
}

/**
 * Bắt sự kiện chọn file Excel, xử lý và gửi dữ liệu lên server.
 */

document
  .getElementById("excelFile")
  .addEventListener("change", async function () {
    const file = this.files[0];
    const result = await parseExcelFile(file);
    // const studentCodes = await parseNametoStudentCode(result);
    console.log("📄 Danh sách sinh viên:", result);

    await importStudentList(result);
  });

```

### frontend\js\Administrator\manage_student\admin_update_student.js
```js
/**
 * Khi modal chỉnh sửa học viên hiển thị, tự động gán thông tin học viên vào các ô input.
 */
document
  .getElementById("editModal")
  .addEventListener("show.bs.modal", async function (event) {
    /** @type {HTMLElement} */
    const button = event.relatedTarget;

    /** @type {string} Mã số sinh viên */
    const studentCode = button.getAttribute("data-student-code");

    /** @type {string} Họ đệm */
    const middle_name = button.getAttribute("data-middle-name");

    /** @type {string} Tên */
    const name = button.getAttribute("data-name");

    /** @type {string} Trạng thái */
    const status = button.getAttribute("data-status");

    // Gán giá trị vào các trường trong form
    document.getElementById("editMaSV").value = studentCode;
    document.getElementById("editHoDem").value = middle_name;
    document.getElementById("editTen").value = name;
    document.getElementById("editTrangThai").value = status;
  });

/**
 * Xử lý sự kiện submit form cập nhật thông tin học viên.
 */
document
  .getElementById("editStudentForm")
  .addEventListener("submit", function (e) {
    e.preventDefault(); // Ngăn form reload trang

    // Lấy giá trị từ các input
    const code = document.getElementById("editMaSV").value.trim();
    const middle_name = document.getElementById("editHoDem").value.trim();
    const name = document.getElementById("editTen").value.trim();
    const stauts = document.getElementById("editTrangThai").value.trim(); // typo: 'stauts' nên sửa thành 'status'

    /** @type {{student_code: string, student_middle_name: string, student_name: string, student_status: string}} */
    const student = {
      student_code: code,
      student_middle_name: middle_name,
      student_name: name,
      student_status: stauts,
    };

    // Đóng modal sau khi submit
    bootstrap.Modal.getInstance(document.getElementById("editModal")).hide();

    // Gọi API cập nhật
    updateStudentInfor(student);
  });

/**
 * Gửi yêu cầu cập nhật thông tin học viên lên server.
 *
 * @param {{student_code: string, student_middle_name: string, student_name: string, student_status: string}} student - Đối tượng thông tin học viên.
 */
async function updateStudentInfor(student) {
  if (!student) {
    Swal.fire("Lỗi", "Thiếu thông tin của học viên!", "error");
    return;
  }

  const API_BASE = "http://localhost:3000";

  try {
    const res = await fetch(`${API_BASE}/api/v1/admin/updateStudentInfor`, {
      method: "PUT",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(student),
    });

    const data = await res.json();

    if (data.status === "success") {
      Swal.fire("Thành công", "Thông tin đã được cập nhật!", "success");
      getStudentList?.(); // Làm mới danh sách nếu hàm tồn tại
    } else {
      Swal.fire(
        "Lỗi",
        data.message || "Không thể cập nhật thông tin học viên!",
        "error"
      );
    }
  } catch (error) {
    console.error("Error:", error);
    Swal.fire("Lỗi", "Có lỗi xảy ra khi cập nhật!", "error");
  }
}

```

### frontend\js\Administrator\manage_teacher\admin_add_teacher.js
```js
/**
 * Khi tài liệu HTML được tải xong:
 * - Tự động lấy mã giáo viên mới và mã cuối cùng hiện tại để hiển thị trong console.
 */
document.addEventListener("DOMContentLoaded", async () => {
  const newCode = await getNewCode();
  const oldCode = await getLastTeacherCode();
  console.log("after format code: " + newCode);
  console.log("old code: " + oldCode);
});

/**
 * Gửi yêu cầu đến backend để lấy mã giáo viên cuối cùng đã có trong hệ thống.
 *
 * @returns {Promise<string|undefined>} - Mã giáo viên cuối nếu thành công, ngược lại trả về `undefined`.
 */
async function getLastTeacherCode() {
  const API_BASE = "http://localhost:3000";
  try {
    const res = await fetch(`${API_BASE}/api/v1/admin/getLastTeacherCode`);

    const result = await res.json();

    if (result.status === "success" && result.data) {
      const lastTeacherCode = result.data.teacher_code;
      return lastTeacherCode;
    } else {
      Swal.fire("Thông báo", "Không lấy được dữ liệu!", "warning");
    }
  } catch (error) {
    console.error(error);
    Swal.fire("Lỗi", "Lỗi khi lấy dữ liệu!", "error");
  }
}

/**
 * Tăng số thứ tự trong mã giáo viên cũ và định dạng lại theo quy chuẩn.
 *
 * @param {string} teacherCode - Mã giáo viên hiện tại (ví dụ: "GV00012")
 * @returns {string|null} - Mã mới (ví dụ: "GV00013"), hoặc null nếu có lỗi.
 */
function formatTeacherCode(teacherCode) {
  if (!teacherCode) {
    Swal.fire("Thông báo", "Không lấy được mã học viên cuối!", "warning");
    return null;
  }

  const oldCode = teacherCode;
  const numberPart = oldCode.slice(2); // bỏ 'GV'
  const newNumber = parseInt(numberPart, 10) + 1;

  // Format lại với padding
  const newCode = String(newNumber).padStart(5, "0");
  return `GV${newCode}`;
}

/**
 * Lấy mã giáo viên cuối cùng từ hệ thống và trả về mã mới được định dạng.
 *
 * @returns {Promise<string|null>} - Mã giáo viên mới (ví dụ: "GV00013")
 */
async function getNewCode() {
  const beforeFormat = await getLastTeacherCode();
  const afterFormat = formatTeacherCode(beforeFormat);
  return afterFormat;
}

/**
 * Khi modal "Thêm giáo viên" được mở, tự động gán mã giáo viên mới vào ô input.
 */
document
  .getElementById("addTeacherModal")
  .addEventListener("show.bs.modal", async function (event) {
    // const button = event.relatedTarget; // nút gọi modal
    const newCode = await getNewCode();
    const teacher_code = document.getElementById("maSo");
    teacher_code.value = newCode; // gán giá trị vào input
  });

/**
 * Gửi dữ liệu giáo viên mới lên server thông qua API.
 *
 * @param {Object} teacher - Đối tượng giáo viên cần thêm.
 * @param {string} teacher.teacher_code
 * @param {string} teacher.teacher_name
 * @param {string} teacher.teacher_date_of_birth
 * @param {string} teacher.teacher_gender
 * @param {string} teacher.teacher_address
 * @param {string} teacher.teacher_email
 * @param {string} teacher.teacher_phone
 */
async function addNewTeacher(teacher) {
  if (!teacher) {
    Swal.fire("Cảnh Báo", "Không nhận được dữ liệu nhập vào!!!", "error");
    console.error("Thiếu dữ liệu cần thiết");
    return;
  }

  console.log(teacher);

  const API_BASE = "http://localhost:3000";
  try {
    const res = await fetch(`${API_BASE}/api/v1/admin/addNewTeacher`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(teacher),
    });

    const data = await res.json();

    if (data.status === "success") {
      Swal.fire("Thành công", "Thêm dữ liệu thành công!", "success");
      getTeacherList();
    } else {
      Swal.fire("Lỗi", data.message || "Không thể thêm dữ liệu!", "error");
    }
  } catch (error) {
    console.error("Error:", error);
    Swal.fire("Lỗi", "Có lỗi xảy ra khi cập nhật điểm!", "error");
  }
}

/**
 * Lắng nghe sự kiện submit của form thêm giáo viên.
 * - Tạo object giáo viên từ input form.
 * - Gửi dữ liệu lên server.
 * - Đóng modal và reset form sau khi thêm thành công.
 */
document.getElementById("teacherForm").addEventListener("submit", async (e) => {
  e.preventDefault(); // Ngăn form reload trang

  const teacher = {
    teacher_code: document.getElementById("maSo").value.trim(),
    teacher_name: document.getElementById("hoTen").value.trim(),
    teacher_date_of_birth: document.getElementById("ngaySinh").value.trim(),
    teacher_gender: document.getElementById("gioiTinh").value.trim(),
    teacher_address: document.getElementById("diaChi").value.trim(),
    teacher_email: document.getElementById("email").value.trim(),
    teacher_phone: document.getElementById("sdt").value.trim(),
  };
  console.log(document.getElementById("ngaySinh").value.trim());

  // Gửi dữ liệu lên server
  await addNewTeacher(teacher);

  // Đóng modal sau khi thêm
  const modal = bootstrap.Modal.getInstance(
    document.getElementById("addTeacherModal")
  );
  modal.hide();

  // Reset form
  document.getElementById("teacherForm").reset();
});

```

### frontend\js\Administrator\manage_teacher\admin_display_teacher.js
```js
/**
 * Sự kiện DOMContentLoaded: Khi tài liệu được tải xong, gọi hàm lấy danh sách giáo viên.
 */
document.addEventListener("DOMContentLoaded", async () => {
  getTeacherList();
});

/**
 * Chuyển đổi các giá trị kỹ thuật (status, gender, v.v.) thành dạng dễ đọc cho người dùng.
 *
 * @param {*} value - Giá trị cần chuyển đổi (string hoặc null/undefined)
 * @returns {string} - Giá trị đã chuyển đổi phù hợp để hiển thị
 */
function transferValue(value) {
  if (value === null || value === undefined || value === "") return "-";
  const dictionary = {
    female: "Nữ",
    male: "Nam",
    other: "Khác",
    teaching: "Đang dạy",
    on_leave: "Nghỉ phép",
    resigned: "Nghỉ việc",
    retired: "Nghỉ hưu",
  };
  return dictionary[value] || value;
}

/**
 * Gửi yêu cầu đến API backend để lấy danh sách giáo viên.
 * Nếu thành công, gọi hàm hiển thị danh sách và phân trang.
 */
async function getTeacherList() {
  const API_BASE = "http://localhost:3000";
  try {
    const res = await fetch(`${API_BASE}/api/v1/admin/getTeacherList`);
    const result = await res.json();

    if (result.status === "success" && Array.isArray(result.data)) {
      console.log("Teacher List:", result.data);
      teacherDatas = result.data;
      filterDatas = [...teacherDatas];
      renderTeacherList(filterDatas);
    } else {
      Swal.fire("Thông báo", "Không lấy được dữ liệu!", "warning");
    }
  } catch (error) {
    console.error(error);
    Swal.fire("Lỗi", "Lỗi khi lấy dữ liệu!", "error");
  }
}

// === Biến toàn cục ===
/** @type {number} */
const limitRows = 10;
/** @type {number} */
let currentPage = 1;
/** @type {Array<Object>} */
let teacherDatas = []; // Dữ liệu gốc
/** @type {Array<Object>} */
let filterDatas = []; // Dữ liệu sẽ hiển thị khi tìm kiếm

/**
 * Gán dữ liệu và hiển thị danh sách giáo viên kèm phân trang.
 *
 * @param {Array<Object>} teachers - Mảng dữ liệu giáo viên
 */
function renderTeacherList(teachers) {
  filterDatas = teachers;
  displayTeacherListPage(currentPage);
  renderPagination();
}

/**
 * Hiển thị danh sách giáo viên cho một trang cụ thể.
 *
 * @param {number} page - Số trang cần hiển thị
 */
function displayTeacherListPage(page) {
  const teacherList = document.getElementById("teacherTableBody");
  teacherList.innerHTML = ""; // Clear existing rows
  const start = (page - 1) * limitRows;
  const end = start + limitRows;
  const items = filterDatas.slice(start, end);

  items.forEach((teacher, index) => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td><span>${start + index + 1}</span></td>
      <td><span>${teacher.teacher_code}</span></td>
	  <td><span>${teacher.teacher_name} </span></td>
      <td><span>${transferValue(teacher.teacher_date_of_birth)}</span></td>
      <td><span>${transferValue(teacher.teacher_gender)}</span></td>
      <td class="marquee-hover"><span>${transferValue(
        teacher.teacher_address
      )}</span></td>
      <td class="marquee-hover"><span>${transferValue(
        teacher.teacher_email
      )}</span></td>
      <td class="marquee-hover"><span>${transferValue(
        teacher.teacher_phone
      )}</span></td>
      <td><span>${transferValue(teacher.teacher_status)}</span></td>
      <td>
        <button
                class="btn btn-sm btn-warning me-1"
                data-bs-toggle="modal"
                data-bs-target="#editTeacherModal"
				data-code = "${teacher["teacher_code"]}"
				data-name = "${teacher["teacher_name"]}"
				data-phone = "${teacher["teacher_phone"]}"
				data-gender = "${teacher["teacher_gender"]}"
				data-date-of-birth = "${teacher["teacher_date_of_birth"]}"
				data-email = "${teacher["teacher_email"]}"
				data-address = "${teacher["teacher_address"]}"
				data-status = "${teacher["teacher_status"]}">
				
                <i class="bi bi-pencil-square"></i> Sửa
              </button>
      </td>
    `;
    teacherList.appendChild(row);
  });
}

/**
 * Vẽ thanh phân trang phía dưới bảng.
 * Tự động thêm các nút trang, dấu "..." và nút chuyển trang trước/sau.
 */
function renderPagination() {
  const totalPages = Math.ceil(filterDatas.length / limitRows);
  const pagination = document.getElementById("pagination");
  pagination.innerHTML = "";

  const maxVisible = 3; // Số nút trang muốn hiển thị xung quanh trang hiện tại
  let startPage = Math.max(1, currentPage - Math.floor(maxVisible / 2));
  let endPage = Math.min(totalPages, startPage + maxVisible - 1);

  // Điều chỉnh nếu cuối danh sách
  if (endPage - startPage < maxVisible - 1) {
    startPage = Math.max(1, endPage - maxVisible + 1);
  }

  // Nút "«" ← previous
  if (currentPage > 1) {
    pagination.appendChild(createPageItem("«", currentPage - 1));
  }

  // Nút trang đầu + dấu ...
  if (startPage > 1) {
    pagination.appendChild(createPageItem(1, 1));
    if (startPage > 2) {
      pagination.appendChild(createEllipsis());
    }
  }

  // Các nút trang chính giữa
  for (let i = startPage; i <= endPage; i++) {
    const li = createPageItem(i, i);
    if (i === currentPage) li.classList.add("active");
    pagination.appendChild(li);
  }

  // Dấu ... + trang cuối
  if (endPage < totalPages) {
    if (endPage < totalPages - 1) {
      pagination.appendChild(createEllipsis());
    }
    pagination.appendChild(createPageItem(totalPages, totalPages));
  }

  // Nút "»" → next
  if (currentPage < totalPages) {
    pagination.appendChild(createPageItem("»", currentPage + 1));
  }
}

/**
 * Tạo một nút trang (số hoặc điều hướng).
 * @param {string|number} label - Nội dung hiển thị của nút
 * @param {number} pageNum - Số trang tương ứng khi click
 * @returns {HTMLLIElement} - Phần tử <li> chứa nút
 */
function createPageItem(label, pageNum) {
  const li = document.createElement("li");
  li.className = "page-item";
  const a = document.createElement("a");
  a.className = "page-link";
  a.href = "#";
  a.textContent = label;
  a.addEventListener("click", (e) => {
    e.preventDefault();
    currentPage = pageNum;
    displayStudentListPage(currentPage);
    renderPagination();
  });
  li.appendChild(a);
  return li;
}

/**
 * Tạo một phần tử phân trang dạng "..." (dấu ba chấm).
 * @returns {HTMLLIElement} - Phần tử <li> disabled
 */
function createEllipsis() {
  const li = document.createElement("li");
  li.className = "page-item disabled";
  li.innerHTML = `<span class="page-link">...</span>`;
  return li;
}

/**
 * Lọc dữ liệu giáo viên theo từ khóa tìm kiếm và hiển thị kết quả.
 */
document.getElementById("searchInput").addEventListener("input", function () {
  const keyword = this.value.trim().toLowerCase();

  // filter dữ liệu từ danh sách sinh viên gốc
  const filtered = teacherDatas.filter((teacher) => {
    const fullName = `${teacher.teacher_name}`.toLowerCase();
    return (
      teacher.teacher_code.toLowerCase().includes(keyword) ||
      fullName.includes(keyword) ||
      teacher.teacher_phone?.toLowerCase().includes(keyword)
    );
  });

  currentPage = 1;
  renderTeacherList(filtered);
});

```

### frontend\js\Administrator\manage_teacher\admin_update_teacher.js
```js
/**
 * Khi modal sửa thông tin giảng viên được hiển thị, tự động lấy dữ liệu từ nút trigger
 * và gán các giá trị vào các input trong form chỉnh sửa.
 */
document
  .getElementById("editTeacherModal")
  .addEventListener("show.bs.modal", async function (event) {
    const button = event.relatedTarget;
    const code = button.getAttribute("data-code");
    const name = button.getAttribute("data-name");
    const phone = button.getAttribute("data-phone");
    const gender = button.getAttribute("data-gender");
    const dateOfBirth = button.getAttribute("data-date-of-birth");
    const email = button.getAttribute("data-email");
    const address = button.getAttribute("data-address");
    const status = button.getAttribute("data-status");

    document.getElementById("editMaSo").value = code;
    document.getElementById("editHoTen").value = name;
    document.getElementById("editNgaySinh").value = dateOfBirth;
    document.getElementById("editGioiTinh").value = gender;
    document.getElementById("editDiaChi").value = address;
    document.getElementById("editEmail").value = email;
    document.getElementById("editSdt").value = phone;
    document.getElementById("editTrangThai").value = status;
  });

/**
 * Bắt sự kiện submit của form sửa giảng viên.
 * Thu thập dữ liệu từ form, đóng modal, reset form và gọi hàm cập nhật thông tin giảng viên.
 */
document
  .getElementById("editTeacherForm")
  .addEventListener("submit", function (e) {
    e.preventDefault(); // Ngăn reload trang
    const code = document.getElementById("editMaSo").value.trim();
    const name = document.getElementById("editHoTen").value.trim();
    const dateOfBirth = document.getElementById("editNgaySinh").value.trim();
    const gender = document.getElementById("editGioiTinh").value.trim();
    const address = document.getElementById("editDiaChi").value.trim();
    const email = document.getElementById("editEmail").value.trim();
    const phone = document.getElementById("editSdt").value.trim();
    const status = document.getElementById("editTrangThai").value.trim();

    const teacher = {
      teacher_code: code,
      teacher_name: name,
      teacher_date_of_birth: dateOfBirth,
      teacher_gender: gender,
      teacher_address: address,
      teacher_email: email,
      teacher_phone: phone,
      teacher_status: status,
    };

    bootstrap.Modal.getInstance(
      document.getElementById("editTeacherModal")
    ).hide();
    document.getElementById("editTeacherForm").reset();
    updateTeacherInfor(teacher);
  });

/**
 * Gửi yêu cầu cập nhật thông tin giảng viên đến backend.
 *
 * @param {Object} teacher - Đối tượng chứa dữ liệu giảng viên cần cập nhật
 * @param {string} teacher.teacher_code - Mã số giảng viên
 * @param {string} teacher.teacher_name - Họ và tên
 * @param {string} teacher.teacher_date_of_birth - Ngày sinh (YYYY-MM-DD)
 * @param {string} teacher.teacher_gender - Giới tính
 * @param {string} teacher.teacher_address - Địa chỉ
 * @param {string} teacher.teacher_email - Email
 * @param {string} teacher.teacher_phone - Số điện thoại
 * @param {string} teacher.teacher_status - Trạng thái giảng viên
 */
async function updateTeacherInfor(teacher) {
  if (!teacher) {
    Swal.fire("Lỗi", "Thiếu thông tin của học viên!", "error");
    return;
  }
  console.log("teacher", teacher);
  const API_BASE = "http://localhost:3000";
  try {
    const res = await fetch(`${API_BASE}/api/v1/admin/updateTeacherInfor`, {
      method: "PUT",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(teacher),
    });

    const data = await res.json();

    if (data.status === "success") {
      getTeacherList();
      Swal.fire("Thành công", "Thông tin đã được cập nhật!", "success");
    } else {
      Swal.fire(
        "Lỗi",
        data.message || "Không thể cập nhật thông tin giảng viên!",
        "error"
      );
    }
  } catch (error) {
    console.error("Error:", error);
    Swal.fire("Lỗi", "Có lỗi xảy ra khi cập nhật!", "error");
  }
}

```

### frontend\js\Authentication\login.js
```js
/**
 * Xử lý sự kiện đăng nhập người dùng khi form được submit.
 * Gửi yêu cầu đến API xác thực, xử lý token và chuyển hướng dựa trên vai trò.
 */
const loginForm = document.getElementById("loginForm");

if (loginForm) {
  loginForm.addEventListener("submit", async function (event) {
    event.preventDefault();

    const username = loginForm.querySelector('input[type="text"]').value;
    const password = loginForm.querySelector('input[type="password"]').value;

    /**
     * Kiểm tra thông tin nhập vào. Nếu thiếu sẽ hiển thị cảnh báo bằng SweetAlert2.
     */
    if (!username || !password) {
      Swal.fire({
        icon: "warning",
        title: "Thiếu thông tin",
        text: "Vui lòng nhập đầy đủ tài khoản và mật khẩu!",
      });
      return;
    }

    try {
      const API_BASE = "http://localhost:3000";

      /**
       * Gửi yêu cầu đăng nhập đến API backend.
       * @typedef {Object} LoginResponse
       * @property {string} status - Trạng thái phản hồi ("success" hoặc "fail")
       * @property {Object} data - Dữ liệu trả về khi thành công
       * @property {string} data.token - Token JWT xác thực
       * @property {Object} data.user - Thông tin người dùng
       * @property {number} data.user.role - Vai trò người dùng (0: admin, 1: student, 2: teacher)
       */

      const response = await fetch(`${API_BASE}/api/v1/auth/login`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ username, password }),
      });

      /** @type {LoginResponse} */
      const result = await response.json();

      if (result.status === "success") {
        const { token, user } = result.data;

        // Lưu thông tin người dùng và token vào localStorage thông qua hàm Storage tự định nghĩa
        Storage.saveUser(user, token);

        // Lưu thông báo thành công để hiển thị tại trang sau đăng nhập
        localStorage.setItem(
          "loginSuccess",
          `Chào mừng ${user.username || "người dùng"} trở lại!`
        );

        /**
         * Chuyển hướng người dùng đến trang phù hợp theo role:
         * 0 - Admin
         * 1 - Student
         * 2 - Teacher
         */
        switch (user.role) {
          case 0:
            window.location.href = "../admin/page_admin.html";
            break;
          case 1:
            window.location.href = "../student/page_student.html";
            break;
          case 2:
            window.location.href = "../teacher/page_teacher_home.html";
            break;
          default:
            Swal.fire(
              "Cảnh báo",
              "Không xác định vai trò người dùng!",
              "warning"
            );
        }
      } else {
        // Đăng nhập thất bại
        Swal.fire({
          icon: "error",
          title: "Đăng nhập thất bại",
          text: result.message || "Sai tài khoản hoặc mật khẩu!",
        });
      }
    } catch (error) {
      console.error(error);
      Swal.fire({
        icon: "error",
        title: "Lỗi kết nối",
        text: `Không thể kết nối đến máy chủ: ${error.message}`,
      });
    }
  });
} else {
  console.error("Không tìm thấy form đăng nhập!");
}

```

### frontend\js\Authentication\logout.js
```js
/**
 * Xử lý đăng xuất người dùng khỏi hệ thống.
 *
 * Gọi API `/logout` để hủy phiên trên server (nếu áp dụng),
 * sau đó xóa dữ liệu người dùng khỏi `localStorage/sessionStorage` (thông qua Storage),
 * và chuyển hướng người dùng về trang đăng nhập.
 */
function handleLogout() {
  // Gọi API logout để hủy session phía server (nếu cần)
  fetch("http://localhost:3000/api/v1/auth/logout", {
    method: "POST",
    credentials: "include", // Bao gồm cookie khi gửi request
  }).catch((err) => {
    console.warn("Không thể gọi logout từ server:", err.message);
  });

  // Xóa toàn bộ dữ liệu lưu trữ của người dùng ở phía client
  Storage.clear();

  // Chuyển hướng người dùng về trang đăng nhập
  window.location.href = "../login/login.html";
}

/**
 * Khi DOM được tải xong, tự động gắn sự kiện `click` vào các nút đăng xuất
 * nếu chúng tồn tại trong DOM.
 */
window.addEventListener("DOMContentLoaded", () => {
  const btns = [
    document.getElementById("logoutBtn"),
    document.getElementById("sidebarLogout"),
  ];

  /**
   * Gắn sự kiện `click` để gọi hàm `handleLogout` cho từng nút.
   * Dùng để đảm bảo mọi giao diện logout đều hoạt động.
   */
  btns.forEach((btn) => {
    if (btn) {
      btn.addEventListener("click", handleLogout);
    }
  });
});

```

### frontend\js\Authentication\storage.js
```js
/**
 * Đối tượng `Storage` dùng để quản lý thông tin đăng nhập của người dùng
 * thông qua `localStorage`, bao gồm lưu, lấy và xóa token và user.
 * Được gắn vào `window` để sử dụng toàn cục.
 */
const Storage = {
  /**
   * Lưu thông tin người dùng và token vào `localStorage`.
   *
   * @param {Object} user - Đối tượng thông tin người dùng.
   * @param {string} token - Mã thông báo xác thực JWT.
   */
  saveUser: (user, token) => {
    localStorage.setItem("user", JSON.stringify(user));
    localStorage.setItem("token", token);
  },

  /**
   * Lấy thông tin người dùng từ `localStorage`.
   *
   * @returns {Object|null} - Đối tượng người dùng hoặc `null` nếu không có.
   */
  getUser: () => {
    const user = localStorage.getItem("user");
    return user ? JSON.parse(user) : null;
  },

  /**
   * Lấy `token` xác thực từ `localStorage`.
   *
   * @returns {string|null} - Token JWT hoặc `null` nếu không tồn tại.
   */
  getToken: () => localStorage.getItem("token"),

  /**
   * Lấy vai trò (role) của người dùng hiện tại.
   *
   * @returns {number|null} - Mã vai trò (ví dụ: 0 = admin, 1 = student, 2 = teacher) hoặc `null`.
   */
  getRole: () => {
    const user = Storage.getUser();
    return user ? user.role : null;
  },

  /**
   * Kiểm tra xem người dùng đã đăng nhập hay chưa.
   *
   * @returns {boolean} - `true` nếu có token, ngược lại `false`.
   */
  isLoggedIn: () => !!Storage.getToken(),

  /**
   * Xóa toàn bộ thông tin người dùng và token khỏi `localStorage`.
   */
  clear: () => {
    localStorage.removeItem("user");
    localStorage.removeItem("token");
  },
};

// Gắn đối tượng Storage lên `window` để có thể sử dụng toàn cục
window.Storage = Storage;

```

### frontend\js\Student\student.js
```js
document.addEventListener("DOMContentLoaded", function () {
  fetchStudentScores();
  displayStudentName();
  const message = localStorage.getItem("loginSuccess");
  if (message) {
    // Hiển thị toast
    Swal.fire({
      toast: true,
      position: "top-end",
      icon: "success",
      title: message,
      showConfirmButton: false,
      timer: 1500,
      timerProgressBar: true,
    });

    // Xóa sau khi hiển thị
    localStorage.removeItem("loginSuccess");
  }
});

/**
 * Gọi API để lấy bảng điểm sinh viên và hiển thị ra giao diện.
 * Đồng thời tính toán và hiển thị thống kê tổng kết trên các card.
 */
async function fetchStudentScores() {
  const student = Storage.getUser();
  if (!student || !student.username) {
    Swal.fire("Lỗi", "Không xác định được sinh viên!", "error");
    return;
  }

  try {
    const API_BASE = "http://localhost:3000";
    const res = await fetch(
      `${API_BASE}/api/v1/student/getScore?studentCode=${student.username}`
    );
    const result = await res.json();

    if (result.status === "success" && Array.isArray(result.data)) {
      console.log("data: " + result.data);
      renderScoresToTable(result.data);
      summaryCard(result.data);
    } else {
      Swal.fire("Thông báo", "Không lấy được dữ liệu điểm!", "warning");
    }
  } catch (error) {
    console.error(error);
    Swal.fire("Lỗi", "Lỗi khi lấy dữ liệu điểm!", "error");
  }
}

/**
 * Hiển thị danh sách điểm chi tiết vào bảng HTML.
 * @param {Array<Object>} scores - Danh sách điểm theo môn học
 */
function renderScoresToTable(scores) {
  const tbody = document.querySelector("table tbody");
  tbody.innerHTML = "";
  console.log(scores);

  scores.forEach((item, index) => {
    var KQ;
    if (item["Tổng điểm"] === null || item["Tổng điểm"] === undefined) {
      KQ = "-";
    } else if (item["Tổng điểm"] >= 4) {
      KQ = "Đạt";
    } else {
      KQ = "Không Đạt";
    }
    const row = document.createElement("tr");

    row.innerHTML = `
      <td>${index + 1}</td>
      <td>${item["Mã Môn học"]}</td>
      <td>${item["Tên Môn học"]}</td>
      <td>${item["Đơn Vị Học"] ?? "-"}</td>
      <td>${item["Học kỳ"] ?? "-"}</td>
      <td>${item["Tổng điểm"] ?? "-"}</td>
      <td>${KQ}</td>
      <td>-</td>
    `;

    tbody.appendChild(row);
  });
}

/**
 * Tính toán điểm trung bình (thang 10, thang 4),
 * kết luận kết quả (Đạt/Không) và điểm chữ.
 * @param {Array<Object>} scores - Danh sách điểm theo môn học
 */
function summaryCard(scores) {
  const avg10Score = document.querySelector(".card.yellow .h3");
  const avg4Score = document.querySelector(".card.red .h3");
  const result = document.querySelector(".card.blue .h3");
  const letterGrade = document.querySelector(".card.teal .h3");

  const validScores = scores
    .map((s) => parseFloat(s["Tổng điểm"]))
    .filter((score) => !isNaN(score));
  console.log("Điểm hợp lệ:", validScores);

  if (validScores.length !== scores.length || validScores.length === 0) {
    avg10Score.textContent = "-";
    avg4Score.textContent = "-";
    result.textContent = "-";
    letterGrade.textContent = "-";
    return;
  }

  const sum = validScores.reduce((a, b) => a + b, 0);
  const avg10 = sum / validScores.length;
  console.log("Tổng điểm:", sum);
  console.log("Điểm trung bình 10:", avg10);

  const avg4 =
    validScores
      .map((score) => convertToHeSo4(score))
      .reduce((a, b) => a + b, 0) / validScores.length;

  const passed = validScores.every((score) => score >= 4);
  const letter = convertToLetterGrade(avg10);

  avg10Score.textContent = avg10.toFixed(2);
  avg4Score.textContent = avg4.toFixed(2);
  result.textContent = passed ? "Đạt" : "Không đạt";
  letterGrade.textContent = letter;
}

/**
 * Chuyển điểm từ thang 10 sang thang 4.
 * @param {number} score - Điểm theo thang 10
 * @returns {number} - Điểm quy đổi theo thang 4
 */
function convertToHeSo4(score) {
  if (score >= 9) return 4.0;
  if (score >= 7.0) return 3.0;
  if (score >= 5.5) return 2.0;
  if (score >= 4.0) return 1.0;
  return 0.0;
}

/**
 * Chuyển điểm thang 10 sang xếp loại điểm chữ.
 * @param {number} score - Điểm thang 10
 * @returns {string} - Xếp loại: A, B+, B, C+, C, D+, D, F
 */
function convertToLetterGrade(score) {
  if (score >= 8.5) return "A";
  if (score >= 8.0) return "B+";
  if (score >= 7.0) return "B";
  if (score >= 6.5) return "C+";
  if (score >= 5.5) return "C";
  if (score >= 5.0) return "D+";
  if (score >= 4.0) return "D";
  return "F";
}

/**
 * Gọi API để lọc điểm theo học kỳ được nhập.
 * Hiển thị dữ liệu điểm tương ứng và cập nhật thống kê.
 */
async function filterStudentScores() {
  const student = Storage.getUser();
  if (!student || !student.username) {
    Swal.fire("Lỗi", "Không xác định được sinh viên!", "error");
    return;
  }

  const semesterInput = document.querySelector("#hocKy");
  const semester = semesterInput.value.trim();

  try {
    const API_BASE = "http://localhost:3000";
    const res = await fetch(
      `${API_BASE}/api/v1/student/getScoreBySemester?studentCode=${student.username}&semester=${semester}`
    );
    const result = await res.json();

    if (result.status === "success" && Array.isArray(result.data)) {
      console.log("Dữ liệu sau khi lọc:", result.data);
      renderScoresToTable(result.data);
      summaryCard(result.data);
    } else {
      Swal.fire("Thông báo", "Không lấy được dữ liệu điểm!", "warning");
    }
  } catch (error) {
    console.error(error);
    Swal.fire("Lỗi", "Lỗi khi lấy dữ liệu điểm!", "error");
  }
}

/**
 * Gọi API lấy thông tin sinh viên và hiển thị tên đầy đủ.
 */
async function displayStudentName() {
  const student = Storage.getUser();
  if (!student || !student.username) {
    Swal.fire("Lỗi", "Không xác định được sinh viên!", "error");
    return;
  }

  try {
    const API_BASE = "http://localhost:3000";
    const res = await fetch(
      `${API_BASE}/api/v1/student/getStudentInfo?studentCode=${student.username}`
    );

    const result = await res.json();

    if (result.status === "success") {
      document.querySelector(
        ".studentFullName"
      ).textContent = `${result.data.student_middle_name} ${result.data.student_name}`;
    } else {
      Swal.fire("Thông báo", "Không tìm thấy thông tin sinh viên!", "warning");
    }
  } catch (error) {
    console.error(error);
    Swal.fire("Lỗi", "Không thể kết nối tới máy chủ!", "error");
  }
}

```

### frontend\js\Student\student_cert.js
```js
/**
 * Khởi chạy khi DOM đã tải xong.
 * Gọi hàm lấy chứng chỉ và hiển thị tên sinh viên.
 */
document.addEventListener("DOMContentLoaded", async () => {
  await getCertificatesOfStudent();
  await displayStudentName();
});

/**
 * Hiển thị tên sinh viên hiện tại đang đăng nhập.
 * Dựa vào thông tin người dùng được lưu trong localStorage.
 */
async function displayStudentName() {
  const student = Storage.getUser();
  if (!student || !student.username) {
    Swal.fire("Lỗi", "Không xác định được sinh viên!", "error");
    return;
  }

  try {
    const API_BASE = "http://localhost:3000";
    const res = await fetch(
      `${API_BASE}/api/v1/student/getStudentInfo?studentCode=${student.username}`
    );

    const result = await res.json();

    if (result.status === "success") {
      document.querySelector(
        ".studentFullName"
      ).textContent = `${result.data.student_middle_name} ${result.data.student_name}`;
    } else {
      Swal.fire("Thông báo", "Không tìm thấy thông tin sinh viên!", "warning");
    }
  } catch (error) {
    console.error(error);
    Swal.fire("Lỗi", "Không thể kết nối tới máy chủ!", "error");
  }
}

/**
 * Gửi yêu cầu lấy danh sách chứng chỉ của sinh viên hiện tại.
 * Nếu thành công thì hiển thị danh sách chứng chỉ kèm phân trang.
 */
async function getCertificatesOfStudent() {
  const student = Storage.getUser();
  if (!student || !student.username) {
    Swal.fire("Lỗi", "Không xác định được sinh viên!", "error");
    return;
  }

  const API_BASE = "http://localhost:3000";
  try {
    const res = await fetch(
      `${API_BASE}/api/v1/student/getCertificatesOfStudent?studentCode=${student.username}`
    );
    const result = await res.json();

    if (result.status === "success" && Array.isArray(result.data)) {
      console.log("Student List:", result.data);
      studentDatas = result.data;
      filterDatas = [...studentDatas];
      renderStudentList(filterDatas);
    } else {
      console.log("Chưa Có Dữ Liệu!!!");
      //   Swal.fire("Thông báo", "Không lấy được dữ liệu!", "warning");
    }
  } catch (error) {
    console.error(error);
    Swal.fire("Lỗi", "Lỗi khi lấy dữ liệu!", "error");
  }
}

// === Biến toàn cục ===
/** @type {number} */
const limitRows = 8;
/** @type {number} */
let currentPage = 1;
/** @type {Array<Object>} */
let studentDatas = []; // Dữ liệu gốc
/** @type {Array<Object>} */
let filterDatas = []; // Dữ liệu sau khi lọc hoặc tìm kiếm

/**
 * Hiển thị bảng chứng chỉ theo từng trang.
 * @param {number} page - Trang hiện tại cần hiển thị.
 */
function renderStudentList(students) {
  filterDatas = students;
  displayStudentListPage(currentPage);
  renderPagination();
}

/**
 * Hiển thị học viên cho một trang cụ thể.
 * @param {number} page - Số trang cần hiển thị
 */
function displayStudentListPage(page) {
  const studentList = document.getElementById("form-list");
  studentList.innerHTML = ""; // Clear existing rows
  const start = (page - 1) * limitRows;
  const end = start + limitRows;
  const items = filterDatas.slice(start, end);

  if (items.length > 0) {
    items.forEach((student, index) => {
      let date = student.ngay_cap;
      formatDate = date ? dayjs(date).format("DD/MM/YYYY") : "-";
      const row = document.createElement("tr");
      row.innerHTML = `
			  <td>${index + start + 1}</td>
			<td>${student.so_hieu}</td>
			<td>${student.ma_so}</td>
			<td>${student.ten}</td>
			<td>${student.lop}</td>
			<td>${student.ten_mon}</td>
			<td>${formatDate}</td>
		`;
      studentList.appendChild(row);
    });
  } else {
    studentList.innerHTML = `
		<tr>
			<td colspan="7" class="text-center text-muted bg-body-secondary">Chưa Có Chứng Chỉ Được Cấp</td>
		</tr>
	`;
  }
}

/**
 * Vẽ thanh phân trang phía dưới bảng.
 * Tự động thêm các nút trang, dấu "..." và nút chuyển trang trước/sau.
 */
function renderPagination() {
  const totalPages = Math.ceil(filterDatas.length / limitRows);
  const pagination = document.getElementById("pagination");
  pagination.innerHTML = "";

  const maxVisible = 3; // Số nút trang muốn hiển thị xung quanh trang hiện tại
  let startPage = Math.max(1, currentPage - Math.floor(maxVisible / 2));
  let endPage = Math.min(totalPages, startPage + maxVisible - 1);

  // Điều chỉnh nếu cuối danh sách
  if (endPage - startPage < maxVisible - 1) {
    startPage = Math.max(1, endPage - maxVisible + 1);
  }

  // Nút "«" ← previous
  if (currentPage > 1) {
    pagination.appendChild(createPageItem("«", currentPage - 1));
  }

  // Nút trang đầu + dấu ...
  if (startPage > 1) {
    pagination.appendChild(createPageItem(1, 1));
    if (startPage > 2) {
      pagination.appendChild(createEllipsis());
    }
  }

  // Các nút trang chính giữa
  for (let i = startPage; i <= endPage; i++) {
    const li = createPageItem(i, i);
    if (i === currentPage) li.classList.add("active");
    pagination.appendChild(li);
  }

  // Dấu ... + trang cuối
  if (endPage < totalPages) {
    if (endPage < totalPages - 1) {
      pagination.appendChild(createEllipsis());
    }
    pagination.appendChild(createPageItem(totalPages, totalPages));
  }

  // Nút "»" → next
  if (currentPage < totalPages) {
    pagination.appendChild(createPageItem("»", currentPage + 1));
  }
}

/**
 * Tạo một nút trang (số hoặc điều hướng).
 * @param {string|number} label - Nội dung hiển thị của nút
 * @param {number} pageNum - Số trang tương ứng khi click
 * @returns {HTMLLIElement} - Phần tử <li> chứa nút
 */
function createPageItem(label, pageNum) {
  const li = document.createElement("li");
  li.className = "page-item";
  const a = document.createElement("a");
  a.className = "page-link";
  a.href = "#";
  a.textContent = label;
  a.addEventListener("click", (e) => {
    e.preventDefault();
    currentPage = pageNum;
    displayStudentListPage(currentPage);
    renderPagination();
  });
  li.appendChild(a);
  return li;
}

/**
 * Tạo một phần tử phân trang dạng "..." (dấu ba chấm).
 * @returns {HTMLLIElement} - Phần tử <li> disabled
 */
function createEllipsis() {
  const li = document.createElement("li");
  li.className = "page-item disabled";
  li.innerHTML = `<span class="page-link">...</span>`;
  return li;
}

```

### frontend\js\Student\student_information.js
```js
/**
 * Khởi chạy khi DOM đã tải xong.
 * Gọi các hàm để lấy và cập nhật thông tin sinh viên.
 */
document.addEventListener("DOMContentLoaded", function () {
  fetchStudentInfo();
  updateStudentInfo();
});

/**
 * Lấy thông tin sinh viên từ localStorage và gọi API để lấy chi tiết.
 * Hiển thị thông tin sinh viên lên trang và modal cập nhật.
 */
async function fetchStudentInfo() {
  const student = Storage.getUser();
  if (!student || !student.username) {
    Swal.fire("Lỗi", "Không xác định được sinh viên!", "error");
    return;
  }

  try {
    const API_BASE = "http://localhost:3000";
    const res = await fetch(
      `${API_BASE}/api/v1/student/getStudentInfo?studentCode=${student.username}`
    );
    const result = await res.json();

    if (result.status === "success") {
      displayStudentInfo(result.data);
      displayStudentInfoInModal(result.data);
    } else {
      Swal.fire("Thông báo", "Không tìm thấy thông tin sinh viên!", "warning");
    }
  } catch (error) {
    console.error(error);
    Swal.fire("Lỗi", "Không thể kết nối tới máy chủ!", "error");
  }
}

/**
 * Hiển thị thông tin sinh viên vào các thẻ trong trang chính.
 * @param {Object} info - Dữ liệu thông tin sinh viên từ API.
 */
function displayStudentInfo(info) {
  // Họ tên + mã số
  document.querySelector(
    ".studentFullName"
  ).textContent = `${info.student_middle_name} ${info.student_name}`;
  document.querySelector(".studentCode").textContent = info.student_code;

  // Thông tin cá nhân cơ bản
  document.querySelector(".studentMiddleName").textContent =
    info.student_middle_name;
  document.querySelector(".studentName").textContent = info.student_name;
  document.querySelector(".studentGender").textContent = formatGender(
    info.student_gender
  );
  document.querySelector(".studentDateOfBirth").textContent = formatDate(
    info.student_date_of_birth
  );

  // Thông tin liên hệ
  document.querySelector(".studentPhone").textContent = info.student_phone;
  document.querySelector(".studentIDCard").textContent = info.student_IDCard;
  document.querySelector(".studentAddress").textContent = info.student_address;
  document.querySelector(".studentEmail").textContent = info.student_email;
  document.querySelector(".studentCountry").textContent = info.student_country;
  document.querySelector(".studentBorn").textContent = info.student_country;

  // Trạng thái
  document.querySelector(".studentStatus").textContent = formatStatus(
    info.student_status
  );
}

/**
 * Định dạng ngày sinh sang kiểu hiển thị tiếng Việt.
 * @param {string} dateStr - Chuỗi ngày ISO.
 * @returns {string} - Ngày được định dạng dd/mm/yyyy.
 */
function formatDate(dateStr) {
  if (!dateStr) return "-";
  const date = new Date(dateStr);
  return date.toLocaleDateString("vi-VN");
}

/**
 * Định dạng giới tính từ mã kỹ thuật sang tiếng Việt.
 * @param {string} gender - Mã giới tính ("male", "female", "other").
 * @returns {string} - Chuỗi giới tính tương ứng.
 */
function formatGender(gender) {
  return gender === "male" ? "Nam" : gender === "female" ? "Nữ" : "Khác";
}

/**
 * Định dạng trạng thái học tập.
 * @param {string} status - Trạng thái học ("studying", "graduated", "inactive").
 * @returns {string} - Chuỗi trạng thái tiếng Việt.
 */
function formatStatus(status) {
  switch (status) {
    case "studying":
      return "Đang học";
    case "graduated":
      return "Đã tốt nghiệp";
    case "inactive":
      return "Ngừng học";
    default:
      return "Không rõ";
  }
}

/**
 * Hiển thị thông tin sinh viên vào các input trong modal cập nhật.
 * @param {Object} info - Dữ liệu thông tin sinh viên từ API.
 */
function displayStudentInfoInModal(info) {
  document.getElementById("inputMiddleName").value =
    info.student_middle_name || "";
  document.getElementById("inputName").value = info.student_name || "";
  document.getElementById("inputGender").value = info.student_gender || "other";

  // Định dạng ngày sinh về yyyy-MM-dd cho input type="date"
  const dob = info.student_date_of_birth
    ? new Date(info.student_date_of_birth).toISOString().split("T")[0]
    : "";
  document.getElementById("inputDOB").value = dob;

  document.getElementById("inputPhone").value = info.student_phone || "";
  document.getElementById("inputEmail").value = info.student_email || "";
  document.getElementById("inputIDCard").value = info.student_IDCard || "";
  document.getElementById("inputBorn").value = info.student_country || "";
  document.getElementById("inputCountry").value = info.student_country || "";
  document.getElementById("inputAddress").value = info.student_address || "";
}

/**
 * Gửi yêu cầu cập nhật thông tin sinh viên lên server.
 * Lấy dữ liệu từ form modal và gọi API PUT.
 * Hiển thị thông báo phản hồi bằng Swal.
 */
function updateStudentInfo() {
  document
    .getElementById("updateStudentForm")
    .addEventListener("submit", async function (e) {
      e.preventDefault();

      const student = Storage.getUser();
      if (!student || !student.username) {
        Swal.fire("Lỗi", "Không xác định được sinh viên!", "error");
        return;
      }

      const updatedData = {
        student_gender: document.getElementById("inputGender").value,
        student_date_of_birth: document.getElementById("inputDOB").value,
        student_phone: document.getElementById("inputPhone").value.trim(),
        student_email: document.getElementById("inputEmail").value.trim(),
        student_IDCard: document.getElementById("inputIDCard").value.trim(),
        student_country: document.getElementById("inputCountry").value.trim(),
        student_address: document.getElementById("inputAddress").value.trim(),
      };

      if (!updatedData.student_email.includes("@")) {
        Swal.fire("Lỗi", "Email không hợp lệ!", "error");
        return;
      }
      console.log("Sending data:", updatedData);

      try {
        const API_BASE = "http://localhost:3000";
        const res = await fetch(
          `${API_BASE}/api/v1/student/updateStudentInfo?studentCode=${student.username}`,
          {
            method: "PUT",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(updatedData),
          }
        );

        const result = await res.json();

        if (result.status === "success") {
          Swal.fire(
            "Thành công",
            "Cập nhật thông tin thành công!",
            "success"
          ).then(() => {
            // Đóng modal, reload lại trang hoặc gọi fetch lại dữ liệu
            const modal = bootstrap.Modal.getInstance(
              document.getElementById("updateModal")
            );
            modal.hide();
            fetchStudentInfo(); // Gọi lại hàm để cập nhật UI
          });
        } else {
          Swal.fire("Thất bại", "Không thể cập nhật thông tin!", "error");
        }
      } catch (error) {
        console.error(error);
        Swal.fire("Lỗi", "Có lỗi khi gửi yêu cầu đến máy chủ!", "error");
      }
    });
}

```

### frontend\js\Teacher\teacher_chart.js
```js
/**
 * Hàm chính được gọi khi trang tải xong.
 * Gọi các API thống kê và hiển thị dữ liệu lên dashboard giảng viên.
 */
document.addEventListener("DOMContentLoaded", function () {
  getStudentPassing();
  getPassingPropotion();
  getAvgScore();
  getScoreProgress();
  getCountTeaching();
  getLastUpdate();
});

/**
 * Gọi API để lấy số lượng sinh viên đạt theo môn học và vẽ biểu đồ cột.
 */
async function getStudentPassing() {
  const teacher = Storage.getUser();
  if (!teacher || !teacher.username) {
    Swal.fire("Lỗi", "Không xác định được giảng viên!", "error");
    return;
  }

  const API_BASE = "http://localhost:3000";
  try {
    const res = await fetch(
      `${API_BASE}/api/v1/teacher/getStudentPassing?teacherCode=${teacher.username}`
    );
    const result = await res.json();

    if (result.status === "success" && Array.isArray(result.data)) {
      console.log("Student Passing Data:", result.data);
      renderStudentPassingChart(result.data);
    } else {
      Swal.fire("Thông báo", "Không lấy được dữ liệu!", "warning");
    }
  } catch (error) {
    console.error(error);
    Swal.fire("Lỗi", "Lỗi khi lấy dữ liệu!", "error");
  }
}

/**
 * Gọi API để lấy tổng số sinh viên đạt/chưa đạt và hiển thị biểu đồ tròn.
 */
async function getPassingPropotion() {
  const teacher = Storage.getUser();
  if (!teacher || !teacher.username) {
    Swal.fire("Lỗi", "Không xác định được giảng viên!", "error");
    return;
  }

  const API_BASE = "http://localhost:3000";
  try {
    const res = await fetch(
      `${API_BASE}/api/v1/teacher/getPassingPropotion?teacherCode=${teacher.username}`
    );
    const result = await res.json();

    if (result.status === "success" && result.data) {
      console.log("Passing Proportion Data:", result.data);
      renderPieChart(result.data);
    } else {
      Swal.fire("Thông báo", "Không lấy được dữ liệu tổng thể!", "warning");
    }
  } catch (error) {
    console.error(error);
    Swal.fire("Lỗi", "Lỗi khi lấy dữ liệu!", "error");
  }
}

/**
 * Gọi API để lấy điểm trung bình theo lớp-môn và hiển thị biểu đồ ngang.
 */
async function getAvgScore() {
  const teacher = Storage.getUser();
  if (!teacher || !teacher.username) {
    Swal.fire("Lỗi", "Không xác định được giảng viên!", "error");
    return;
  }

  const API_BASE = "http://localhost:3000";
  try {
    const res = await fetch(
      `${API_BASE}/api/v1/teacher/getAvgScore?teacherCode=${teacher.username}`
    );
    const result = await res.json();

    if (result.status === "success" && Array.isArray(result.data)) {
      console.log("Average Score Data:", result.data);
      renderAvgScoreChart(result.data);
    } else {
      Swal.fire("Thông báo", "Không lấy được điểm trung bình!", "warning");
    }
  } catch (error) {
    console.error(error);
    Swal.fire("Lỗi", "Lỗi khi lấy dữ liệu!", "error");
  }
}

/**
 * Gọi API để lấy tiến độ nhập điểm và hiển thị lên dashboard.
 */
async function getScoreProgress() {
  const teacher = Storage.getUser();
  if (!teacher || !teacher.username) {
    Swal.fire("Lỗi", "Không xác định được giảng viên!", "error");
    return;
  }
  const API_BASE = "http://localhost:3000";
  try {
    const res = await fetch(
      `${API_BASE}/api/v1/teacher/getScoreProgress?teacherCode=${teacher.username}`
    );
    const result = await res.json();
    console.log("Score Progress Result:", result);

    if (result.status === "success") {
      console.log("Score Progress Data:", result.data);
      renderScoreProgress(result.data);
    } else {
      Swal.fire("Thông báo", "Không lấy được tiến độ điểm!", "warning");
    }
  } catch (error) {
    console.error(error);
    Swal.fire("Lỗi", "Lỗi khi lấy dữ liệu tiến độ điểm!", "error");
  }
}

/**
 * Hiển thị phần trăm tiến độ nhập điểm trên giao diện.
 * @param {Object} datas - Dữ liệu gồm tong_sinh_vien và so_diem_da_nhap
 */
function renderScoreProgress(datas) {
  const score = document.querySelector(".score_progress");

  if (datas.length === 0) {
    score.textContent = "Không có dữ liệu tiến độ điểm!!";
    return;
  }

  const totalClasses = datas.tong_sinh_vien;
  const enteredScores = datas.so_diem_da_nhap;
  const progressPercentage = ((enteredScores / totalClasses) * 100).toFixed(2);

  score.textContent = progressPercentage + "%";
}

/**
 * Gọi API để lấy số lượng lớp mà giảng viên đang giảng dạy.
 */
async function getCountTeaching() {
  const teacher = Storage.getUser();
  if (!teacher || !teacher.username) {
    Swal.fire("Lỗi", "Không xác định được giảng viên!", "error");
    return;
  }
  const API_BASE = "http://localhost:3000";
  try {
    const res = await fetch(
      `${API_BASE}/api/v1/teacher/getCountTeaching?teacherCode=${teacher.username}`
    );
    const result = await res.json();
    console.log("Count Teaching Result:", result);
    if (result.status === "success" && result.data) {
      console.log("Count Teaching Data:", result.data);
      renderCountTeaching(result.data);
    } else {
      Swal.fire("Thông báo", "Không lấy được số lượng lớp dạy!", "warning");
    }
  } catch (error) {
    console.error(error);
    Swal.fire("Lỗi", "Lỗi khi lấy dữ liệu số lượng lớp dạy!", "error");
  }
}

/**
 * Hiển thị tổng số lớp đang giảng dạy lên dashboard.
 * @param {number|string} data - Số lượng lớp hoặc chuỗi lỗi
 */
function renderCountTeaching(data) {
  const countElement = document.querySelector(".count_teaching");
  if (data) {
    countElement.textContent = data;
  } else {
    countElement.textContent = "Không có dữ liệu!";
  }
  console.log("Count Teaching Data:", data);
}

/**
 * Gọi API để lấy lần cuối cùng giảng viên cập nhật điểm.
 */
async function getLastUpdate() {
  const teacher = Storage.getUser();
  if (!teacher || !teacher.username) {
    Swal.fire("Lỗi", "Không xác định được giảng viên!", "error");
    return;
  }
  const API_BASE = "http://localhost:3000";
  try {
    const res = await fetch(
      `${API_BASE}/api/v1/teacher/getLastUpdate?teacherCode=${teacher.username}`
    );
    const result = await res.json();

    if (result.status === "success" && result.data) {
      console.log("Last Update Data:", result.data);
      renderLastUpdate(result.data);
    } else {
      Swal.fire("Thông báo", "Không lấy được lần cuối cập nhật!", "warning");
    }
  } catch (error) {
    console.error(error);
    Swal.fire("Lỗi", "Lỗi khi lấy dữ liệu lần cuối cập nhật!", "error");
  }
}

/**
 * Hiển thị thời gian cập nhật điểm gần nhất lên dashboard.
 * @param {string} data - Dữ liệu thời gian (đã được định dạng sẵn từ server)
 */
function renderLastUpdate(data) {
  const lastUpdateElement = document.querySelector(".last_update");
  if (data) {
    lastUpdateElement.textContent = ` ${data}`;
  } else {
    lastUpdateElement.textContent = "Không có dữ liệu cập nhật!";
  }
}

/**
 * Vẽ biểu đồ cột so sánh số sinh viên đạt và tổng sinh viên theo môn học.
 * @param {Array<Object>} datas - Dữ liệu gồm các môn và số sinh viên đạt
 */
function renderStudentPassingChart(datas) {
  const ctx = document.getElementById("studentPassingChart").getContext("2d");
  const labels = datas.map((item) => `${item.subject}`);
  const totals = datas.map((item) => item.total_students);
  const passed = datas.map((item) => item.passed_students);
  console.log("Labels:", labels);
  console.log("Total Students:", totals);
  console.log("Passed Students:", passed);
  new Chart(ctx, {
    type: "bar",
    data: {
      labels: labels,
      datasets: [
        {
          label: "Tổng học viên",
          data: totals,
          backgroundColor: "#42A5F5",
        },
        {
          label: "Học viên đạt",
          data: passed,
          backgroundColor: "#66BB6A",
        },
      ],
    },
    options: {
      responsive: true,
      scales: {
        y: {
          beginAtZero: true,
        },
      },
    },
  });
}

/**
 * Vẽ biểu đồ tròn tỉ lệ sinh viên đạt và chưa đạt.
 * @param {Object} data - Dữ liệu có dạng { passed_students, total_students }
 */
function renderPieChart(data) {
  const ctx = document.getElementById("pieChart").getContext("2d");

  const passedCount = data.passed_students;
  const notPassedCount = data.total_students - data.passed_students;

  new Chart(ctx, {
    type: "pie",
    data: {
      labels: ["Đạt (≥ 4.0)", "Không đạt (< 4.0)"],
      datasets: [
        {
          data: [passedCount, notPassedCount],
          backgroundColor: ["#4CAF50", "#FF6F61"],
        },
      ],
    },
    options: {
      responsive: true,
      plugins: {
        legend: {
          position: "top",
        },
      },
    },
  });
}

/**
 * Vẽ biểu đồ ngang điểm trung bình theo lớp - môn học.
 * @param {Array<Object>} datas - Dữ liệu gồm class, subject, average_score
 */
function renderAvgScoreChart(datas) {
  const ctx = document.getElementById("avgScoreChart").getContext("2d");

  const labels = datas.map((item) => `${item.class} - ${item.subject}`);
  const scores = datas.map((item) => item.average_score);

  new Chart(ctx, {
    type: "bar",
    data: {
      labels: labels,
      datasets: [
        {
          label: "Điểm trung bình",
          data: scores,
          borderColor: "#FFA726",
          backgroundColor: "rgba(255, 167, 38, 0.6)",
          borderWidth: 1,
        },
      ],
    },
    options: {
      indexAxis: "y", // ✅ vẽ ngang
      responsive: true,
      plugins: {
        legend: {
          position: "top",
        },
        tooltip: {
          callbacks: {
            label: (ctx) => ` ${ctx.raw.toFixed(2)} điểm`,
          },
        },
      },
      scales: {
        x: {
          beginAtZero: true,
          max: 10,
          title: {
            display: true,
            text: "Thang điểm 10",
          },
        },
        y: {
          ticks: {
            autoSkip: false,
            maxRotation: 0,
            minRotation: 0,
          },
        },
      },
    },
  });
}

```

### frontend\js\Teacher\teacher_home_page.js
```js
/**
 * Hàm chính được gọi khi tài liệu DOM đã sẵn sàng.
 * Gọi hàm lấy danh sách môn học mà giảng viên đang dạy và hiển thị thông báo nếu có.
 */
document.addEventListener("DOMContentLoaded", function () {
  getModules();
  const message = localStorage.getItem("loginSuccess");
  if (message) {
    // Hiển thị toast
    Swal.fire({
      toast: true,
      position: "top-end",
      icon: "success",
      title: message,
      showConfirmButton: false,
      timer: 1500,
      timerProgressBar: true,
    });

    // Xóa sau khi hiển thị
    localStorage.removeItem("loginSuccess");
  }
});

/**
 * Gọi API để lấy danh sách các môn học mà giảng viên hiện tại đang giảng dạy.
 * Nếu thành công sẽ hiển thị danh sách qua `renderModulesList`.
 * Hiển thị thông báo nếu không xác định được người dùng hoặc lỗi kết nối.
 */
async function getModules() {
  const teacher = Storage.getUser();
  if (!teacher || !teacher.username) {
    Swal.fire("Lỗi", "Không xác định được giảng viên!", "error");
    return;
  }
  const API_BASE = "http://localhost:3000";
  try {
    const res = await fetch(
      `${API_BASE}/api/v1/teacher/getModuleTeaching?teacherCode=${teacher.username}`
    );

    const result = await res.json();

    if (result.status === "success" && Array.isArray(result.data)) {
      const modules = result.data;
      renderModulesList(modules);
    } else {
      Swal.fire("Thông báo", "Không lấy được dữ liệu!", "warning");
    }
  } catch (error) {
    console.error(error);
    Swal.fire("Lỗi", "Lỗi khi lấy dữ liệu!", "error");
  }
}

/**
 * Hiển thị danh sách môn học dưới dạng card (thẻ) Bootstrap trong DOM.
 * Mỗi môn sẽ bao gồm mã, tên môn, tên giảng viên, lớp học và nút truy cập.
 *
 * @param {Array<Object>} modules - Mảng đối tượng môn học (module_code, module_name, teacher_name, class_name, class_code, class_subject_id)
 */
function renderModulesList(modules) {
  const moduleList = document.querySelector(".module-list");
  moduleList.innerHTML = ""; // Xoá nội dung cũ

  modules.forEach((module) => {
    const div = document.createElement("div");
    div.className = "col-md-3 col-sm-6";
    div.innerHTML = `
	<div class="card shadow-sm ">
        <img
          src="../images/b1.jpg"
          class="card-img-top"
          alt="..."
        />
        <div class="card-body">
          <h5 class="card-title marquee-hover">
            <span>${module["module_code"]} - ${module["module_name"]}</span>
          </h5>
          <p class="card-text marquee-hover">
            <span>${module["teacher_name"]}</span>
          </p>
          <p class="card-text card_class_name marquee-hover">
            <span>Class: ${module["class_name"]}</span>
          </p>
          <button class="btn btn-primary"
			onclick="location.href='page_student_list.html?module=${module["module_code"]}&class=${module["class_code"]}&class_subject=${module["class_subject_id"]}&class_name=${module["class_name"]}&module_name=${module["module_name"]}'">
			Access
		  </button>
        </div>
	</div>
	`;
    moduleList.appendChild(div);
  });
}

```

### frontend\js\Teacher\teacher_import_excel.js
```js
/**
 * Khi trang được tải xong, thực thi hàm để lấy danh sách sinh viên.
 */
document.addEventListener("DOMContentLoaded", function () {
  getStudentList();
});

/**
 * Lấy và phân tích các tham số từ URL hiện tại.
 *
 * @returns {Object} - Đối tượng chứa các tham số module, class, class_subject, class_name, module_name
 */
function getParams() {
  const urlParams = new URLSearchParams(window.location.search);
  return {
    moduleCode: urlParams.get("module"),
    classCode: urlParams.get("class"),
    classSubjectId: urlParams.get("class_subject"),
    className: urlParams.get("class_name"),
    moduleName: urlParams.get("module_name"),
  };
}

/**
 * Lấy mã số sinh viên từ tên đệm và tên chính của sinh viên.
 *
 * @param {string} studentMiddleName - Họ và tên đệm của sinh viên
 * @param {string} studentName - Tên chính của sinh viên
 * @returns {Promise<string|undefined>} - Mã sinh viên nếu thành công, undefined nếu lỗi
 */
async function getStudentCode(studentMiddleName, studentName) {
  if (!studentMiddleName || !studentName) {
    Swal.fire("Lỗi", "Không nhận được tên của sinh viên!", "error");
    return;
  }

  const API_BASE = "http://localhost:3000";
  try {
    const res = await fetch(
      `${API_BASE}/api/v1/teacher/getStudentCodeByName?studentMiddleName=${studentMiddleName}&studentName=${studentName}`
    );

    const result = await res.json();

    if (result.status === "success" && result.data) {
      const studentCode = result.data;
      //   console.log("Student Code:", studentCode);
      return studentCode;
    } else {
      Swal.fire("Thông báo", "Không lấy được dữ liệu!", "warning");
    }
  } catch (error) {
    console.error(error);
    Swal.fire("Lỗi", "Lỗi khi lấy dữ liệu!", "error");
  }
}

/**
 * Đọc file Excel đầu vào và chuyển đổi thành danh sách sinh viên với tên và điểm.
 *
 * @param {File} file - File Excel người dùng chọn
 * @returns {Promise<Array<Object>|null>} - Danh sách sinh viên đã parse hoặc null nếu lỗi
 */
async function parseExcelFile(file) {
  if (!file) {
    console.error("Không có file Excel được chọn");
    Swal.fire("Lỗi", "Không có file Excel được chọn!", "");
    return null;
  }

  try {
    const data = await file.arrayBuffer();
    const workbook = XLSX.read(await file.arrayBuffer(), { type: "array" });
    const sheet = workbook.Sheets[workbook.SheetNames[0]];
    const rows = XLSX.utils.sheet_to_json(sheet, { range: 7 });

    if (rows.length === 0) {
      console.warn("File Excel không có dữ liệu.");
      Swal.fire("Lỗi", "File Excel không có dữ liệu!", "error");
      return null;
    }

    const parsed = rows.map((row) => {
      const student_code = row["MÃ HS"] || row["MÃ\nHS"] || "";
      const hoDem = row["HỌ ĐỆM"] || row["Họ và tên đệm"] || "";
      const ten = row["TÊN"] || "";
      const score = row["Tổng điểm"] ?? row["Tổng\nđiểm"] ?? null;

      return { student_code, hoDem, ten, score };
    });

    if (parsed.length === 0) {
      console.warn("Không có dữ liệu hợp lệ trong file Excel.");
      Swal.fire("Lỗi", "Không có dữ liệu hợp lệ trong file Excel!", "error");
      return null;
    }

    return parsed;
  } catch (err) {
    console.error("❌ Lỗi khi đọc file Excel:", err);
    return null;
  }
}

/**
 * Chuyển đổi danh sách họ tên trong file Excel thành mã sinh viên tương ứng.
 *
 * @param {Array<Object>} names - Mảng đối tượng gồm hoDem, ten và score
 * @returns {Promise<Array<Object>>} - Mảng gồm các object {student_code, score}
 */
async function parseNametoStudentCode(names) {
  names = names.slice(1); // Bỏ qua dòng tiêu đề
  if (!Array.isArray(names) || names.length === 0) {
    console.error("Danh sách tên không hợp lệ");
    Swal.fire("Lỗi", "Danh sách tên không hợp lệ!", "error");
    return [];
  }

  console.log("📄 Danh sách tên:", names);
  const studentCodes = [];

  for (const name of names) {
    if (name["hoDem"] && name["ten"]) {
      try {
        const studentCode = await getStudentCode(name["hoDem"], name["ten"]);
        if (!studentCode) {
          console.warn("⚠️ Không tìm thấy mã sinh viên cho:", name);
          Swal.fire(
            "Thông báo",
            `Không tìm thấy mã sinh viên cho: ${name.hoDem} ${name.ten}`,
            "warning"
          );
          continue;
        }
        studentCodes.push({
          student_code: studentCode,
          score: name.score ?? null,
        });
      } catch (err) {
        console.error("❌ Lỗi khi lấy mã sinh viên:", err);
        Swal.fire("Lỗi", "Không thể lấy mã sinh viên!", "error");
      }
    } else {
      console.warn("⚠️ Tên không hợp lệ:", name);
    }
  }

  return studentCodes;
}

/**
 * Gửi dữ liệu điểm sinh viên lên server để lưu trữ vào hệ thống.
 *
 * @param {Object} payload - Dữ liệu bao gồm classSubjectId và danh sách sinh viên (student_code + score)
 */
async function importStudentScores(payload) {
  if (!payload || !payload.classSubjectId || !Array.isArray(payload.students)) {
    Swal.fire("Lỗi", "Dữ liệu không hợp lệ!", "error");
    console.error("Dữ liệu không hợp lệ:", payload);
    return;
  }

  const API_BASE = "http://localhost:3000";
  try {
    const res = await fetch(`${API_BASE}/api/v1/teacher/importStudentScores`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(payload),
    });

    const result = await res.json();
    if (result.data.updatedCount === 0) {
      Swal.fire(
        "Thông báo",
        "Không có học sinh nào được cập nhật điểm!",
        "info"
      );
      return;
    }

    if (result.status === "success") {
      Swal.fire(
        "Thành công",
        `Nhập điểm thành công thành công cho ${result.data.updatedCount}! học sinh`,
        "success"
      ).then(() => {
        getStudentList();
      });
    } else {
      Swal.fire("Thông báo", "Không thể nhập điểm!", "warning");
      console.error("Lỗi khi nhập điểm:", result.message);
    }
  } catch (error) {
    console.error("❌ Lỗi khi gửi yêu cầu nhập điểm:", error);
    Swal.fire("Lỗi", "Lỗi khi gửi yêu cầu nhập điểm!", "error");
  }
}

/**
 * Sự kiện khi người dùng chọn file Excel.
 * Đọc file, chuyển đổi dữ liệu và gửi nhập điểm vào hệ thống.
 */
document
  .getElementById("excelFile")
  .addEventListener("change", async function () {
    const file = this.files[0];
    const result = await parseExcelFile(file);
    const studentCodes = await parseNametoStudentCode(result);
    console.log("📄 Danh sách mã sinh viên:", studentCodes);
    const { classSubjectId } = getParams(); // lấy từ URL
    if (!classSubjectId) {
      Swal.fire("Lỗi", "Không xác định được mã lớp học!", "error");
      return;
    }

    const payload = {
      classSubjectId: classSubjectId,
      students: studentCodes,
    };
    await importStudentScores(payload);
  });

```

### frontend\js\Teacher\teacher_information.js
```js
document.addEventListener("DOMContentLoaded", function () {
  getTeacherInformation();
});

/**
 * Gửi yêu cầu tới API để lấy thông tin của giảng viên hiện đang đăng nhập.
 * Hiển thị thông tin tên giảng viên trên giao diện nếu thành công.
 *
 * @returns {Promise<void>}
 */
async function getTeacherInformation() {
  const teacher = Storage.getUser();
  if (!teacher || !teacher.username) {
    Swal.fire("Lỗi", "Không xác định được giảng viên!", "error");
    return;
  }
  console.log("Teacher Information:", teacher.username);
  const API_BASE = "http://localhost:3000";
  try {
    const res = await fetch(
      `${API_BASE}/api/v1/teacher/getTeacherInfo?teacherCode=${teacher.username}`
    );

    const result = await res.json();

    if (result.status === "success" && result.data) {
      const teacherInfo = result.data;
      console.log("Teacher Information Data:", teacherInfo);
      renderDropdownMenu(teacherInfo);
    } else {
      Swal.fire("Thông báo", "Không lấy được dữ liệu!", "warning");
    }
  } catch (error) {
    console.error(error);
    Swal.fire("Lỗi", "Lỗi khi lấy dữ liệu!", "error");
  }
}

/**
 * Gán tên giảng viên vào các phần tử có class `teacher_name`.
 *
 * @param {Object} teacherInfo - Đối tượng chứa thông tin giảng viên từ server
 * @param {string} teacherInfo.teacher_name - Tên giảng viên cần hiển thị
 */
function renderDropdownMenu(teacherInfo) {
  const name = teacherInfo.teacher_name || "Giảng viên";
  document.querySelectorAll(".teacher_name").forEach((el) => {
    el.textContent = name;
  });
}

```

### frontend\js\Teacher\teacher_student_list.js
```js
document.addEventListener("DOMContentLoaded", function () {
  getStudentList();
});

/**
 * Lấy các tham số từ URL query string.
 *
 * @returns {Object} Các tham số liên quan đến module, lớp học, môn học
 */
function getParams() {
  const urlParams = new URLSearchParams(window.location.search);
  return {
    moduleCode: urlParams.get("module"),
    classCode: urlParams.get("class"),
    classSubjectId: urlParams.get("class_subject"),
    className: urlParams.get("class_name"),
    moduleName: urlParams.get("module_name"),
  };
}

/**
 * Lấy thông tin từ URL và xác thực người dùng, sau đó gọi hàm fetch dữ liệu sinh viên.
 */
function getStudentList() {
  const { moduleCode, classCode, classSubjectId, className, moduleName } =
    getParams();
  if (!moduleCode || !classCode) {
    Swal.fire("Lỗi", "Không xác định được thông tin lớp học!", "error");
    return;
  }

  const teacher = Storage.getUser();
  if (!teacher || !teacher.username) {
    Swal.fire("Lỗi", "Không xác định được giảng viên!", "error");
    return;
  }

  console.log("Module Code:", moduleCode);
  console.log("Class Code:", classCode);
  console.log("Class Subject ID:", classSubjectId);
  console.log("Teacher Username:", teacher.username);
  console.log("Class Name:", className);
  console.log("Module Name:", moduleName);

  fetchStudentList(
    teacher.username,
    moduleCode,
    classCode,
    className,
    moduleName
  );
}

/**
 * Gửi yêu cầu đến API để lấy danh sách sinh viên trong lớp.
 *
 * @param {string} teacherCode - Mã giảng viên
 * @param {string} moduleCode - Mã học phần
 * @param {string} classCode - Mã lớp
 * @param {string} className - Tên lớp
 * @param {string} moduleName - Tên học phần
 */
async function fetchStudentList(
  teacherCode,
  moduleCode,
  classCode,
  className,
  moduleName
) {
  const class_name = document.querySelector(".class_name");
  const module_name = document.querySelector(".module_name");

  if (!className || !moduleName) {
    Swal.fire("Lỗi", "Không xác định được tên lớp học hoặc môn học!", "error");
    return;
  }

  class_name.textContent = className;
  module_name.textContent = moduleName;

  const API_BASE = "http://localhost:3000";
  try {
    const res = await fetch(
      `${API_BASE}/api/v1/teacher/getStudentInClass?teacherCode=${teacherCode}&moduleCode=${moduleCode}&classCode=${classCode}`
    );

    const result = await res.json();
    console.log("API Response:", result);

    if (result.status === "success" && Array.isArray(result.data)) {
      renderStudentList(result.data);
    } else {
      Swal.fire("Thông báo", "Không lấy được dữ liệu sinh viên!", "warning");
    }
  } catch (error) {
    console.error(error);
    Swal.fire("Lỗi", "Lỗi khi lấy dữ liệu sinh viên!", "error");
  }
}

/**
 * Hiển thị danh sách sinh viên vào bảng HTML.
 *
 * @param {Array<Object>} students - Mảng danh sách sinh viên từ API
 */
function renderStudentList(students) {
  const tbody = document.getElementById("studentTable");
  tbody.innerHTML = "";

  students.forEach((student, index) => {
    var score = 0;
    if (student["score"] === null || student["score"] === undefined) {
      score = "-";
    } else {
      score = student["score"];
    }
    const row = document.createElement("tr");
    row.innerHTML = `
	  		<td>${index + 1}</td>
            <td>${student["student_code"]}</td>
            <td>${student["student_middle_name"]}</td>
            <td>${student["student_name"]}</td>
            <td>${student["class_name"]}-1</td>
            <td>${score}</td>
            <td>
              <button
                class="btn btn-sm btn-primary"
                data-bs-toggle="modal"
                data-bs-target="#editModal"
				data-student-code="${student["student_code"]}"
                data-name="${student["student_middle_name"]} ${
      student["student_name"]
    }"
                data-class="${student["class_name"]}"
                data-score="${score}"
              >
                <i class="bi bi-pencil-square"></i> Sửa
              </button>
            </td>
	`;
    tbody.appendChild(row);
  });
}

/**
 * Cập nhật điểm cho sinh viên theo mã lớp học phần.
 *
 * @param {string} studentCode - Mã sinh viên
 * @param {string|number} score - Điểm cần cập nhật
 */
async function updateStudentScore(studentCode, score) {
  const { classSubjectId } = getParams();

  const API_BASE = "http://localhost:3000";
  console.log("Updating score for:", {
    classSubjectId,
    studentCode,
    score,
  });
  if (!classSubjectId || !studentCode || score === "") {
    Swal.fire("Lỗi", "Thiếu dữ liệu để cập nhật điểm!", "error");
    return;
  }

  try {
    const res = await fetch(`${API_BASE}/api/v1/teacher/updateStudentScore`, {
      method: "PUT",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        classSubjectId,
        studentCode,
        score: parseFloat(score),
      }),
    });

    const data = await res.json();

    if (data.status === "success") {
      Swal.fire("Thành công", "Điểm đã được cập nhật!", "success");
      getStudentList();
    } else {
      Swal.fire("Lỗi", data.message || "Không thể cập nhật điểm!", "error");
    }
  } catch (error) {
    console.error("Error:", error);
    Swal.fire("Lỗi", "Có lỗi xảy ra khi cập nhật điểm!", "error");
  }
}

let currentStudentCode = "";

/**
 * Gán thông tin sinh viên vào modal khi nhấn nút "Sửa".
 */
const editModal = document.getElementById("editModal");
editModal.addEventListener("show.bs.modal", function (event) {
  const button = event.relatedTarget;
  const name = button.getAttribute("data-name");
  const className = button.getAttribute("data-class");
  const score = button.getAttribute("data-score");
  const studentCode = button.getAttribute("data-student-code");
  currentStudentCode = studentCode;
  console.log("Current Student Code:", currentStudentCode);
  document.getElementById("studentName").value = name;
  document.getElementById("studentClass").value = className;
  document.getElementById("studentScore").value = score;
});

/**
 * Lắng nghe sự kiện submit của form chỉnh sửa điểm và cập nhật điểm.
 */
document
  .getElementById("editScoreForm")
  .addEventListener("submit", function (e) {
    e.preventDefault(); // Ngăn reload trang
    const score = document.getElementById("studentScore").value;
    updateStudentScore(currentStudentCode, score);
  });

```
